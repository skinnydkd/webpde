<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ† Concurs PDE - Economia, Finances i Empresa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Plus Jakarta Sans', -apple-system, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-10px); } 40% { transform: translateX(10px); } 60% { transform: translateX(-10px); } 80% { transform: translateX(10px); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 5px #fbbf24; } 50% { box-shadow: 0 0 20px #fbbf24, 0 0 30px #f59e0b; } }
        @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes correctPulse { 0% { background-color: rgba(74, 222, 128, 0.3); } 50% { background-color: rgba(74, 222, 128, 0.6); } 100% { background-color: rgba(74, 222, 128, 0.3); } }
        @keyframes wrongShake { 0%, 100% { transform: translateX(0); background-color: rgba(248, 113, 113, 0.3); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-fade { animation: fadeIn 0.4s ease-out; }
        .animate-pulse-custom { animation: pulse 0.5s ease-in-out; }
        .animate-shake { animation: shake 0.5s ease-in-out; }
        .animate-bounce { animation: bounce 0.5s ease-in-out; }
        .animate-glow { animation: glow 1s ease-in-out infinite; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .animate-popIn { animation: popIn 0.3s ease-out; }
        .animate-correct { animation: correctPulse 0.5s ease-in-out; }
        .animate-wrong { animation: wrongShake 0.5s ease-in-out; }
        .gold-gradient { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .confetti { position: fixed; width: 10px; height: 10px; top: -10px; animation: confetti 3s linear forwards; pointer-events: none; z-index: 1000; }
        .streak-fire { text-shadow: 0 0 10px #f97316, 0 0 20px #ea580c, 0 0 30px #dc2626; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        /* IMPORTANT: Evitar problemes amb el teclat en mÃ²bil */
        html { height: -webkit-fill-available; }
        body { 
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }
        input, textarea, select { font-size: 16px !important; } /* Evita zoom automÃ tic en iOS */
        input:focus { outline: none; }
        
        /* Input flotant fix per mÃ²bil */
        #numeric-input-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(30, 27, 75, 0.98), rgba(30, 27, 75, 0.95));
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            z-index: 9999;
            border-top: 2px solid rgba(250, 204, 21, 0.5);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }
        #numeric-input-container.active { display: block; }
        #numeric-input-field {
            width: 100%;
            padding: 16px;
            font-size: 24px !important;
            font-weight: bold;
            text-align: center;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            color: white;
            margin-bottom: 12px;
        }
        #numeric-input-field:focus {
            border-color: #facc15;
            background: rgba(255,255,255,0.15);
        }
        #numeric-input-field::placeholder { color: rgba(255,255,255,0.5); }
        #numeric-submit-btn {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
        }
        #numeric-submit-btn:active { transform: scale(0.98); }
        #numeric-submit-btn:disabled { opacity: 0.5; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen">
    <!-- INPUT NUMÃˆRIC FORA DE REACT - COMPLETAMENT INDEPENDENT! -->
    <div id="numeric-input-container">
        <input 
            type="text" 
            id="numeric-input-field" 
            inputmode="decimal" 
            pattern="[0-9.,\-]*"
            placeholder="Resultat numÃ¨ric..."
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            enterkeyhint="done"
        />
        <button id="numeric-submit-btn" type="button">COMPROVAR</button>
    </div>
    
    <!-- SCRIPT PER L'INPUT FLOTANT - 100% INDEPENDENT DE REACT! -->
    <script>
    (function() {
        var container = document.getElementById('numeric-input-container');
        var input = document.getElementById('numeric-input-field');
        var btn = document.getElementById('numeric-submit-btn');
        var isShowing = false;
        
        // Submit amb el botÃ³
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            var value = input.value.trim();
            if (value && window.submitNumericAnswer) {
                window.submitNumericAnswer(value);
            }
        });
        
        // Submit amb Enter
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.stopPropagation();
                var value = input.value.trim();
                if (value && window.submitNumericAnswer) {
                    window.submitNumericAnswer(value);
                }
            }
        });
        
        // API per controlar l'input
        window.numericInputAPI = {
            show: function(placeholder, lang) {
                input.value = '';
                container.classList.add('active');
                isShowing = true;
                input.focus();
            },
            hide: function() {
                if (isShowing) {
                    container.classList.remove('active');
                    isShowing = false;
                }
            },
            reset: function() {
                input.value = '';
                container.classList.remove('active');
                isShowing = false;
            }
        };
    })();
    </script>
    
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect, useMemo, useRef, useCallback, memo } = React;

// TIMER AMB DOM DIRECTE - NO CAUSA CAP RE-RENDER DEL PARE!
function TimerDirect({ timerKey, onTimeUp, isActive }) {
    const timeRef = useRef(60);
    const intervalRef = useRef(null);
    const barRef = useRef(null);
    const textRef = useRef(null);
    const onTimeUpRef = useRef(onTimeUp);
    
    // Actualitzar la referÃ¨ncia del callback sense causar re-render
    useEffect(() => {
        onTimeUpRef.current = onTimeUp;
    }, [onTimeUp]);
    
    // Reset quan canvia timerKey (nova pregunta)
    useEffect(() => {
        timeRef.current = 60;
        if (textRef.current) {
            textRef.current.textContent = '60s';
            textRef.current.className = 'text-2xl font-black min-w-[50px] text-right text-white';
        }
        if (barRef.current) {
            barRef.current.style.width = '100%';
            barRef.current.className = 'h-full bg-green-500 transition-all duration-1000';
        }
    }, [timerKey]);
    
    // Gestionar interval - actualitza DOM directament
    useEffect(() => {
        if (intervalRef.current) {
            clearInterval(intervalRef.current);
            intervalRef.current = null;
        }
        
        if (!isActive) return;
        
        intervalRef.current = setInterval(() => {
            timeRef.current -= 1;
            const t = timeRef.current;
            
            // ACTUALITZAR DOM DIRECTAMENT - SENSE setState!
            if (textRef.current) {
                textRef.current.textContent = t + 's';
                textRef.current.className = t > 30 
                    ? 'text-2xl font-black min-w-[50px] text-right text-white'
                    : t > 10 
                        ? 'text-2xl font-black min-w-[50px] text-right text-amber-400'
                        : 'text-2xl font-black min-w-[50px] text-right text-red-400 animate-pulse';
            }
            if (barRef.current) {
                barRef.current.style.width = ((t / 60) * 100) + '%';
                barRef.current.className = t > 30 
                    ? 'h-full bg-green-500 transition-all duration-1000'
                    : t > 10 
                        ? 'h-full bg-amber-500 transition-all duration-1000'
                        : 'h-full bg-red-500 transition-all duration-1000';
            }
            
            if (t <= 0) {
                clearInterval(intervalRef.current);
                intervalRef.current = null;
                if (onTimeUpRef.current) onTimeUpRef.current();
            }
        }, 1000);
        
        return () => {
            if (intervalRef.current) {
                clearInterval(intervalRef.current);
                intervalRef.current = null;
            }
        };
    }, [isActive, timerKey]);
    
    // Exposar funciÃ³ per afegir temps (per l'ajuda +60s)
    useEffect(() => {
        window.addTimerTime = (seconds) => {
            timeRef.current = Math.min(timeRef.current + seconds, 120);
            if (textRef.current) textRef.current.textContent = timeRef.current + 's';
            if (barRef.current) barRef.current.style.width = Math.min((timeRef.current / 60) * 100, 100) + '%';
        };
        return () => { delete window.addTimerTime; };
    }, []);
    
    return (
        <div className="flex items-center gap-3">
            <div className="flex-1 h-2 bg-white/20 rounded-full overflow-hidden">
                <div ref={barRef} className="h-full bg-green-500 transition-all duration-1000" style={{width: '100%'}}></div>
            </div>
            <span ref={textRef} className="text-2xl font-black min-w-[50px] text-right text-white">60s</span>
        </div>
    );
}

// Efecte confetti
const Confetti = ({ show }) => {
    if (!show) return null;
    const colors = ['#f59e0b', '#10b981', '#3b82f6', '#ec4899', '#8b5cf6', '#ef4444'];
    return (
        <>
            {[...Array(50)].map((_, i) => (
                <div key={i} className="confetti" style={{
                    left: `${Math.random() * 100}%`,
                    backgroundColor: colors[Math.floor(Math.random() * colors.length)],
                    animationDelay: `${Math.random() * 2}s`,
                    borderRadius: Math.random() > 0.5 ? '50%' : '0',
                }}></div>
            ))}
        </>
    );
};

// Toast notifications
const Toast = ({ message, type, show }) => {
    if (!show) return null;
    const bg = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
    return (
        <div className={`fixed top-4 right-4 ${bg} text-white px-6 py-3 rounded-xl font-bold shadow-lg animate-slideIn z-50`}>
            {message}
        </div>
    );
};

// Component per mostrar punts guanyats/perduts
const PointsPopup = ({ points, show }) => {
    if (!show) return null;
    const isPositive = points > 0;
    return (
        <div className={`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl font-black animate-popIn z-50 ${isPositive ? 'text-green-400' : 'text-red-400'}`}>
            {isPositive ? '+' : ''}{points}
        </div>
    );
};

function ConcursApp() {
    const [idioma, setIdioma] = useState('val');
    const [fase, setFase] = useState('inici');
    const [categoria, setCategoria] = useState('totes');
    const [nomJugador, setNomJugador] = useState('');
    const nomInputRef = useRef(null); // Ref per l'input del nom
    const [preguntaActual, setPreguntaActual] = useState(0);
    const [puntuacio, setPuntuacio] = useState(0);
    const [respostes, setRespostes] = useState([]);
    const [ratxa, setRatxa] = useState(0);
    const [maxRatxa, setMaxRatxa] = useState(0);
    const [preguntesPartida, setPreguntesPartida] = useState([]);
    const [respostaUsuari, setRespostaUsuari] = useState(null);
    const [mostrarResultat, setMostrarResultat] = useState(false);
    const [ranking, setRanking] = useState([]);
    const [rankingFilter, setRankingFilter] = useState({ temps: 'etern', categoria: 'general' });
    const [rankingLoading, setRankingLoading] = useState(false);
    
    // FUNCIONS DE RANKING GLOBAL AMB STORAGE COMPARTIT
    const guardarAlRanking = async (entry) => {
        if (!window.storage) {
            // Fallback a localStorage si no hi ha storage compartit
            const saved = localStorage.getItem('pde_concurs_ranking_v4') || '[]';
            const all = JSON.parse(saved);
            all.push(entry);
            localStorage.setItem('pde_concurs_ranking_v4', JSON.stringify(all));
            return;
        }
        
        try {
            const key = `ranking:${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            await window.storage.set(key, JSON.stringify(entry), true); // shared: true
        } catch (e) {
            console.error('Error guardant ranking:', e);
        }
    };
    
    const carregarRanking = async (filtreTemps, filtreCategoria) => {
        setRankingLoading(true);
        let entries = [];
        
        if (!window.storage) {
            // Fallback a localStorage
            const saved = localStorage.getItem('pde_concurs_ranking_v4') || '[]';
            entries = JSON.parse(saved);
        } else {
            try {
                const result = await window.storage.list('ranking:', true); // shared: true
                if (result && result.keys) {
                    for (const key of result.keys) {
                        try {
                            const data = await window.storage.get(key, true);
                            if (data && data.value) {
                                entries.push(JSON.parse(data.value));
                            }
                        } catch (e) {
                            // Ignorar entrades corruptes
                        }
                    }
                }
            } catch (e) {
                console.error('Error carregant ranking:', e);
                // Fallback a localStorage
                const saved = localStorage.getItem('pde_concurs_ranking_v4') || '[]';
                entries = JSON.parse(saved);
            }
        }
        
        // Filtrar per temps (etern o mensual)
        const ara = new Date();
        const mesActual = `${ara.getFullYear()}-${String(ara.getMonth() + 1).padStart(2, '0')}`;
        
        if (filtreTemps === 'mensual') {
            entries = entries.filter(e => e.mes === mesActual);
        }
        
        // Filtrar per categoria
        if (filtreCategoria !== 'general') {
            entries = entries.filter(e => e.categoria === filtreCategoria);
        }
        
        // Ordenar per punts (descendent)
        entries.sort((a, b) => b.punts - a.punts);
        
        // Limitar a mÃ xim 3 entrades per nom
        const comptador = {};
        entries = entries.filter(e => {
            const nom = e.nom.toLowerCase();
            comptador[nom] = (comptador[nom] || 0) + 1;
            return comptador[nom] <= 3;
        });
        
        // Top 10
        entries = entries.slice(0, 10);
        
        setRanking(entries);
        setRankingLoading(false);
    };
    
    // Carregar ranking quan canvien els filtres o s'obre la pantalla
    useEffect(() => {
        if (fase === 'ranking') {
            carregarRanking(rankingFilter.temps, rankingFilter.categoria);
        }
    }, [fase, rankingFilter]);
    const [ordreUsuari, setOrdreUsuari] = useState([]);
    const [timerKey, setTimerKey] = useState(0);
    const [timerActive, setTimerActive] = useState(false);
    const [showConfetti, setShowConfetti] = useState(false);
    const [toast, setToast] = useState({ show: false, message: '', type: '' });
    const [pointsPopup, setPointsPopup] = useState({ show: false, points: 0 });
    const [ajudes, setAjudes] = useState({ cinquanta: 1, temps: 1, saltar: 1 });
    const [opcionsEliminades, setOpcionsEliminades] = useState([]);
    const [soundEnabled, setSoundEnabled] = useState(true);
    // Nous estats per tipus interactius
    const [clickedPoint, setClickedPoint] = useState(null);
    const [allocations, setAllocations] = useState([]);
    const [sliderValue, setSliderValue] = useState(25);
    const [selectedOptions, setSelectedOptions] = useState([]);
    
    const t = (val, es, en) => idioma === 'val' ? val : idioma === 'es' ? es : en;
    
    // Efectes de so
    const playSound = useCallback((type) => {
        if (!soundEnabled) return;
        try {
            const sounds = {
                correct: [523.25, 659.25, 783.99], // Do-Mi-Sol
                wrong: [311.13, 293.66], // Miâ™­-Re
                tick: [800],
                bonus: [523.25, 659.25, 783.99, 1046.50], // Do-Mi-Sol-Do'
            };
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const notes = sounds[type] || [440];
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = freq;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.3, ctx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.1 + 0.3);
                osc.start(ctx.currentTime + i * 0.1);
                osc.stop(ctx.currentTime + i * 0.1 + 0.3);
            });
        } catch(e) {}
    }, [soundEnabled]);
    
    // Vibrar en mÃ²bil
    const vibrate = useCallback((pattern) => {
        if (navigator.vibrate) navigator.vibrate(pattern);
    }, []);
    
    // Toast helper
    const showToast = useCallback((message, type = 'info') => {
        setToast({ show: true, message, type });
        setTimeout(() => setToast({ show: false, message: '', type: '' }), 2000);
    }, []);
    
    // GESTIÃ“ INPUT HTML FLOTANT - Usar l'API global
    // CONTROL DE L'INPUT NUMÃˆRIC - UNIFICAT PER EVITAR RACE CONDITIONS
    const prevPreguntaRef = useRef(-1);
    const prevShowNumericRef = useRef(false);
    
    useEffect(() => {
        const p = preguntesPartida[preguntaActual];
        const shouldShow = fase === 'jugant' && p && p.tipus === 'numeric' && !mostrarResultat;
        const preguntaChanged = preguntaActual !== prevPreguntaRef.current;
        
        if (window.numericInputAPI) {
            // Si la pregunta ha canviat
            if (preguntaChanged) {
                prevPreguntaRef.current = preguntaActual;
                
                // NomÃ©s fem reset si ABANS tenÃ­em l'input obert
                if (prevShowNumericRef.current) {
                    window.numericInputAPI.reset();
                }
            }
            
            // Ara decidim si mostrar o amagar
            if (shouldShow && !prevShowNumericRef.current) {
                const placeholder = idioma === 'val' ? 'Resultat numÃ¨ric...' : idioma === 'es' ? 'Resultado numÃ©rico...' : 'Numeric result...';
                window.numericInputAPI.show(placeholder, idioma);
            } else if (!shouldShow && prevShowNumericRef.current) {
                window.numericInputAPI.hide();
            }
            
            prevShowNumericRef.current = shouldShow;
        }
    }, [fase, preguntaActual, mostrarResultat, preguntesPartida, idioma]);

    // BANC DE PREGUNTES
    const bancPreguntes = useMemo(() => ({
        economia: [
            { id: 'ec1', tipus: 'numeric', dificultat: 'facil', pregunta: t("Elasticitat: Preu puja 10â†’12â‚¬, Demanda baixa 100â†’80u. Elasticitat? (absolut)", "Elasticidad: Precio sube 10â†’12â‚¬, Demanda baja 100â†’80u. Â¿Elasticidad? (absoluto)", "Elasticity: Price rises 10â†’12â‚¬, Demand drops 100â†’80u. Elasticity? (absolute)"), correcta: 1, tolerancia: 0.1, pista: "Ed = (%Î”Q) / (%Î”P)" },
            { id: 'ec2', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("PIB = C+I+G+(X-M). C=500, I=200, G=150, X=100, M=80. PIB?", "PIB = C+I+G+(X-M). C=500, I=200, G=150, X=100, M=80. Â¿PIB?", "GDP = C+I+G+(X-M). C=500, I=200, G=150, X=100, M=80. GDP?"), correcta: 870, tolerancia: 0, pista: "Suma tots els components" },
            { id: 'ec3', tipus: 'numeric', dificultat: 'facil', pregunta: t("Taxa d'atur: 2M aturats, 18M ocupats. Taxa en %?", "Tasa de paro: 2M parados, 18M ocupados. Â¿Tasa en %?", "Unemployment: 2M unemployed, 18M employed. Rate %?"), correcta: 10, tolerancia: 0, pista: "Atur/(Atur+Ocupats)Ã—100" },
            { id: 'ec4', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Multiplicador keynesiÃ  amb PMC=0.8?", "Multiplicador keynesiano con PMC=0.8?", "Keynesian multiplier with MPC=0.8?"), correcta: 5, tolerancia: 0, pista: "1/(1-PMC)" },
            { id: 'ec5', tipus: 'numeric', dificultat: 'facil', pregunta: t("InflaciÃ³: IPC anterior=100, IPC actual=103. InflaciÃ³ %?", "InflaciÃ³n: IPC anterior=100, IPC actual=103. Â¿InflaciÃ³n %?", "Inflation: Previous CPI=100, Current CPI=103. Inflation %?"), correcta: 3, tolerancia: 0, pista: "(IPCnew-IPCold)/IPColdÃ—100" },
            { id: 'ec6', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Creixement real: PIB nominal +7%, inflaciÃ³ 4%. Creixement real aprox?", "Crecimiento real: PIB nominal +7%, inflaciÃ³n 4%. Â¿Crecimiento real aprox?", "Real growth: Nominal GDP +7%, inflation 4%. Approx real growth?"), correcta: 3, tolerancia: 0.5, pista: "Nominal - InflaciÃ³" },
            { id: 'ec7', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("BalanÃ§a comercial: X=50.000Mâ‚¬, M=65.000Mâ‚¬. Saldo?", "Balanza comercial: X=50.000Mâ‚¬, M=65.000Mâ‚¬. Â¿Saldo?", "Trade balance: X=â‚¬50,000M, M=â‚¬65,000M. Balance?"), correcta: -15000, tolerancia: 0, pista: "X - M" },
            // NOVES PREGUNTES ECONOMIA
            { id: 'ec8', tipus: 'numeric', dificultat: 'facil', pregunta: t("PIB per cÃ pita: PIB=1.000.000Mâ‚¬, PoblaciÃ³=50M. Resultat?", "PIB per cÃ¡pita: PIB=1.000.000Mâ‚¬, PoblaciÃ³n=50M. Â¿Resultado?", "GDP per capita: GDP=â‚¬1,000,000M, Pop=50M. Result?"), correcta: 20000, tolerancia: 0, pista: "PIB / PoblaciÃ³" },
            { id: 'ec9', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Velocitat dels diners: PIB=800, M=200. V=?", "Velocidad del dinero: PIB=800, M=200. Â¿V?", "Velocity of money: GDP=800, M=200. V=?"), correcta: 4, tolerancia: 0, pista: "V = PIB / M" },
            { id: 'ec10', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Tipus d'interÃ¨s real: Nominal=8%, InflaciÃ³=3%. Real aprox?", "Tipo de interÃ©s real: Nominal=8%, InflaciÃ³n=3%. Â¿Real aprox?", "Real interest: Nominal=8%, Inflation=3%. Approx real?"), correcta: 5, tolerancia: 0.5, pista: "Real â‰ˆ Nominal - InflaciÃ³" },
            { id: 'ec11', tipus: 'numeric', dificultat: 'facil', pregunta: t("IPC any 2: Base=100, Cistella=115â‚¬. IPC?", "IPC aÃ±o 2: Base=100, Cesta=115â‚¬. Â¿IPC?", "CPI year 2: Base=100, Basket=â‚¬115. CPI?"), correcta: 115, tolerancia: 0, pista: "Ja et donen el valor!" },
            { id: 'ec12', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Taxa d'activitat: Actius=20M, PoblaciÃ³ 16+=40M. Taxa %?", "Tasa de actividad: Activos=20M, PoblaciÃ³n 16+=40M. Â¿Tasa %?", "Activity rate: Active=20M, Pop 16+=40M. Rate %?"), correcta: 50, tolerancia: 0, pista: "Actius/PoblaciÃ³Ã—100" },
            { id: 'ec13', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Efecte multiplicador: InversiÃ³=100Mâ‚¬, PMC=0.75. Increment PIB?", "Efecto multiplicador: InversiÃ³n=100Mâ‚¬, PMC=0.75. Â¿Incremento PIB?", "Multiplier effect: Investment=â‚¬100M, MPC=0.75. GDP increase?"), correcta: 400, tolerancia: 0, pista: "Î”Y = k Ã— Î”I on k=1/(1-PMC)" },
            { id: 'ec14', tipus: 'numeric', dificultat: 'facil', pregunta: t("Deflactor PIB: PIB nominal=110, PIB real=100. Deflactor?", "Deflactor PIB: PIB nominal=110, PIB real=100. Â¿Deflactor?", "GDP deflator: Nominal=110, Real=100. Deflator?"), correcta: 110, tolerancia: 0, pista: "(Nominal/Real)Ã—100" },
            { id: 'ec15', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Import d'un impost: Base=50.000â‚¬, Tipus=21%. Quota?", "Importe de un impuesto: Base=50.000â‚¬, Tipo=21%. Â¿Cuota?", "Tax amount: Base=â‚¬50,000, Rate=21%. Tax?"), correcta: 10500, tolerancia: 0, pista: "Base Ã— Tipus" },
            { id: 'em1', tipus: 'multiple', dificultat: 'facil', pregunta: t("Quin Ã©s un bÃ© pÃºblic pur?", "Â¿CuÃ¡l es un bien pÃºblico puro?", "Which is a pure public good?"), opcions: [t("Defensa nacional", "Defensa nacional", "National defense"), t("EducaciÃ³", "EducaciÃ³n", "Education"), t("Sanitat", "Sanidad", "Healthcare"), t("Autopistes", "Autopistas", "Highways")], correcta: 0 },
            { id: 'em2', tipus: 'multiple', dificultat: 'mitjana', pregunta: t("Quin NO Ã©s un objectiu macroeconÃ²mic?", "Â¿CuÃ¡l NO es un objetivo macroeconÃ³mico?", "Which is NOT a macro objective?"), opcions: [t("Estabilitat de preus", "Estabilidad de precios", "Price stability"), t("Ple ocupaciÃ³", "Pleno empleo", "Full employment"), t("Maximitzar beneficis", "Maximizar beneficios", "Maximize profits"), t("Creixement", "Crecimiento", "Growth")], correcta: 2 },
            { id: 'em3', tipus: 'multiple', dificultat: 'dificil', pregunta: t("La polÃ­tica fiscal expansiva implica:", "La polÃ­tica fiscal expansiva implica:", "Expansionary fiscal policy implies:"), opcions: [t("Pujar impostos", "Subir impuestos", "Raise taxes"), t("Reduir despesa", "Reducir gasto", "Cut spending"), t("Augmentar despesa", "Aumentar gasto", "Increase spending"), t("Vendre deute", "Vender deuda", "Sell debt")], correcta: 2 },
            { id: 'em4', tipus: 'multiple', dificultat: 'facil', pregunta: t("El BCE controla la polÃ­tica...", "El BCE controla la polÃ­tica...", "The ECB controls... policy"), opcions: [t("Fiscal", "Fiscal", "Fiscal"), t("MonetÃ ria", "Monetaria", "Monetary"), t("Comercial", "Comercial", "Trade"), t("Industrial", "Industrial", "Industrial")], correcta: 1 },
            { id: 'em5', tipus: 'multiple', dificultat: 'mitjana', pregunta: t("Un monopoli natural es caracteritza per:", "Un monopolio natural se caracteriza por:", "A natural monopoly is characterized by:"), opcions: [t("Molts competidors", "Muchos competidores", "Many competitors"), t("Alts costos fixos", "Altos costes fijos", "High fixed costs"), t("Productes diferenciats", "Productos diferenciados", "Differentiated products"), t("Lliure entrada", "Libre entrada", "Free entry")], correcta: 1 },
            { id: 'ev3', tipus: 'truefalse', dificultat: 'facil', pregunta: t("El PIB mesura el valor de la producciÃ³ d'un paÃ­s en un any", "El PIB mide el valor de la producciÃ³n de un paÃ­s en un aÃ±o", "GDP measures the value of a country's production in a year"), correcta: true },
            { id: 'ev4', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("Una deflaciÃ³ Ã©s beneficiosa per a l'economia", "Una deflaciÃ³n es beneficiosa para la economÃ­a", "Deflation is good for the economy"), correcta: false },
            { id: 'ev5', tipus: 'truefalse', dificultat: 'dificil', pregunta: t("El dÃ¨ficit pÃºblic sempre genera inflaciÃ³", "El dÃ©ficit pÃºblico siempre genera inflaciÃ³n", "Public deficit always causes inflation"), correcta: false },
            { id: 'ev6', tipus: 'truefalse', dificultat: 'facil', pregunta: t("L'atur friccional Ã©s voluntari i temporal", "El paro friccional es voluntario y temporal", "Frictional unemployment is voluntary and temporary"), correcta: true },
            { id: 'ev7', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("El comerÃ§ internacional sempre beneficia tots els paÃ¯sos", "El comercio internacional siempre beneficia a todos los paÃ­ses", "International trade always benefits all countries"), correcta: false },
            { id: 'eo4', tipus: 'order', dificultat: 'facil', pregunta: t("PirÃ mide de Maslow (de base a cim):", "PirÃ¡mide de Maslow (de base a cima):", "Maslow pyramid (base to top):"), elements: [t("FisiolÃ²giques", "FisiolÃ³gicas", "Physiological"), t("Seguretat", "Seguridad", "Safety"), t("Socials", "Sociales", "Social"), t("Autoestima", "Autoestima", "Esteem")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo5', tipus: 'order', dificultat: 'mitjana', pregunta: t("Nivells de renda (menor a major):", "Niveles de renta (menor a mayor):", "Income levels (low to high):"), elements: [t("Baixa", "Baja", "Low"), t("Mitjana-baixa", "Media-baja", "Lower-middle"), t("Mitjana-alta", "Media-alta", "Upper-middle"), t("Alta", "Alta", "High")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'ef4', tipus: 'formula', dificultat: 'facil', pregunta: t("InflaciÃ³ = [(IPC actual - IPC anterior) / ___] Ã— 100", "InflaciÃ³n = [(IPC actual - IPC anterior) / ___] Ã— 100", "Inflation = [(Current CPI - Previous CPI) / ___] Ã— 100"), opcions: [t("IPC anterior", "IPC anterior", "Previous CPI"), t("IPC actual", "IPC actual", "Current CPI"), "100", "PIB"], correcta: 0 },
            { id: 'ef5', tipus: 'formula', dificultat: 'mitjana', pregunta: t("BalanÃ§a comercial = ___ - Importacions", "Balanza comercial = ___ - Importaciones", "Trade balance = ___ - Imports"), opcions: [t("Exportacions", "Exportaciones", "Exports"), t("Consum", "Consumo", "Consumption"), t("InversiÃ³", "InversiÃ³n", "Investment"), "PIB"], correcta: 0 },
            { id: 'eo1', tipus: 'order', dificultat: 'mitjana', pregunta: t("Fases del cicle econÃ²mic:", "Fases del ciclo econÃ³mico:", "Business cycle phases:"), elements: [t("ExpansiÃ³", "ExpansiÃ³n", "Expansion"), t("Cim", "Cima", "Peak"), t("RecessiÃ³", "RecesiÃ³n", "Recession"), t("Fons", "Valle", "Trough")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo2', tipus: 'order', dificultat: 'dificil', pregunta: t("Escoles econÃ²miques cronolÃ²gicament:", "Escuelas econÃ³micas cronolÃ³gicamente:", "Economic schools chronologically:"), elements: [t("Mercantilisme", "Mercantilismo", "Mercantilism"), t("FisiocrÃ cia", "Fisiocracia", "Physiocracy"), t("ClÃ ssica", "ClÃ¡sica", "Classical"), t("Keynesiana", "Keynesiana", "Keynesian")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo3', tipus: 'order', dificultat: 'facil', pregunta: t("Sectors econÃ²mics (ordre clÃ ssic):", "Sectores econÃ³micos (orden clÃ¡sico):", "Economic sectors (classic order):"), elements: [t("Primari", "Primario", "Primary"), t("Secundari", "Secundario", "Secondary"), t("Terciari", "Terciario", "Tertiary")], ordreCorrecte: [0, 1, 2] },
            { id: 'ef1', tipus: 'formula', dificultat: 'facil', pregunta: "PIB = C + I + G + ___", opcions: ["(X-M)", "(M-X)", "T", "S"], correcta: 0 },
            { id: 'ef2', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Taxa d'atur = Aturats / ___ Ã— 100", "Tasa de paro = Parados / ___ Ã— 100", "Unemployment = Unemployed / ___ Ã— 100"), opcions: [t("PoblaciÃ³ activa", "PoblaciÃ³n activa", "Labor force"), t("PoblaciÃ³ total", "PoblaciÃ³n total", "Total pop."), t("Ocupats", "Ocupados", "Employed"), "PIB"], correcta: 0 },
            { id: 'ef3', tipus: 'formula', dificultat: 'dificil', pregunta: t("Multiplicador = 1 / (1 - ___)", "Multiplicador = 1 / (1 - ___)", "Multiplier = 1 / (1 - ___)"), opcions: ["PMC", "PMA", "i", "t"], correcta: 0 },
            { id: 'eg1', tipus: 'identify', dificultat: 'facil', pregunta: t("Identifica el grÃ fic d'equilibri de mercat:", "Identifica el grÃ¡fico de equilibrio de mercado:", "Identify market equilibrium graph:"), imatge: "oferta_demanda", opcions: ["Phillips", t("Oferta-Demanda", "Oferta-Demanda", "Supply-Demand"), "IS-LM", "Laffer"], correcta: 1 },
            { id: 'eg2', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Quin model macroeconÃ²mic Ã©s aquest?", "Â¿QuÃ© modelo macroeconÃ³mico es este?", "Which macro model is this?"), imatge: "islm", opcions: ["AD-AS", "IS-LM", t("Flux circular", "Flujo circular", "Circular flow"), "Phillips"], correcta: 1 },
            { id: 'eg3', tipus: 'identify', dificultat: 'dificil', pregunta: t("Corba que relaciona impostos i recaptaciÃ³:", "Curva que relaciona impuestos y recaudaciÃ³n:", "Curve relating taxes and revenue:"), imatge: "laffer", opcions: ["Phillips", "Lorenz", "Laffer", "Engel"], correcta: 2 },
            { id: 'ev1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("La inflaciÃ³ Ã©s la pujada generalitzada i sostinguda dels preus", "La inflaciÃ³n es la subida generalizada y sostenida de los precios", "Inflation is the general sustained rise in prices"), correcta: true },
            { id: 'ev2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("La corba de Phillips mostra relaciÃ³ DIRECTA inflaciÃ³-atur", "La curva de Phillips muestra relaciÃ³n DIRECTA inflaciÃ³n-paro", "Phillips curve shows DIRECT inflation-unemployment relation"), correcta: false },
            
            // ========== PREGUNTES APLICADES A SITUACIONS QUOTIDIANES ==========
            // ELASTICITAT APLICADA
            { id: 'ea1', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("â˜• Una cafeteria ven 100 cafÃ¨s/dia a 2â‚¬. Pugen a 2,50â‚¬ i venen 70. La demanda Ã©s...", "â˜• Una cafeterÃ­a vende 100 cafÃ©s/dÃ­a a 2â‚¬. Suben a 2,50â‚¬ y venden 70. La demanda es...", "â˜• A cafÃ© sells 100 coffees/day at â‚¬2. Raise to â‚¬2.50, sell 70. Demand is..."),
              opcions: [t("ElÃ stica (sensible al preu)", "ElÃ¡stica (sensible al precio)", "Elastic"), t("InelÃ stica", "InelÃ¡stica", "Inelastic"), t("UnitÃ ria", "Unitaria", "Unitary"), t("No es pot saber", "No se puede saber", "Can't tell")], correcta: 0, pista: "%Î”Q=-30%, %Î”P=+25%, |Ed|>1" },
            
            { id: 'ea2', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ’Š Per quÃ¨ les farmacÃ¨utiques poden pujar preus de medicines essencials sense perdre vendes?", "ğŸ’Š Â¿Por quÃ© las farmacÃ©uticas pueden subir precios de medicinas esenciales sin perder ventas?", "ğŸ’Š Why can pharma raise essential medicine prices without losing sales?"),
              opcions: [t("Demanda inelÃ stica", "Demanda inelÃ¡stica", "Inelastic demand"), t("Demanda elÃ stica", "Demanda elÃ¡stica", "Elastic demand"), t("Monopoli", "Monopolio", "Monopoly"), t("Publicitat", "Publicidad", "Advertising")], correcta: 0 },
            
            // COST D'OPORTUNITAT
            { id: 'ea3', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ“ La Marta dubta entre estudiar o treballar (1.200â‚¬/mes). Si estudia, quin Ã©s el cost d'oportunitat?", "ğŸ“ Marta duda entre estudiar o trabajar (1.200â‚¬/mes). Si estudia, Â¿cuÃ¡l es el coste de oportunidad?", "ğŸ“ Marta debates studying or working (â‚¬1,200/mo). Opportunity cost of studying?"),
              opcions: [t("Els 1.200â‚¬/mes no guanyats", "Los 1.200â‚¬/mes no ganados", "â‚¬1,200/mo foregone"), t("La matrÃ­cula", "La matrÃ­cula", "Tuition"), t("El temps", "El tiempo", "Time"), t("No n'hi ha", "No hay", "None")], correcta: 0 },
            
            // OFERTA I DEMANDA
            { id: 'ea4', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸŠ Una gelada destrueix el 40% de la collita de taronges. QuÃ¨ passarÃ  amb el preu?", "ğŸŠ Una helada destruye el 40% de la cosecha de naranjas. Â¿QuÃ© pasarÃ¡ con el precio?", "ğŸŠ Frost destroys 40% of orange harvest. What happens to price?"),
              opcions: [t("PujarÃ  (menys oferta)", "SubirÃ¡ (menos oferta)", "Rises (less supply)"), t("BaixarÃ ", "BajarÃ¡", "Falls"), t("Es mantÃ©", "Se mantiene", "Stays same"), t("DepÃ¨n", "Depende", "Depends")], correcta: 0 },
            
            { id: 'ea5', tipus: 'truefalse', dificultat: 'mitjana', 
              pregunta: t("ğŸ“± Si Samsung treu un mÃ²bil millor, la demanda d'iPhone baixarÃ  perquÃ¨ sÃ³n substitutius", "ğŸ“± Si Samsung saca un mÃ³vil mejor, la demanda de iPhone bajarÃ¡ porque son sustitutivos", "ğŸ“± If Samsung releases a better phone, iPhone demand falls (substitutes)"), 
              correcta: true },
            
            // EXTERNALITATS
            { id: 'ea6', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ­ Una fÃ brica contamina un riu i els pescadors perden diners. AixÃ² Ã©s...", "ğŸ­ Una fÃ¡brica contamina un rÃ­o y los pescadores pierden dinero. Esto es...", "ğŸ­ A factory pollutes a river, fishermen lose money. This is..."),
              opcions: [t("Externalitat negativa", "Externalidad negativa", "Negative externality"), t("Externalitat positiva", "Externalidad positiva", "Positive externality"), t("BÃ© pÃºblic", "Bien pÃºblico", "Public good"), t("Monopoli", "Monopolio", "Monopoly")], correcta: 0 },
            
            { id: 'ea7', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ El teu veÃ­ tÃ© abelles i el teu jardÃ­ floreix mÃ©s. AixÃ² Ã©s una externalitat...", "ğŸ Tu vecino tiene abejas y tu jardÃ­n florece mÃ¡s. Esto es una externalidad...", "ğŸ Neighbor has bees, your garden blooms more. Externality is..."),
              opcions: [t("Positiva", "Positiva", "Positive"), t("Negativa", "Negativa", "Negative"), t("Neutra", "Neutra", "Neutral"), t("No Ã©s externalitat", "No es externalidad", "Not externality")], correcta: 0 },
            
            // MONOPOLI NATURAL
            { id: 'ea8', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸš° Per quÃ¨ l'aigua la proporciona una sola empresa a cada ciutat?", "ğŸš° Â¿Por quÃ© el agua la proporciona una sola empresa en cada ciudad?", "ğŸš° Why is water provided by one company per city?"),
              opcions: [t("Monopoli natural (alts CF)", "Monopolio natural (altos CF)", "Natural monopoly (high FC)"), t("Acord empreses", "Acuerdo empresas", "Company agreement"), t("Llei govern", "Ley gobierno", "Gov law"), t("Poca demanda", "Poca demanda", "Low demand")], correcta: 0 },
            
            // INFLACIÃ“
            { id: 'ea9', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ’µ En 1990 un cafÃ¨ costava 0,30â‚¬, ara costa 1,50â‚¬. QuÃ¨ ha passat?", "ğŸ’µ En 1990 un cafÃ© costaba 0,30â‚¬, ahora cuesta 1,50â‚¬. Â¿QuÃ© ha pasado?", "ğŸ’µ In 1990 coffee cost â‚¬0.30, now â‚¬1.50. What happened?"),
              opcions: [t("InflaciÃ³", "InflaciÃ³n", "Inflation"), t("El cafÃ¨ Ã©s millor", "El cafÃ© es mejor", "Coffee is better"), t("Hi ha menys cafÃ¨", "Hay menos cafÃ©", "Less coffee"), t("Error de cÃ lcul", "Error de cÃ¡lculo", "Calculation error")], correcta: 0 },
            
            // PIB
            { id: 'ea10', tipus: 'truefalse', dificultat: 'mitjana', 
              pregunta: t("ğŸ  Si pintem la casa nosaltres, compta al PIB igual que si contractem un pintor", "ğŸ  Si pintamos la casa nosotros, cuenta al PIB igual que si contratamos un pintor", "ğŸ  DIY house painting counts for GDP same as hiring a painter"), 
              correcta: false },
            
            { id: 'ea11', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸš— Compres un cotxe de segona mÃ  per 5.000â‚¬. Afecta el PIB d'enguany?", "ğŸš— Compras un coche de segunda mano por 5.000â‚¬. Â¿Afecta al PIB de este aÃ±o?", "ğŸš— Buy used car for â‚¬5,000. Affects this year's GDP?"),
              opcions: [t("No, ja es va comptar", "No, ya se contÃ³", "No, already counted"), t("SÃ­, 5.000â‚¬ mÃ©s", "SÃ­, 5.000â‚¬ mÃ¡s", "Yes, â‚¬5,000 more"), t("SÃ­, descomptant", "SÃ­, descontando", "Yes, minus deprec."), t("DepÃ¨n del venedor", "Depende del vendedor", "Depends on seller")], correcta: 0 },
            
            // POLÃTICA MONETÃ€RIA
            { id: 'ea12', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ›ï¸ El BCE puja els tipus d'interÃ¨s. QuÃ¨ passarÃ  probablement?", "ğŸ›ï¸ El BCE sube los tipos de interÃ©s. Â¿QuÃ© pasarÃ¡ probablemente?", "ğŸ›ï¸ ECB raises interest rates. What probably happens?"),
              opcions: [t("Hipoteques mÃ©s cares", "Hipotecas mÃ¡s caras", "Pricier mortgages"), t("MÃ©s consum", "MÃ¡s consumo", "More consumption"), t("MÃ©s inversiÃ³", "MÃ¡s inversiÃ³n", "More investment"), t("MÃ©s inflaciÃ³", "MÃ¡s inflaciÃ³n", "More inflation")], correcta: 0 },
            
            // COMERÃ‡ INTERNACIONAL
            { id: 'ea13', tipus: 'multiple', dificultat: 'dificil',
              pregunta: t("ğŸŒ Espanya fa vi bo, Alemanya fa cotxes bons. Segons l'avantatge comparatiu...", "ğŸŒ EspaÃ±a hace vino bueno, Alemania hace coches buenos. SegÃºn la ventaja comparativa...", "ğŸŒ Spain makes good wine, Germany makes good cars. Comparative advantage says..."),
              opcions: [t("Especialitzar-se i comerciar", "Especializarse y comerciar", "Specialize and trade"), t("CadascÃº fa tot", "Cada uno hace todo", "Each makes all"), t("No comerciar", "No comerciar", "Don't trade"), t("Posar aranzels", "Poner aranceles", "Set tariffs")], correcta: 0 },
            
            // BÃ‰NS PÃšBLICS
            { id: 'ea14', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸš’ Els bombers apaguen l'incendi del veÃ­ i tu tambÃ© et beneficies. Els bombers sÃ³n...", "ğŸš’ Los bomberos apagan el incendio del vecino y tÃº tambiÃ©n te beneficias. Los bomberos son...", "ğŸš’ Firefighters put out neighbor's fire, you benefit too. Firefighters are..."),
              opcions: [t("BÃ© pÃºblic", "Bien pÃºblico", "Public good"), t("BÃ© privat", "Bien privado", "Private good"), t("Externalitat", "Externalidad", "Externality"), t("Monopoli", "Monopolio", "Monopoly")], correcta: 0 },
            
            // TEORIA DE JOCS
            { id: 'ea15', tipus: 'multiple', dificultat: 'dificil',
              pregunta: t("ğŸ›’ Mercadona i Carrefour es fan guerra de preus. Si tots dos baixen, tots perden marge. Quin Ã©s l'equilibri de Nash?", "ğŸ›’ Mercadona y Carrefour guerra de precios. Si ambos bajan, pierden margen. Â¿Equilibrio de Nash?", "ğŸ›’ Mercadona & Carrefour price war. If both lower, both lose margin. Nash equilibrium?"),
              opcions: [t("Tots dos baixen", "Ambos bajan", "Both lower"), t("Tots dos mantenen", "Ambos mantienen", "Both maintain"), t("Un baixa, altre no", "Uno baja, otro no", "One lowers, other not"), t("DepÃ¨n", "Depende", "Depends")], correcta: 0, pista: t("Com el dilema del presoner", "Como el dilema del prisionero", "Like prisoner's dilemma") },
            
            // PUNT MORT APLICAT
            { id: 'ea16', tipus: 'numeric', dificultat: 'mitjana', 
              pregunta: t("ğŸ• Pizzeria: CF=2.000â‚¬/mes, cada pizza costa 3â‚¬ fer-la, es ven a 10â‚¬. Quantes pizzes ha de vendre per cobrir costos?", "ğŸ• PizzerÃ­a: CF=2.000â‚¬/mes, cada pizza cuesta 3â‚¬ hacerla, se vende a 10â‚¬. Â¿CuÃ¡ntas pizzas debe vender para cubrir costes?", "ğŸ• Pizzeria: FC=â‚¬2,000/mo, each pizza costs â‚¬3 to make, sells for â‚¬10. Pizzas to break even?"), 
              correcta: 286, tolerancia: 5, pista: "PM = CF / (P - CVu) = 2000 / 7" },
        ],
        finances: [
            // TIPUS INTERACTIU: click_chart - Clica on comprar/vendre
            { id: 'fi1', tipus: 'click_chart', dificultat: 'facil', 
              pregunta: t("ğŸ“ˆ Clica on COMPRAR (punt mÃ©s baix)", "ğŸ“ˆ Haz clic donde COMPRAR (punto mÃ¡s bajo)", "ğŸ“ˆ Click where to BUY (lowest point)"),
              chartData: [100, 95, 88, 82, 78, 75, 80, 85, 92, 98, 105, 110],
              correctZone: { min: 4, max: 6 }, // Ã­ndexs correctes
              pista: t("Compra baix, ven alt!", "Â¡Compra bajo, vende alto!", "Buy low, sell high!") },
            { id: 'fi2', tipus: 'click_chart', dificultat: 'facil',
              pregunta: t("ğŸ“‰ Clica on VENDRE (punt mÃ©s alt)", "ğŸ“‰ Haz clic donde VENDER (punto mÃ¡s alto)", "ğŸ“‰ Click where to SELL (highest point)"),
              chartData: [50, 55, 62, 70, 78, 85, 82, 75, 68, 60, 55, 52],
              correctZone: { min: 4, max: 6 },
              pista: t("Busca el mÃ xim!", "Â¡Busca el mÃ¡ximo!", "Find the peak!") },
            { id: 'fi3', tipus: 'click_chart', dificultat: 'mitjana',
              pregunta: t("ğŸ¯ Identifica el SUPORT (on el preu rebota)", "ğŸ¯ Identifica el SOPORTE (donde el precio rebota)", "ğŸ¯ Identify SUPPORT (where price bounces)"),
              chartData: [100, 92, 85, 80, 82, 88, 84, 80, 83, 90, 86, 80, 85],
              correctZone: { min: 2, max: 4 },
              pista: t("El suport Ã©s un nivell on el preu no baixa mÃ©s", "El soporte es un nivel donde el precio no baja mÃ¡s", "Support is a level where price doesn't fall further") },
              
            // TIPUS INTERACTIU: allocate - Distribueix la cartera
            { id: 'fa1', tipus: 'allocate', dificultat: 'mitjana',
              pregunta: t("ğŸ’¼ Perfil CONSERVADOR (60 anys, jubilaciÃ³ propera). Distribueix la cartera:", "ğŸ’¼ Perfil CONSERVADOR (60 aÃ±os, jubilaciÃ³n cercana). Distribuye la cartera:", "ğŸ’¼ CONSERVATIVE profile (60yo, near retirement). Allocate portfolio:"),
              assets: [
                { nom: t("Renda Fixa", "Renta Fija", "Bonds"), icon: "ğŸ¦", color: "blue" },
                { nom: t("Accions", "Acciones", "Stocks"), icon: "ğŸ“ˆ", color: "green" },
                { nom: t("Liquiditat", "Liquidez", "Cash"), icon: "ğŸ’µ", color: "amber" }
              ],
              correctRanges: { 0: [50, 70], 1: [15, 35], 2: [10, 25] },
              pista: t("Conservador = mÃ©s renda fixa, menys risc", "Conservador = mÃ¡s renta fija, menos riesgo", "Conservative = more bonds, less risk") },
            { id: 'fa2', tipus: 'allocate', dificultat: 'facil',
              pregunta: t("ğŸ’¼ Perfil AGRESSIU (25 anys, horitzÃ³ llarg). Distribueix la cartera:", "ğŸ’¼ Perfil AGRESIVO (25 aÃ±os, horizonte largo). Distribuye la cartera:", "ğŸ’¼ AGGRESSIVE profile (25yo, long horizon). Allocate portfolio:"),
              assets: [
                { nom: t("Renda Fixa", "Renta Fija", "Bonds"), icon: "ğŸ¦", color: "blue" },
                { nom: t("Accions", "Acciones", "Stocks"), icon: "ğŸ“ˆ", color: "green" },
                { nom: t("Liquiditat", "Liquidez", "Cash"), icon: "ğŸ’µ", color: "amber" }
              ],
              correctRanges: { 0: [5, 25], 1: [60, 85], 2: [5, 20] },
              pista: t("Jove = mÃ©s temps per recuperar pÃ¨rdues", "Joven = mÃ¡s tiempo para recuperar pÃ©rdidas", "Young = more time to recover losses") },
              
            // TIPUS INTERACTIU: scenario - Escenaris de decisiÃ³
            { id: 'fs1', tipus: 'scenario', dificultat: 'mitjana',
              pregunta: t("ğŸ  Tens 30.000â‚¬ estalviats. Vols comprar pis (entrada 40.000â‚¬). QuÃ¨ fas?", "ğŸ  Tienes 30.000â‚¬ ahorrados. Quieres comprar piso (entrada 40.000â‚¬). Â¿QuÃ© haces?", "ğŸ  You have â‚¬30,000 saved. Want to buy flat (down payment â‚¬40,000). What do you do?"),
              opcions: [
                { text: t("Esperar i estalviar mÃ©s", "Esperar y ahorrar mÃ¡s", "Wait and save more"), icon: "â³", correcta: true },
                { text: t("Demanar prÃ©stec personal per la diferÃ¨ncia", "Pedir prÃ©stamo personal por la diferencia", "Get personal loan for difference"), icon: "ğŸ’³", correcta: false },
                { text: t("Invertir els 30.000â‚¬ en cripto per duplicar-los", "Invertir los 30.000â‚¬ en cripto para duplicarlos", "Invest â‚¬30,000 in crypto to double it"), icon: "ğŸ°", correcta: false },
                { text: t("Comprar pis mÃ©s barat amb menys entrada", "Comprar piso mÃ¡s barato con menos entrada", "Buy cheaper flat with less down payment"), icon: "ğŸ˜ï¸", correcta: true }
              ],
              multipleCorrect: true,
              pista: t("Evita endeutar-te amb prÃ©stecs cars!", "Â¡Evita endeudarte con prÃ©stamos caros!", "Avoid expensive debt!") },
            { id: 'fs2', tipus: 'scenario', dificultat: 'facil',
              pregunta: t("ğŸ’¸ Reps 5.000â‚¬ inesperats. Tens deute de targeta al 20% TAE. QuÃ¨ fas PRIMER?", "ğŸ’¸ Recibes 5.000â‚¬ inesperados. Tienes deuda de tarjeta al 20% TAE. Â¿QuÃ© haces PRIMERO?", "ğŸ’¸ You receive unexpected â‚¬5,000. Have credit card debt at 20% APR. What do you do FIRST?"),
              opcions: [
                { text: t("Pagar el deute de la targeta", "Pagar la deuda de la tarjeta", "Pay off credit card debt"), icon: "ğŸ’³", correcta: true },
                { text: t("Invertir en borsa", "Invertir en bolsa", "Invest in stocks"), icon: "ğŸ“ˆ", correcta: false },
                { text: t("Anar de vacances", "Ir de vacaciones", "Go on vacation"), icon: "âœˆï¸", correcta: false },
                { text: t("Guardar-ho tot al banc", "Guardarlo todo en el banco", "Keep it all in bank"), icon: "ğŸ¦", correcta: false }
              ],
              pista: t("El 20% Ã©s molt difÃ­cil de superar invertint!", "Â¡El 20% es muy difÃ­cil de superar invirtiendo!", "20% is very hard to beat by investing!") },
            { id: 'fs3', tipus: 'scenario', dificultat: 'dificil',
              pregunta: t("ğŸ“Š Mercat cau 30%. La teua cartera tambÃ©. QuÃ¨ fas?", "ğŸ“Š El mercado cae 30%. Tu cartera tambiÃ©n. Â¿QuÃ© haces?", "ğŸ“Š Market drops 30%. Your portfolio too. What do you do?"),
              opcions: [
                { text: t("Vendre tot per evitar mÃ©s pÃ¨rdues", "Vender todo para evitar mÃ¡s pÃ©rdidas", "Sell everything to avoid more losses"), icon: "ğŸƒ", correcta: false },
                { text: t("Mantenir i esperar la recuperaciÃ³", "Mantener y esperar la recuperaciÃ³n", "Hold and wait for recovery"), icon: "ğŸ§˜", correcta: true },
                { text: t("Comprar mÃ©s aprofitant els preus baixos", "Comprar mÃ¡s aprovechando los precios bajos", "Buy more taking advantage of low prices"), icon: "ğŸ›’", correcta: true },
                { text: t("Moure-ho tot a cripto", "Moverlo todo a cripto", "Move everything to crypto"), icon: "ğŸª™", correcta: false }
              ],
              multipleCorrect: true,
              pista: t("Vendre en pÃ nic cristalÂ·litza les pÃ¨rdues!", "Â¡Vender en pÃ¡nico cristaliza las pÃ©rdidas!", "Panic selling locks in losses!") },
              
            // TIPUS: slider_value - Ajusta per trobar el valor correcte
            { id: 'fsl1', tipus: 'slider_value', dificultat: 'facil',
              pregunta: t("ğŸšï¸ Regla del 50/30/20: Quin % del sou hauries de destinar a ESTALVI?", "ğŸšï¸ Regla del 50/30/20: Â¿QuÃ© % del sueldo deberÃ­as destinar a AHORRO?", "ğŸšï¸ 50/30/20 Rule: What % of salary should go to SAVINGS?"),
              min: 0, max: 50, correcta: 20, tolerancia: 2,
              labels: { left: "0%", right: "50%" },
              pista: "50% necessitats, 30% desitjos, 20% estalvi" },
            { id: 'fsl2', tipus: 'slider_value', dificultat: 'mitjana',
              pregunta: t("ğŸšï¸ Fons d'emergÃ¨ncia: Quants MESOS de despeses hauries de tenir?", "ğŸšï¸ Fondo de emergencia: Â¿CuÃ¡ntos MESES de gastos deberÃ­as tener?", "ğŸšï¸ Emergency fund: How many MONTHS of expenses should you have?"),
              min: 1, max: 12, correcta: 6, tolerancia: 1,
              labels: { left: "1 mes", right: "12 mesos" },
              pista: t("Entre 3 i 6 mesos Ã©s l'estÃ ndard", "Entre 3 y 6 meses es el estÃ¡ndar", "3-6 months is standard") },
              
            // TIPUS: match_risk - Relaciona producte amb nivell de risc
            { id: 'fm1', tipus: 'match_risk', dificultat: 'mitjana',
              pregunta: t("ğŸ¯ Ordena de MENYS a MÃ‰S risc:", "ğŸ¯ Ordena de MENOS a MÃS riesgo:", "ğŸ¯ Order from LESS to MORE risk:"),
              elements: [
                { nom: t("DipÃ²sit bancari", "DepÃ³sito bancario", "Bank deposit"), icon: "ğŸ¦" },
                { nom: t("Bons govern", "Bonos gobierno", "Gov bonds"), icon: "ğŸ“œ" },
                { nom: t("Fons indexat", "Fondo indexado", "Index fund"), icon: "ğŸ“Š" },
                { nom: t("Accions individuals", "Acciones individuales", "Individual stocks"), icon: "ğŸ“ˆ" },
                { nom: t("Criptomonedes", "Criptomonedas", "Crypto"), icon: "ğŸª™" }
              ],
              ordreCorrecte: [0, 1, 2, 3, 4] },
              
            // Preguntes mÃ©s tradicionals perÃ² amb context prÃ ctic
            { id: 'ft1', tipus: 'truefalse', dificultat: 'facil', 
              pregunta: t("ğŸ’¡ Si inverteixes 10.000â‚¬ al 7% anual, en 10 anys tindrÃ s aproximadament 20.000â‚¬ (regla del 72)", "ğŸ’¡ Si inviertes 10.000â‚¬ al 7% anual, en 10 aÃ±os tendrÃ¡s aproximadamente 20.000â‚¬ (regla del 72)", "ğŸ’¡ If you invest â‚¬10,000 at 7% annually, in 10 years you'll have approximately â‚¬20,000 (rule of 72)"), 
              correcta: true },
            { id: 'ft2', tipus: 'truefalse', dificultat: 'mitjana', 
              pregunta: t("ğŸ’¡ Un ETF Ã©s mÃ©s arriscat que una acciÃ³ individual perquÃ¨ tÃ© mÃ©s volatilitat", "ğŸ’¡ Un ETF es mÃ¡s arriesgado que una acciÃ³n individual porque tiene mÃ¡s volatilidad", "ğŸ’¡ An ETF is riskier than an individual stock because it has more volatility"), 
              correcta: false },
            { id: 'ft3', tipus: 'truefalse', dificultat: 'facil', 
              pregunta: t("ğŸ’¡ Si la inflaciÃ³ Ã©s del 3% i el teu compte et dona 1%, estÃ s perdent poder adquisitiu", "ğŸ’¡ Si la inflaciÃ³n es del 3% y tu cuenta te da 1%, estÃ¡s perdiendo poder adquisitivo", "ğŸ’¡ If inflation is 3% and your account gives 1%, you're losing purchasing power"), 
              correcta: true },
            { id: 'fn1', tipus: 'numeric', dificultat: 'facil', 
              pregunta: t("ğŸ§® Regla del 72: A quin % anual es duplica el capital en 12 anys?", "ğŸ§® Regla del 72: Â¿A quÃ© % anual se duplica el capital en 12 aÃ±os?", "ğŸ§® Rule of 72: At what annual % does capital double in 12 years?"), 
              correcta: 6, tolerancia: 0, pista: "72 / anys = interÃ¨s" },
            { id: 'fn2', tipus: 'numeric', dificultat: 'mitjana', 
              pregunta: t("ğŸ§® Estalvies 200â‚¬/mes durant 5 anys sense interessos. Total?", "ğŸ§® Ahorras 200â‚¬/mes durante 5 aÃ±os sin intereses. Â¿Total?", "ğŸ§® Save â‚¬200/month for 5 years with no interest. Total?"), 
              correcta: 12000, tolerancia: 0, pista: "200 Ã— 12 Ã— 5" },
            // NOVES PREGUNTES FINANCES
            { id: 'fn3', tipus: 'numeric', dificultat: 'facil', pregunta: t("ğŸ§® Rendibilitat: Compres per 100â‚¬, vens per 120â‚¬. Rendib %?", "ğŸ§® Rentabilidad: Compras por 100â‚¬, vendes por 120â‚¬. Â¿Rentab %?", "ğŸ§® Return: Buy for â‚¬100, sell for â‚¬120. Return %?"), correcta: 20, tolerancia: 0, pista: "((Venda-Compra)/Compra)Ã—100" },
            { id: 'fn4', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("ğŸ§® InterÃ¨s simple: Capital 5.000â‚¬, 4% anual, 2 anys. Interessos?", "ğŸ§® InterÃ©s simple: Capital 5.000â‚¬, 4% anual, 2 aÃ±os. Â¿Intereses?", "ğŸ§® Simple interest: â‚¬5,000, 4% annual, 2 years. Interest?"), correcta: 400, tolerancia: 0, pista: "C Ã— i Ã— t" },
            { id: 'fn5', tipus: 'numeric', dificultat: 'dificil', pregunta: t("ğŸ§® Valor futur compost: 1.000â‚¬ al 10% durant 3 anys. VF? (arrodonit)", "ğŸ§® Valor futuro compuesto: 1.000â‚¬ al 10% durante 3 aÃ±os. Â¿VF? (redondeado)", "ğŸ§® Compound FV: â‚¬1,000 at 10% for 3 years. FV? (rounded)"), correcta: 1331, tolerancia: 5, pista: "VF = VA Ã— (1+i)^n" },
            { id: 'fn6', tipus: 'numeric', dificultat: 'facil', pregunta: t("ğŸ§® Quota prÃ©stec simple: 12.000â‚¬ en 12 mesos sense interessos. Quota?", "ğŸ§® Cuota prÃ©stamo simple: 12.000â‚¬ en 12 meses sin intereses. Â¿Cuota?", "ğŸ§® Simple loan payment: â‚¬12,000 in 12 months, no interest. Payment?"), correcta: 1000, tolerancia: 0, pista: "Capital / Mesos" },
            { id: 'fn7', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("ğŸ§® PER (Price Earnings Ratio): Preu acciÃ³=50â‚¬, BPA=5â‚¬. PER?", "ğŸ§® PER (Price Earnings Ratio): Precio acciÃ³n=50â‚¬, BPA=5â‚¬. Â¿PER?", "ğŸ§® P/E Ratio: Share price=â‚¬50, EPS=â‚¬5. P/E?"), correcta: 10, tolerancia: 0, pista: "Preu / BPA" },
            { id: 'fn8', tipus: 'numeric', dificultat: 'dificil', pregunta: t("ğŸ§® Dividend yield: Dividend=2â‚¬, Preu acciÃ³=40â‚¬. Yield %?", "ğŸ§® Dividend yield: Dividendo=2â‚¬, Precio acciÃ³n=40â‚¬. Â¿Yield %?", "ğŸ§® Dividend yield: Dividend=â‚¬2, Share price=â‚¬40. Yield %?"), correcta: 5, tolerancia: 0, pista: "(Dividend/Preu)Ã—100" },
            { id: 'fm2', tipus: 'multiple', dificultat: 'facil', pregunta: t("Quin actiu tÃ© menys risc?", "Â¿QuÃ© activo tiene menos riesgo?", "Which asset has less risk?"), opcions: [t("Accions", "Acciones", "Stocks"), t("DipÃ²sit bancari", "DepÃ³sito bancario", "Bank deposit"), t("Criptomonedes", "Criptomonedas", "Crypto"), t("Derivats", "Derivados", "Derivatives")], correcta: 1 },
            { id: 'fm3', tipus: 'multiple', dificultat: 'mitjana', pregunta: t("QuÃ¨ Ã©s un ETF?", "Â¿QuÃ© es un ETF?", "What is an ETF?"), opcions: [t("Fons que replica un Ã­ndex", "Fondo que replica un Ã­ndice", "Index-tracking fund"), t("Deute pÃºblic", "Deuda pÃºblica", "Public debt"), t("Moneda virtual", "Moneda virtual", "Virtual currency"), t("AsseguranÃ§a", "Seguro", "Insurance")], correcta: 0 },
            { id: 'fm4', tipus: 'multiple', dificultat: 'facil', pregunta: t("L'interÃ¨s compost...", "El interÃ©s compuesto...", "Compound interest..."), opcions: [t("Genera interessos sobre interessos", "Genera intereses sobre intereses", "Generates interest on interest"), t("Ã‰s sempre fix", "Es siempre fijo", "Is always fixed"), t("NomÃ©s s'aplica a prÃ©stecs", "Solo se aplica a prÃ©stamos", "Only applies to loans"), t("No existeix", "No existe", "Doesn't exist")], correcta: 0 },
            { id: 'fm5', tipus: 'multiple', dificultat: 'dificil', pregunta: t("Un bon diversificat tÃ©:", "Un bono diversificado tiene:", "A diversified portfolio has:"), opcions: [t("Tot en un actiu", "Todo en un activo", "Everything in one asset"), t("Actius correlacionats", "Activos correlacionados", "Correlated assets"), t("Actius poc correlacionats", "Activos poco correlacionados", "Uncorrelated assets"), t("NomÃ©s renda fixa", "Solo renta fija", "Only bonds")], correcta: 2 },
            { id: 'fv1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("ğŸ’¡ Invertir en borsa sempre Ã©s arriscat perÃ² pot donar rendibilitat", "ğŸ’¡ Invertir en bolsa siempre es arriesgado pero puede dar rentabilidad", "ğŸ’¡ Stock investing is always risky but can provide returns"), correcta: true },
            { id: 'fv2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("ğŸ’¡ Un bono del estat Ã©s mÃ©s segur que una acciÃ³", "ğŸ’¡ Un bono del estado es mÃ¡s seguro que una acciÃ³n", "ğŸ’¡ A government bond is safer than a stock"), correcta: true },
            { id: 'fv3', tipus: 'truefalse', dificultat: 'facil', pregunta: t("ğŸ’¡ La diversificaciÃ³ elimina tot el risc", "ğŸ’¡ La diversificaciÃ³n elimina todo el riesgo", "ğŸ’¡ Diversification eliminates all risk"), correcta: false },
            { id: 'fv4', tipus: 'truefalse', dificultat: 'dificil', pregunta: t("ğŸ’¡ El risc sistemÃ tic es pot eliminar amb diversificaciÃ³", "ğŸ’¡ El riesgo sistemÃ¡tico se puede eliminar con diversificaciÃ³n", "ğŸ’¡ Systematic risk can be eliminated with diversification"), correcta: false },
            { id: 'fi4', tipus: 'click_chart', dificultat: 'mitjana',
              pregunta: t("ğŸ“Š Identifica la RESISTÃˆNCIA (on el preu frena pujant)", "ğŸ“Š Identifica la RESISTENCIA (donde el precio frena subiendo)", "ğŸ“Š Identify RESISTANCE (where price stops rising)"),
              chartData: [60, 68, 75, 80, 78, 72, 76, 80, 77, 70, 74, 79, 75],
              correctZone: { min: 2, max: 4 },
              pista: t("La resistÃ¨ncia Ã©s un sostre que el preu no traspassa", "La resistencia es un techo que el precio no traspasa", "Resistance is a ceiling the price doesn't break") },
            { id: 'fi5', tipus: 'click_chart', dificultat: 'dificil',
              pregunta: t("ğŸ“ˆ Identifica el PUNT D'INFLEXIÃ“ (canvi de tendÃ¨ncia)", "ğŸ“ˆ Identifica el PUNTO DE INFLEXIÃ“N (cambio de tendencia)", "ğŸ“ˆ Identify INFLECTION POINT (trend change)"),
              chartData: [50, 48, 45, 42, 40, 38, 40, 44, 48, 53, 58, 64],
              correctZone: { min: 4, max: 6 },
              pista: t("Busca on la tendÃ¨ncia canvia de baixista a alcista", "Busca donde la tendencia cambia de bajista a alcista", "Find where the trend changes from bearish to bullish") },
            { id: 'fo1', tipus: 'order', dificultat: 'facil', pregunta: t("Risc de menor a major:", "Riesgo de menor a mayor:", "Risk from low to high:"), elements: [t("DipÃ²sit", "DepÃ³sito", "Deposit"), t("Bons", "Bonos", "Bonds"), t("Fons indexat", "Fondo indexado", "Index fund"), t("Cripto", "Cripto", "Crypto")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'fo2', tipus: 'order', dificultat: 'mitjana', pregunta: t("HoritzÃ³ inversor tÃ­pic (curtâ†’llarg):", "Horizonte inversor tÃ­pico (cortoâ†’largo):", "Typical investment horizon (shortâ†’long):"), elements: [t("DipÃ²sit", "DepÃ³sito", "Deposit"), t("Bons curt termini", "Bonos corto plazo", "Short bonds"), t("Fons mixt", "Fondo mixto", "Mixed fund"), t("Accions growth", "Acciones growth", "Growth stocks")], ordreCorrecte: [0, 1, 2, 3] },
            
            // ========== PREGUNTES APLICADES FINANCES - SITUACIONS QUOTIDIANES ==========
            // PRESSUPOST I ESTALVI
            { id: 'fap1', tipus: 'numeric', dificultat: 'facil', 
              pregunta: t("ğŸ’° La Laura cobra 1.500â‚¬/mes. Segons la regla 50/30/20, quant hauria d'estalviar?", "ğŸ’° Laura cobra 1.500â‚¬/mes. SegÃºn la regla 50/30/20, Â¿cuÃ¡nto deberÃ­a ahorrar?", "ğŸ’° Laura earns â‚¬1,500/mo. Per 50/30/20 rule, how much to save?"), 
              correcta: 300, tolerancia: 0, pista: "20% de 1.500â‚¬" },
            
            { id: 'fap2', tipus: 'numeric', dificultat: 'facil', 
              pregunta: t("ğŸ†˜ En Marc gasta 1.200â‚¬/mes. Quant hauria de tenir al fons d'emergÃ¨ncia mÃ­nim (3 mesos)?", "ğŸ†˜ Marc gasta 1.200â‚¬/mes. Â¿CuÃ¡nto deberÃ­a tener en fondo de emergencia mÃ­nimo (3 meses)?", "ğŸ†˜ Marc spends â‚¬1,200/mo. Minimum emergency fund (3 months)?"), 
              correcta: 3600, tolerancia: 0, pista: "3 Ã— despeses mensuals" },
            
            // DEUTES
            { id: 'fap3', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ’³ Tens deute de targeta al 20% TAE i prÃ©stec cotxe al 6% TAE. Quin pagues PRIMER?", "ğŸ’³ Tienes deuda de tarjeta al 20% TAE y prÃ©stamo coche al 6% TAE. Â¿CuÃ¡l pagas PRIMERO?", "ğŸ’³ Credit card debt at 20% APR and car loan at 6%. Which pay FIRST?"),
              opcions: [t("Targeta (20%)", "Tarjeta (20%)", "Credit card (20%)"), t("Cotxe (6%)", "Coche (6%)", "Car loan (6%)"), t("A parts iguals", "A partes iguales", "Split equally"), t("Invertir", "Invertir", "Invest")], correcta: 0 },
            
            // INTERÃˆS COMPOST
            { id: 'fap4', tipus: 'numeric', dificultat: 'mitjana', 
              pregunta: t("ğŸ“ˆ Regla del 72: Inverteixes al 7% anual. En quants anys duplicarÃ s el capital?", "ğŸ“ˆ Regla del 72: Inviertes al 7% anual. Â¿En cuÃ¡ntos aÃ±os duplicarÃ¡s?", "ğŸ“ˆ Rule of 72: Invest at 7% annual. Years to double?"), 
              correcta: 10, tolerancia: 1, pista: "72 / tipus interÃ¨s" },
            
            // DIVERSIFICACIÃ“
            { id: 'fap5', tipus: 'truefalse', dificultat: 'facil', 
              pregunta: t("ğŸ° Posar tots els estalvis en accions d'una sola empresa Ã©s una bona estratÃ¨gia de diversificaciÃ³", "ğŸ° Poner todos los ahorros en acciones de una sola empresa es buena diversificaciÃ³n", "ğŸ° Putting all savings in one company's stock is good diversification"), 
              correcta: false },
            
            // FRAUS
            { id: 'fap6', tipus: 'truefalse', dificultat: 'facil', 
              pregunta: t("ğŸš¨ Si algÃº et promet 20% anual 'garantit i sense risc', probablement Ã©s un frau", "ğŸš¨ Si alguien te promete 20% anual 'garantizado y sin riesgo', probablemente es fraude", "ğŸš¨ If someone promises 20% annual 'guaranteed risk-free', it's probably fraud"), 
              correcta: true },
            
            // HIPOTEQUES
            { id: 'fap7', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ  Vols comprar pis de 200.000â‚¬. El banc demana 20% entrada. Quant necessites MÃNIM (amb impostos ~10%)?", "ğŸ  Quieres comprar piso de 200.000â‚¬. El banco pide 20% entrada. Â¿CuÃ¡nto necesitas MÃNIMO (con impuestos ~10%)?", "ğŸ  Want to buy â‚¬200k flat. Bank asks 20% down. Minimum needed (with ~10% taxes)?"),
              opcions: [t("~50-60.000â‚¬", "~50-60.000â‚¬", "~â‚¬50-60k"), t("40.000â‚¬ exacte", "40.000â‚¬ exacto", "Exactly â‚¬40k"), t("20.000â‚¬", "20.000â‚¬", "â‚¬20k"), t("200.000â‚¬", "200.000â‚¬", "â‚¬200k")], correcta: 0, pista: t("Entrada + impostos + despeses", "Entrada + impuestos + gastos", "Down payment + taxes + fees") },
            
            // INFLACIÃ“
            { id: 'fap8', tipus: 'numeric', dificultat: 'facil', 
              pregunta: t("ğŸ’¸ Tens 10.000â‚¬ al banc al 1%. InflaciÃ³ del 3%. Rendiment REAL?", "ğŸ’¸ Tienes 10.000â‚¬ en banco al 1%. InflaciÃ³n del 3%. Â¿Rendimiento REAL?", "ğŸ’¸ â‚¬10,000 in bank at 1%. Inflation 3%. REAL return?"), 
              correcta: -2, tolerancia: 0, pista: "Real â‰ˆ Nominal - InflaciÃ³" },
            
            // ETFs
            { id: 'fap9', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ“Š Avantatge principal dels ETFs indexats vs fons gestiÃ³ activa?", "ğŸ“Š Â¿Ventaja principal de ETFs indexados vs fondos gestiÃ³n activa?", "ğŸ“Š Main advantage of index ETFs vs active funds?"),
              opcions: [t("Comissions mÃ©s baixes", "Comisiones mÃ¡s bajas", "Lower fees"), t("Sempre guanyen mÃ©s", "Siempre ganan mÃ¡s", "Always earn more"), t("Menys risc", "Menos riesgo", "Less risk"), t("Garantia capital", "GarantÃ­a capital", "Capital guarantee")], correcta: 0 },
            
            // PLANIFICACIÃ“
            { id: 'fap10', tipus: 'order', dificultat: 'facil', 
              pregunta: t("ğŸ“‹ Ordena els passos per sanear finances:", "ğŸ“‹ Ordena los pasos para sanear finanzas:", "ğŸ“‹ Order steps to fix finances:"), 
              elements: [t("Fer pressupost", "Hacer presupuesto", "Make budget"), t("Pagar deutes cars", "Pagar deudas caras", "Pay expensive debts"), t("Fons emergÃ¨ncia", "Fondo emergencia", "Emergency fund"), t("Invertir", "Invertir", "Invest")], 
              ordreCorrecte: [0, 1, 2, 3] },
        ],
        empresa: [
            { id: 'emc1', tipus: 'numeric', dificultat: 'facil', pregunta: t("Punt Mort: CF=15.000â‚¬, P=60â‚¬, CVu=30â‚¬. Unitats?", "Punto Muerto: CF=15.000â‚¬, P=60â‚¬, CVu=30â‚¬. Â¿Unidades?", "Break-even: FC=â‚¬15,000, P=â‚¬60, VCu=â‚¬30. Units?"), correcta: 500, tolerancia: 0, pista: "CF/(P-CVu)" },
            { id: 'emc2', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Cost Total: CF=8.000â‚¬, CVu=15â‚¬, Q=400. CT?", "Coste Total: CF=8.000â‚¬, CVu=15â‚¬, Q=400. Â¿CT?", "Total Cost: FC=â‚¬8,000, VCu=â‚¬15, Q=400. TC?"), correcta: 14000, tolerancia: 0, pista: "CF + CVuÃ—Q" },
            { id: 'emc3', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Productivitat: 10.000u, 25 treballadors. Prod/treballador?", "Productividad: 10.000u, 25 trabajadores. Â¿Prod/trabajador?", "Productivity: 10,000u, 25 workers. Prod/worker?"), correcta: 400, tolerancia: 0, pista: "ProducciÃ³/Treballadors" },
            { id: 'emc4', tipus: 'numeric', dificultat: 'facil', pregunta: t("Marge contribuciÃ³: P=100â‚¬, CVu=60â‚¬. MCu?", "Margen contribuciÃ³n: P=100â‚¬, CVu=60â‚¬. Â¿MCu?", "Contribution margin: P=â‚¬100, VCu=â‚¬60. UCM?"), correcta: 40, tolerancia: 0, pista: "P - CVu" },
            { id: 'emc5', tipus: 'numeric', dificultat: 'dificil', pregunta: t("EOQ: D=10.000u/any, Cp=50â‚¬, Ca=2â‚¬/uÂ·any. Lot Ã²ptim?", "EOQ: D=10.000u/aÃ±o, Cp=50â‚¬, Ca=2â‚¬/uÂ·aÃ±o. Â¿Lote Ã³ptimo?", "EOQ: D=10,000u/yr, Cp=â‚¬50, Ca=â‚¬2/uÂ·yr. Optimal lot?"), correcta: 707, tolerancia: 15, pista: "âˆš(2Ã—DÃ—Cp/Ca)" },
            { id: 'emc6', tipus: 'numeric', dificultat: 'facil', pregunta: t("Benefici: Ingressos=200.000â‚¬, Costos=150.000â‚¬. Benefici?", "Beneficio: Ingresos=200.000â‚¬, Costes=150.000â‚¬. Â¿Beneficio?", "Profit: Revenue=â‚¬200,000, Costs=â‚¬150,000. Profit?"), correcta: 50000, tolerancia: 0, pista: "Ingressos - Costos" },
            { id: 'emc7', tipus: 'numeric', dificultat: 'facil', pregunta: t("Salari net: Brut=2.000â‚¬, SS=127â‚¬, IRPF=300â‚¬. Net?", "Salario neto: Bruto=2.000â‚¬, SS=127â‚¬, IRPF=300â‚¬. Â¿Neto?", "Net salary: Gross=â‚¬2,000, SS=â‚¬127, Tax=â‚¬300. Net?"), correcta: 1573, tolerancia: 0, pista: "Brut - SS - IRPF" },
            { id: 'emc8', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Apalancament operatiu: MC=50.000â‚¬, BAII=20.000â‚¬. Grau?", "Apalancamiento operativo: MC=50.000â‚¬, BAII=20.000â‚¬. Â¿Grado?", "Operating leverage: CM=â‚¬50,000, EBIT=â‚¬20,000. Degree?"), correcta: 2.5, tolerancia: 0.1, pista: "MC/BAII" },
            { id: 'emo1', tipus: 'order', dificultat: 'facil', pregunta: t("PirÃ mide Maslow (baixâ†’dalt):", "PirÃ¡mide Maslow (abajoâ†’arriba):", "Maslow pyramid (bottomâ†’top):"), elements: [t("FisiolÃ²giques", "FisiolÃ³gicas", "Physiological"), t("Seguretat", "Seguridad", "Safety"), t("Socials", "Sociales", "Social"), t("Estima", "Estima", "Esteem"), t("AutorealitzaciÃ³", "AutorrealizaciÃ³n", "Self-actualization")], ordreCorrecte: [0, 1, 2, 3, 4] },
            { id: 'emo2', tipus: 'order', dificultat: 'mitjana', pregunta: t("Cicle vida producte:", "Ciclo vida producto:", "Product life cycle:"), elements: [t("IntroducciÃ³", "IntroducciÃ³n", "Introduction"), t("Creixement", "Crecimiento", "Growth"), t("Maduresa", "Madurez", "Maturity"), t("Declivi", "Declive", "Decline")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo3', tipus: 'order', dificultat: 'mitjana', pregunta: t("ProcÃ©s selecciÃ³ personal:", "Proceso selecciÃ³n personal:", "Staff selection process:"), elements: [t("AnÃ lisi lloc", "AnÃ¡lisis puesto", "Job analysis"), t("Reclutament", "Reclutamiento", "Recruitment"), t("Entrevistes", "Entrevistas", "Interviews"), t("ContractaciÃ³", "ContrataciÃ³n", "Hiring")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo4', tipus: 'order', dificultat: 'facil', pregunta: t("Capital mÃ­nim (Espanya) menorâ†’major:", "Capital mÃ­nimo (EspaÃ±a) menorâ†’mayor:", "Min capital (Spain) lowâ†’high:"), elements: [t("AutÃ²nom", "AutÃ³nomo", "Self-empl."), "SL (1â‚¬)", "SL (3.000â‚¬)", "SA (60.000â‚¬)"], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emi1', tipus: 'identify', dificultat: 'facil', pregunta: t("Identifica la matriu:", "Identifica la matriz:", "Identify the matrix:"), imatge: "bcg", opcions: ["DAFO", "Ansoff", "BCG", "Porter"], correcta: 2 },
            { id: 'emi2', tipus: 'identify', dificultat: 'mitjana', pregunta: t("BCG: Alta quota + Alt creixement =", "BCG: Alta cuota + Alto crecimiento =", "BCG: High share + High growth ="), imatge: "bcg", opcions: [t("Vaca", "Vaca", "Cash Cow"), t("Estrella", "Estrella", "Star"), t("Interrogant", "Interrogante", "Question"), t("Gos", "Perro", "Dog")], correcta: 1 },
            { id: 'emi3', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Ansoff: Producte NOU + Mercat NOU =", "Ansoff: Producto NUEVO + Mercado NUEVO =", "Ansoff: NEW Product + NEW Market ="), imatge: "ansoff", opcions: [t("PenetraciÃ³", "PenetraciÃ³n", "Penetration"), t("Desenv. mercat", "Desarrollo mercado", "Market dev."), t("Desenv. producte", "Desarrollo producto", "Product dev."), t("DiversificaciÃ³", "DiversificaciÃ³n", "Diversification")], correcta: 3 },
            { id: 'emi4', tipus: 'identify', dificultat: 'dificil', pregunta: t("Canvas: 'Per quÃ¨ ens trien' =", "Canvas: 'Por quÃ© nos eligen' =", "Canvas: 'Why they choose us' ="), imatge: "canvas", opcions: [t("Segments", "Segmentos", "Segments"), t("Proposta valor", "Propuesta valor", "Value prop."), t("Canals", "Canales", "Channels"), t("Recursos", "Recursos", "Resources")], correcta: 1 },
            { id: 'emi5', tipus: 'identify', dificultat: 'facil', pregunta: t("DAFO: Amenaces sÃ³n factors...", "DAFO: Amenazas son factores...", "SWOT: Threats are factors..."), imatge: "dafo", opcions: [t("Interns +", "Internos +", "Internal +"), t("Interns -", "Internos -", "Internal -"), t("Externs +", "Externos +", "External +"), t("Externs -", "Externos -", "External -")], correcta: 3 },
            { id: 'emi6', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Porter: Quantes forces?", "Porter: Â¿CuÃ¡ntas fuerzas?", "Porter: How many forces?"), imatge: "porter", opcions: ["3", "4", "5", "6"], correcta: 2 },
            { id: 'emf1', tipus: 'formula', dificultat: 'facil', pregunta: t("Punt Mort = CF / (P - ___)", "Punto Muerto = CF / (P - ___)", "Break-even = FC / (P - ___)"), opcions: ["CVu", "CT", "CF", "MC"], correcta: 0 },
            { id: 'emf2', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Productivitat = ___ / Recursos", "Productividad = ___ / Recursos", "Productivity = ___ / Resources"), opcions: [t("ProducciÃ³", "ProducciÃ³n", "Output"), t("Benefici", "Beneficio", "Profit"), t("Vendes", "Ventas", "Sales"), t("Costos", "Costes", "Costs")], correcta: 0 },
            { id: 'emf3', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Cost Total = CF + CVu Ã— ___", "Coste Total = CF + CVu Ã— ___", "Total Cost = FC + VCu Ã— ___"), opcions: ["Q", "P", "MC", "CT"], correcta: 0 },
            { id: 'emf4', tipus: 'formula', dificultat: 'dificil', pregunta: "EOQ = âˆš(2Ã—DÃ—Cp / ___)", opcions: ["Ca", "Cv", "CF", "P"], correcta: 0 },
            { id: 'emv1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("SL: responsabilitat limitada al capital aportat", "SL: responsabilidad limitada al capital aportado", "LLC: liability limited to contributed capital"), correcta: true },
            { id: 'emv2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("Herzberg: el salari Ã©s factor MOTIVADOR", "Herzberg: el salario es factor MOTIVADOR", "Herzberg: salary is a MOTIVATING factor"), correcta: false },
            // NOVES PREGUNTES EMPRESA
            { id: 'emc9', tipus: 'numeric', dificultat: 'facil', pregunta: t("ROI: Benefici=10.000â‚¬, InversiÃ³=50.000â‚¬. ROI %?", "ROI: Beneficio=10.000â‚¬, InversiÃ³n=50.000â‚¬. Â¿ROI %?", "ROI: Profit=â‚¬10,000, Investment=â‚¬50,000. ROI %?"), correcta: 20, tolerancia: 0, pista: "(Benefici/InversiÃ³)Ã—100" },
            { id: 'emc10', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Marge Benefici: Vendes=100.000â‚¬, Benefici=15.000â‚¬. Marge %?", "Margen Beneficio: Ventas=100.000â‚¬, Beneficio=15.000â‚¬. Â¿Margen %?", "Profit Margin: Sales=â‚¬100,000, Profit=â‚¬15,000. Margin %?"), correcta: 15, tolerancia: 0, pista: "(Benefici/Vendes)Ã—100" },
            { id: 'emc11', tipus: 'numeric', dificultat: 'facil', pregunta: t("Treballadors necessaris: ProducciÃ³=6.000u, Productivitat=200u/treb. Quants?", "Trabajadores necesarios: ProducciÃ³n=6.000u, Productividad=200u/trab. Â¿CuÃ¡ntos?", "Workers needed: Output=6,000u, Productivity=200u/worker. How many?"), correcta: 30, tolerancia: 0, pista: "ProducciÃ³/Productivitat" },
            { id: 'emc12', tipus: 'numeric', dificultat: 'dificil', pregunta: t("RotaciÃ³ estoc: Vendes=120.000â‚¬, Estoc mitjÃ =20.000â‚¬. RotaciÃ³?", "RotaciÃ³n stock: Ventas=120.000â‚¬, Stock medio=20.000â‚¬. Â¿RotaciÃ³n?", "Inventory turnover: Sales=â‚¬120,000, Avg inventory=â‚¬20,000. Turnover?"), correcta: 6, tolerancia: 0, pista: "Vendes/Estoc" },
            { id: 'emc13', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Quota mercat: Vendes empresa=50Mâ‚¬, Vendes sector=500Mâ‚¬. Quota %?", "Cuota mercado: Ventas empresa=50Mâ‚¬, Ventas sector=500Mâ‚¬. Â¿Cuota %?", "Market share: Company sales=â‚¬50M, Sector=â‚¬500M. Share %?"), correcta: 10, tolerancia: 0, pista: "(Vendes emp/Vendes sector)Ã—100" },
            { id: 'emc14', tipus: 'numeric', dificultat: 'facil', pregunta: t("Cost mig: CT=50.000â‚¬, Q=1.000u. CMi?", "Coste medio: CT=50.000â‚¬, Q=1.000u. Â¿CMe?", "Average cost: TC=â‚¬50,000, Q=1,000u. AC?"), correcta: 50, tolerancia: 0, pista: "CT/Q" },
            { id: 'emc15', tipus: 'numeric', dificultat: 'dificil', pregunta: t("VAN: InversiÃ³=10.000â‚¬, Flux any 1=6.000â‚¬, Flux any 2=6.000â‚¬, i=10%. VAN aprox?", "VAN: InversiÃ³n=10.000â‚¬, Flujo aÃ±o 1=6.000â‚¬, Flujo aÃ±o 2=6.000â‚¬, i=10%. Â¿VAN aprox?", "NPV: Investment=â‚¬10,000, CF1=â‚¬6,000, CF2=â‚¬6,000, i=10%. Approx NPV?"), correcta: 413, tolerancia: 50, pista: "VAN = -I + F1/(1+i) + F2/(1+i)Â²" },
            { id: 'emm1', tipus: 'multiple', dificultat: 'facil', pregunta: t("Les 4 P del mÃ rqueting sÃ³n:", "Las 4 P del marketing son:", "The 4 P's of marketing are:"), opcions: [t("Producte, Preu, PromociÃ³, DistribuciÃ³", "Producto, Precio, PromociÃ³n, DistribuciÃ³n", "Product, Price, Promotion, Place"), t("Persona, ProcÃ©s, Producte, PosiciÃ³", "Persona, Proceso, Producto, PosiciÃ³n", "Person, Process, Product, Position"), t("Pla, ProducciÃ³, Personal, Preus", "Plan, ProducciÃ³n, Personal, Precios", "Plan, Production, Personnel, Prices"), t("Cap de les anteriors", "Ninguna de las anteriores", "None of the above")], correcta: 0 },
            { id: 'emm2', tipus: 'multiple', dificultat: 'mitjana', pregunta: t("El lideratge transformacional es caracteritza per:", "El liderazgo transformacional se caracteriza por:", "Transformational leadership is characterized by:"), opcions: [t("Control estricte", "Control estricto", "Strict control"), t("Inspirar i motivar canvis", "Inspirar y motivar cambios", "Inspire and motivate change"), t("Deixar fer", "Dejar hacer", "Laissez-faire"), t("Premis i cÃ stigs", "Premios y castigos", "Rewards and punishments")], correcta: 1 },
            { id: 'emm3', tipus: 'multiple', dificultat: 'facil', pregunta: t("QuÃ¨ Ã©s el capital social d'una empresa?", "Â¿QuÃ© es el capital social de una empresa?", "What is a company's share capital?"), opcions: [t("Els diners en caixa", "El dinero en caja", "Cash on hand"), t("L'aportaciÃ³ dels socis", "La aportaciÃ³n de los socios", "Shareholders' contribution"), t("Els prÃ©stecs bancaris", "Los prÃ©stamos bancarios", "Bank loans"), t("Els beneficis acumulats", "Los beneficios acumulados", "Retained earnings")], correcta: 1 },
            { id: 'emm4', tipus: 'multiple', dificultat: 'dificil', pregunta: t("La Teoria X de McGregor assumeix que els treballadors:", "La TeorÃ­a X de McGregor asume que los trabajadores:", "McGregor's Theory X assumes workers:"), opcions: [t("Busquen responsabilitats", "Buscan responsabilidades", "Seek responsibility"), t("Eviten treballar", "Evitan trabajar", "Avoid work"), t("S'automotiven", "Se automotivan", "Self-motivate"), t("SÃ³n creatius", "Son creativos", "Are creative")], correcta: 1 },
            { id: 'emm5', tipus: 'multiple', dificultat: 'mitjana', pregunta: t("El Just-in-Time (JIT) busca:", "El Just-in-Time (JIT) busca:", "Just-in-Time (JIT) aims to:"), opcions: [t("Maximitzar estocs", "Maximizar stocks", "Maximize inventory"), t("Eliminar malbaratament", "Eliminar desperdicio", "Eliminate waste"), t("Produir per avanÃ§at", "Producir por adelantado", "Produce in advance"), t("Augmentar costos", "Aumentar costes", "Increase costs")], correcta: 1 },
            { id: 'emv3', tipus: 'truefalse', dificultat: 'facil', pregunta: t("L'organigrama mostra l'estructura jerÃ rquica de l'empresa", "El organigrama muestra la estructura jerÃ¡rquica de la empresa", "The org chart shows the company's hierarchical structure"), correcta: true },
            { id: 'emv4', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("El capital circulant inclou els edificis i maquinÃ ria", "El capital circulante incluye los edificios y maquinaria", "Working capital includes buildings and machinery"), correcta: false },
            { id: 'emv5', tipus: 'truefalse', dificultat: 'dificil', pregunta: t("Un VAN negatiu indica que la inversiÃ³ Ã©s rendible", "Un VAN negativo indica que la inversiÃ³n es rentable", "A negative NPV indicates the investment is profitable"), correcta: false },
            { id: 'emv6', tipus: 'truefalse', dificultat: 'facil', pregunta: t("La missiÃ³ d'una empresa defineix la raÃ³ de ser", "La misiÃ³n de una empresa define la razÃ³n de ser", "A company's mission defines its purpose"), correcta: true },
            { id: 'emo5', tipus: 'order', dificultat: 'mitjana', pregunta: t("Funcions direcciÃ³ (ordre clÃ ssic):", "Funciones direcciÃ³n (orden clÃ¡sico):", "Management functions (classic order):"), elements: [t("Planificar", "Planificar", "Plan"), t("Organitzar", "Organizar", "Organize"), t("Dirigir", "Dirigir", "Direct"), t("Controlar", "Controlar", "Control")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo6', tipus: 'order', dificultat: 'dificil', pregunta: t("Grau control directiu (menysâ†’mÃ©s):", "Grado control directivo (menosâ†’mÃ¡s):", "Management control (lessâ†’more):"), elements: [t("Laissez-faire", "Laissez-faire", "Laissez-faire"), t("DemocrÃ tic", "DemocrÃ¡tico", "Democratic"), t("Paternalista", "Paternalista", "Paternalistic"), t("Autoritari", "Autoritario", "Authoritarian")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emf5', tipus: 'formula', dificultat: 'facil', pregunta: t("Benefici = Ingressos - ___", "Beneficio = Ingresos - ___", "Profit = Revenue - ___"), opcions: [t("Costos", "Costes", "Costs"), t("Actiu", "Activo", "Assets"), t("Passiu", "Pasivo", "Liabilities"), t("Capital", "Capital", "Capital")], correcta: 0 },
            { id: 'emf6', tipus: 'formula', dificultat: 'mitjana', pregunta: t("ROI = (Benefici / ___) Ã— 100", "ROI = (Beneficio / ___) Ã— 100", "ROI = (Profit / ___) Ã— 100"), opcions: [t("InversiÃ³", "InversiÃ³n", "Investment"), t("Vendes", "Ventas", "Sales"), t("Actiu", "Activo", "Assets"), t("Passiu", "Pasivo", "Liabilities")], correcta: 0 },
            
            // ========== PREGUNTES APLICADES EMPRESA - SITUACIONS QUOTIDIANES ==========
            // PUNT MORT REAL
            { id: 'eap1', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ° Pastisseria: 1.500â‚¬/mes lloguer, cada pastÃ­s costa 2â‚¬ i es ven a 5â‚¬. Ven 400 pastissos/mes. TÃ© beneficis o pÃ¨rdues?", "ğŸ° PastelerÃ­a: 1.500â‚¬/mes alquiler, cada pastel cuesta 2â‚¬ y se vende a 5â‚¬. Vende 400/mes. Â¿Beneficios o pÃ©rdidas?", "ğŸ° Bakery: â‚¬1,500/mo rent, cake costs â‚¬2 sells for â‚¬5. Sells 400/mo. Profit or loss?"),
              opcions: [t("PÃ¨rdues 300â‚¬", "PÃ©rdidas 300â‚¬", "â‚¬300 loss"), t("Benefici 300â‚¬", "Beneficio 300â‚¬", "â‚¬300 profit"), t("Benefici 700â‚¬", "Beneficio 700â‚¬", "â‚¬700 profit"), t("Ni guanya ni perd", "Ni gana ni pierde", "Break-even")], correcta: 0, pista: "(5-2)Ã—400 - 1500 = -300â‚¬" },
            
            // FORMES JURÃDIQUES
            { id: 'eap2', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ‘¥ Volen obrir negoci amb responsabilitat limitada perÃ² no tenen 60.000â‚¬. Quina forma jurÃ­dica?", "ğŸ‘¥ Quieren abrir negocio con responsabilidad limitada pero no tienen 60.000â‚¬. Â¿Forma jurÃ­dica?", "ğŸ‘¥ Want limited liability business but don't have â‚¬60k. Legal form?"),
              opcions: [t("SL (Societat Limitada)", "SL (Sociedad Limitada)", "LLC"), t("SA (AnÃ²nima)", "SA (AnÃ³nima)", "Corp (SA)"), t("Comunitat BÃ©ns", "Comunidad Bienes", "Partnership"), t("AutÃ²nom", "AutÃ³nomo", "Self-employed")], correcta: 0 },
            
            // MARKETING
            { id: 'eap3', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ“± Apple ven l'iPhone mÃ©s car perÃ² la gent el compra igual. Quina estratÃ¨gia de preu Ã©s?", "ğŸ“± Apple vende el iPhone mÃ¡s caro pero la gente lo compra igual. Â¿Estrategia de precio?", "ğŸ“± Apple sells iPhone pricier but people buy anyway. Pricing strategy?"),
              opcions: [t("Preu Premium", "Precio Premium", "Premium pricing"), t("PenetraciÃ³", "PenetraciÃ³n", "Penetration"), t("Competitiu", "Competitivo", "Competitive"), t("PsicolÃ²gic", "PsicolÃ³gico", "Psychological")], correcta: 0 },
            
            // DAFO
            { id: 'eap4', tipus: 'multiple', dificultat: 'facil',
              pregunta: t("ğŸ“Š Una empresa tÃ© 'bons treballadors'. Al DAFO aixÃ² Ã©s una...", "ğŸ“Š Una empresa tiene 'buenos trabajadores'. En el DAFO esto es una...", "ğŸ“Š Company has 'good workers'. In SWOT this is a..."),
              opcions: [t("Fortalesa (intern +)", "Fortaleza (interno +)", "Strength (internal +)"), t("Debilitat", "Debilidad", "Weakness"), t("Oportunitat", "Oportunidad", "Opportunity"), t("AmenaÃ§a", "Amenaza", "Threat")], correcta: 0 },
            
            // LIDERATGE
            { id: 'eap5', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ‘” Un cap consulta l'equip abans de decidir i anima a participar. Estil de lideratge?", "ğŸ‘” Un jefe consulta al equipo antes de decidir y anima a participar. Â¿Estilo de liderazgo?", "ğŸ‘” Boss consults team before deciding, encourages participation. Leadership style?"),
              opcions: [t("DemocrÃ tic", "DemocrÃ¡tico", "Democratic"), t("Autoritari", "Autoritario", "Authoritarian"), t("Laissez-faire", "Laissez-faire", "Laissez-faire"), t("Transaccional", "Transaccional", "Transactional")], correcta: 0 },
            
            // NÃ’MINA
            { id: 'eap6', tipus: 'numeric', dificultat: 'facil', 
              pregunta: t("ğŸ’° Sou brut 2.000â‚¬. Retenen 127â‚¬ SS i 250â‚¬ IRPF. Sou net?", "ğŸ’° Sueldo bruto 2.000â‚¬. Retienen 127â‚¬ SS y 250â‚¬ IRPF. Â¿Sueldo neto?", "ğŸ’° Gross â‚¬2,000. Withhold â‚¬127 SS, â‚¬250 tax. Net?"), 
              correcta: 1623, tolerancia: 0, pista: "Brut - SS - IRPF" },
            
            // PRODUCTIVITAT
            { id: 'eap7', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸ­ FÃ brica: 1.000u amb 10 treballadors. Contracten 5 mÃ©s, ara fan 1.200u. La productivitat ha...", "ğŸ­ FÃ¡brica: 1.000u con 10 trabajadores. Contratan 5 mÃ¡s, ahora hacen 1.200u. La productividad ha...", "ğŸ­ Factory: 1,000u with 10 workers. Hire 5 more, now make 1,200u. Productivity has..."),
              opcions: [t("Baixat (de 100 a 80)", "Bajado (de 100 a 80)", "Dropped (100 to 80)"), t("Pujat", "Subido", "Risen"), t("Igual", "Igual", "Same"), t("No es pot saber", "No se puede saber", "Can't tell")], correcta: 0, pista: "Productivitat = ProducciÃ³/Treballadors" },
            
            // PORTER
            { id: 'eap8', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("ğŸª Al barri hi havia 1 fruiteria, ara n'hi ha 3. Segons Porter, quina forÃ§a ha augmentat?", "ğŸª En el barrio habÃ­a 1 fruterÃ­a, ahora hay 3. SegÃºn Porter, Â¿quÃ© fuerza ha aumentado?", "ğŸª Neighborhood had 1 fruit shop, now 3. Per Porter, which force increased?"),
              opcions: [t("Rivalitat competidors", "Rivalidad competidores", "Competitor rivalry"), t("Nous entrants", "Nuevos entrantes", "New entrants"), t("Poder clients", "Poder clientes", "Customer power"), t("Poder proveÃ¯dors", "Poder proveedores", "Supplier power")], correcta: 0 },
            
            // HERZBERG
            { id: 'eap9', tipus: 'multiple', dificultat: 'dificil',
              pregunta: t("ğŸ Segons Herzberg, quin factor MOTIVA realment (no nomÃ©s evita insatisfacciÃ³)?", "ğŸ SegÃºn Herzberg, Â¿quÃ© factor MOTIVA realmente (no solo evita insatisfacciÃ³n)?", "ğŸ Per Herzberg, which factor truly MOTIVATES (not just prevents dissatisfaction)?"),
              opcions: [t("Reconeixement i Ã¨xits", "Reconocimiento y logros", "Recognition & achievements"), t("Bon sou", "Buen sueldo", "Good salary"), t("Condicions laborals", "Condiciones laborales", "Working conditions"), t("Seguretat laboral", "Seguridad laboral", "Job security")], correcta: 0 },
            
            // JIT
            { id: 'eap10', tipus: 'truefalse', dificultat: 'facil', 
              pregunta: t("ğŸ“¦ El sistema Just-in-Time busca tenir el MÃ€XIM d'estocs per no quedar-se sense productes", "ğŸ“¦ El sistema Just-in-Time busca tener el MÃXIMO de stocks para no quedarse sin productos", "ğŸ“¦ Just-in-Time aims to have MAXIMUM stock to never run out"), 
              correcta: false },
            
            // BCG
            { id: 'eap11', tipus: 'multiple', dificultat: 'mitjana',
              pregunta: t("â­ Producte amb ALTA quota perÃ² mercat que JA NO CREIX. A la matriu BCG Ã©s...", "â­ Producto con ALTA cuota pero mercado que YA NO CRECE. En matriz BCG es...", "â­ Product with HIGH share but market NOT GROWING. In BCG matrix it's a..."),
              opcions: [t("Vaca (genera efectiu)", "Vaca (genera efectivo)", "Cash Cow"), t("Estrella", "Estrella", "Star"), t("Interrogant", "Interrogante", "Question mark"), t("Gos", "Perro", "Dog")], correcta: 0, pista: t("Alta quota + baix creixement", "Alta cuota + bajo crecimiento", "High share + low growth") },
            
            // CANVAS
            { id: 'eap12', tipus: 'multiple', dificultat: 'dificil',
              pregunta: t("ğŸ¯ Al Business Model Canvas, 'Per quÃ¨ ens trien els clients?' correspon a...", "ğŸ¯ En el Canvas, 'Â¿Por quÃ© nos eligen los clientes?' corresponde a...", "ğŸ¯ In Canvas, 'Why do customers choose us?' corresponds to..."),
              opcions: [t("Proposta de Valor", "Propuesta de Valor", "Value Proposition"), t("Segments Clients", "Segmentos Clientes", "Customer Segments"), t("Relacions Clients", "Relaciones Clientes", "Customer Relations"), t("Canals", "Canales", "Channels")], correcta: 0 },
        ]
    }), [idioma]);

    // El ranking es carrega amb carregarRanking() quan s'obre la pantalla

    // Inicialitzar estats segons el tipus de pregunta
    useEffect(() => {
        if (fase !== 'jugant' || !preguntesPartida[preguntaActual]) return;
        const p = preguntesPartida[preguntaActual];
        
        if (p.tipus === 'order' || p.tipus === 'match_risk') {
            const elements = p.elements;
            setOrdreUsuari(elements.map((_, i) => i).sort(() => Math.random() - 0.5));
        }
        if (p.tipus === 'allocate') {
            // Inicialitzar amb distribuciÃ³ igual
            const n = p.assets.length;
            const equalShare = Math.floor(100 / n);
            const remainder = 100 - (equalShare * n);
            setAllocations(p.assets.map((_, i) => i === 0 ? equalShare + remainder : equalShare));
        }
        if (p.tipus === 'slider_value') {
            setSliderValue(Math.floor((p.min + p.max) / 2));
        }
        if (p.tipus === 'scenario') {
            setSelectedOptions([]);
        }
        if (p.tipus === 'click_chart') {
            setClickedPoint(null);
        }
    }, [preguntaActual, fase, preguntesPartida]);
    
    const obtenirPreguntes = (cat) => {
        let pool = cat === 'totes' 
            ? [...bancPreguntes.economia, ...bancPreguntes.finances, ...bancPreguntes.empresa]
            : [...bancPreguntes[cat]];
        return pool.sort(() => Math.random() - 0.5).slice(0, 20);
    };

    const iniciarPartida = () => {
        // Llegir el nom del ref (input no controlat)
        const nom = nomInputRef.current ? nomInputRef.current.value.trim() : nomJugador.trim();
        if (!nom) { showToast(t("Introdueix el teu nom!", "Â¡Introduce tu nombre!", "Enter your name!"), 'error'); return; }
        setNomJugador(nom); // Guardar el nom al state per usar-lo desprÃ©s
        setPreguntesPartida(obtenirPreguntes(categoria));
        setPreguntaActual(0); setPuntuacio(0); setRespostes([]); setRatxa(0); setMaxRatxa(0);
        setRespostaUsuari(null); setMostrarResultat(false);
        setOrdreUsuari([]); setTimerKey(k => k + 1); setTimerActive(true);
        setAjudes({ cinquanta: 1, temps: 1, saltar: 1 }); setOpcionsEliminades([]);
        // Resetejar nous estats
        setClickedPoint(null); setAllocations([]); setSliderValue(25); setSelectedOptions([]);
        setFase('jugant');
        playSound('bonus');
    };

    const calcularPunts = (correcta, tempsUsed, dificultat, ratxaActual) => {
        if (!correcta) return -25;
        let base = dificultat === 'facil' ? 100 : dificultat === 'mitjana' ? 150 : 200;
        const tempsRestant = 60 - tempsUsed;
        const bonusVelocitat = tempsRestant > 40 ? Math.floor((tempsRestant - 40) * 3) : 0;
        let mult = ratxaActual >= 7 ? 3 : ratxaActual >= 5 ? 2.5 : ratxaActual >= 3 ? 2 : ratxaActual >= 1 ? 1.5 : 1;
        return Math.floor((base + bonusVelocitat) * mult);
    };

    const handleResposta = useCallback((resposta) => {
        setTimerActive(false);
        const p = preguntesPartida[preguntaActual];
        let ok = false;
        
        // Tipus tradicionals
        if (p.tipus === 'multiple' || p.tipus === 'identify' || p.tipus === 'formula') ok = resposta === p.correcta;
        else if (p.tipus === 'truefalse') ok = resposta === p.correcta;
        else if (p.tipus === 'numeric') ok = Math.abs(parseFloat(resposta) - p.correcta) <= (p.tolerancia || 0);
        else if (p.tipus === 'order' || p.tipus === 'match_risk') ok = JSON.stringify(ordreUsuari) === JSON.stringify(p.ordreCorrecte);
        
        // Nous tipus interactius
        else if (p.tipus === 'click_chart') {
            ok = resposta >= p.correctZone.min && resposta <= p.correctZone.max;
        }
        else if (p.tipus === 'allocate') {
            // Validar que cada assignaciÃ³ estÃ  dins del rang correcte
            ok = allocations.every((val, i) => {
                const range = p.correctRanges[i];
                return val >= range[0] && val <= range[1];
            }) && allocations.reduce((a, b) => a + b, 0) === 100;
        }
        else if (p.tipus === 'scenario') {
            // Validar opcions seleccionades
            const correctes = p.opcions.map((o, i) => o.correcta ? i : -1).filter(i => i >= 0);
            if (p.multipleCorrect) {
                ok = selectedOptions.length > 0 && selectedOptions.every(i => correctes.includes(i));
            } else {
                ok = selectedOptions.length === 1 && correctes.includes(selectedOptions[0]);
            }
        }
        else if (p.tipus === 'slider_value') {
            ok = Math.abs(sliderValue - p.correcta) <= (p.tolerancia || 0);
        }
        
        const tempsUsed = 60 - (document.querySelector('.timer-display')?.textContent?.replace('s','') || 30);
        const novaRatxa = ok ? ratxa + 1 : 0;
        const punts = calcularPunts(ok, tempsUsed, p.dificultat, ratxa);
        
        if (ok) {
            playSound('correct');
            vibrate([100]);
            if (novaRatxa >= 3) showToast(`ğŸ”¥ ${t('Ratxa', 'Racha', 'Streak')} x${novaRatxa}!`, 'success');
        } else {
            playSound('wrong');
            vibrate([100, 50, 100]);
        }
        
        setPointsPopup({ show: true, points: punts });
        setTimeout(() => setPointsPopup({ show: false, points: 0 }), 1000);
        
        setRespostaUsuari(resposta); setMostrarResultat(true); setRatxa(novaRatxa);
        if (novaRatxa > maxRatxa) setMaxRatxa(novaRatxa);
        setPuntuacio(s => Math.max(0, s + punts));
        setRespostes(r => [...r, { pregunta: p.id, correcta: ok, punts, temps: tempsUsed }]);
    }, [preguntesPartida, preguntaActual, ordreUsuari, allocations, selectedOptions, sliderValue, ratxa, maxRatxa, playSound, vibrate, showToast, t]);
    
    // EXPOSAR handleResposta GLOBALMENT per l'input HTML flotant
    useEffect(() => {
        window.submitNumericAnswer = (value) => {
            if (fase === 'jugant' && !mostrarResultat) {
                handleResposta(value);
            }
        };
        return () => { delete window.submitNumericAnswer; };
    }, [fase, mostrarResultat, handleResposta]);

    const handleTimeUp = useCallback(() => {
        if (!mostrarResultat) handleResposta(null);
    }, [mostrarResultat, handleResposta]);

    const seguentPregunta = () => {
        setOpcionsEliminades([]);
        if (preguntaActual + 1 >= preguntesPartida.length) {
            const ara = new Date();
            const entry = { 
                nom: nomJugador, 
                punts: puntuacio, 
                data: ara.toLocaleDateString('ca-ES'), 
                mes: `${ara.getFullYear()}-${String(ara.getMonth() + 1).padStart(2, '0')}`,
                correctes: respostes.filter(r => r.correcta).length, 
                categoria, 
                maxRatxa 
            };
            guardarAlRanking(entry);
            setShowConfetti(true);
            setTimeout(() => setShowConfetti(false), 4000);
            playSound('bonus');
            setFase('resultats');
        } else {
            setPreguntaActual(p => p + 1);
            setRespostaUsuari(null); setMostrarResultat(false);
            setOrdreUsuari([]);
            // Resetejar nous estats interactius
            setClickedPoint(null);
            setAllocations([]);
            setSliderValue(25);
            setSelectedOptions([]);
            setTimerKey(k => k + 1); setTimerActive(true);
        }
    };

    // AJUDES
    const usarAjuda50 = () => {
        if (ajudes.cinquanta <= 0 || mostrarResultat) return;
        const p = preguntesPartida[preguntaActual];
        if (p.tipus !== 'multiple' && p.tipus !== 'identify' && p.tipus !== 'formula') {
            showToast(t("NomÃ©s per preguntes tipus test!", "Â¡Solo para preguntas tipo test!", "Only for multiple choice!"), 'error');
            return;
        }
        const incorrectes = p.opcions.map((_, i) => i).filter(i => i !== p.correcta);
        const aEliminar = incorrectes.sort(() => Math.random() - 0.5).slice(0, 2);
        setOpcionsEliminades(aEliminar);
        setAjudes(a => ({ ...a, cinquanta: a.cinquanta - 1 }));
        showToast(t("50:50 activat!", "Â¡50:50 activado!", "50:50 activated!"), 'success');
        playSound('tick');
    };
    
    const usarAjudaTemps = () => {
        if (ajudes.temps <= 0 || mostrarResultat) return;
        // Afegir 60 segons al temps actual via DOM directe
        if (window.addTimerTime) window.addTimerTime(60);
        setAjudes(a => ({ ...a, temps: a.temps - 1 }));
        showToast(t("+60 segons!", "Â¡+60 segundos!", "+60 seconds!"), 'success');
        playSound('bonus');
    };
    
    const usarAjudaSaltar = () => {
        if (ajudes.saltar <= 0 || mostrarResultat) return;
        setAjudes(a => ({ ...a, saltar: a.saltar - 1 }));
        showToast(t("Pregunta saltada!", "Â¡Pregunta saltada!", "Question skipped!"), 'info');
        seguentPregunta();
    };

    const moureElement = (index, dir) => {
        const nou = [...ordreUsuari];
        const newIdx = index + dir;
        if (newIdx < 0 || newIdx >= nou.length) return;
        [nou[index], nou[newIdx]] = [nou[newIdx], nou[index]];
        setOrdreUsuari(nou);
        playSound('tick');
    };

    const Card = ({ children, className = "" }) => (
        <div className={`bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 ${className}`}>{children}</div>
    );

    const renderGrafic = (tipus) => {
        const grafics = {
            bcg: (<div className="grid grid-cols-2 gap-2 w-52 mx-auto my-4 text-xs"><div className="p-3 bg-yellow-400/30 rounded-lg text-center border border-yellow-400/50 animate-pulse">â­ Stars</div><div className="p-3 bg-purple-400/30 rounded-lg text-center border border-purple-400/50">â“ ?</div><div className="p-3 bg-green-400/30 rounded-lg text-center border border-green-400/50">ğŸ„ Cash Cows</div><div className="p-3 bg-slate-400/30 rounded-lg text-center border border-slate-400/50">ğŸ• Dogs</div><div className="col-span-2 text-center text-purple-300 text-[10px] mt-1">â† {t("Quota", "Cuota", "Share")} â†’</div></div>),
            ansoff: (<div className="w-56 mx-auto my-4 text-xs"><div className="grid grid-cols-3 gap-1"><div></div><div className="text-center text-purple-300 text-[10px]">{t("Prod. actual", "Prod. actual", "Current prod.")}</div><div className="text-center text-purple-300 text-[10px]">{t("Prod. nou", "Prod. nuevo", "New prod.")}</div><div className="text-purple-300 text-[10px]">{t("Mercat actual", "Mercado actual", "Current mkt")}</div><div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">{t("Penetr.", "Penetr.", "Penetr.")}</div><div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 text-center">{t("Des.Prod", "Des.Prod", "Prod.Dev")}</div><div className="text-purple-300 text-[10px]">{t("Mercat nou", "Mercado nuevo", "New mkt")}</div><div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">{t("Des.Mkt", "Des.Mkt", "Mkt.Dev")}</div><div className="p-2 bg-red-400/30 rounded border border-red-400/50 text-center animate-pulse">{t("Divers.", "Divers.", "Divers.")}</div></div></div>),
            canvas: (<div className="grid grid-cols-5 gap-1 w-72 mx-auto my-4 text-[10px]"><div className="row-span-2 p-2 bg-violet-400/30 rounded border border-violet-400/50 text-center">ğŸ¤</div><div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">âš™ï¸</div><div className="row-span-2 p-2 bg-pink-400/30 rounded border border-pink-400/50 text-center animate-pulse">ğŸ’</div><div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">â¤ï¸</div><div className="row-span-2 p-2 bg-emerald-400/30 rounded border border-emerald-400/50 text-center">ğŸ‘¥</div><div className="p-2 bg-cyan-400/30 rounded border border-cyan-400/50 text-center">ğŸ—ï¸</div><div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 text-center">ğŸ“¢</div><div className="col-span-2 p-2 bg-red-400/30 rounded border border-red-400/50 text-center">ğŸ’¸</div><div className="col-span-3 p-2 bg-green-400/30 rounded border border-green-400/50 text-center">ğŸ’°</div></div>),
            dafo: (<div className="grid grid-cols-2 gap-2 w-56 mx-auto my-4 text-xs"><div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">ğŸ’ª {t("F", "F", "S")}</div><div className="p-2 bg-red-400/30 rounded border border-red-400/50 text-center">ğŸ˜° {t("D", "D", "W")}</div><div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">ğŸ¯ {t("O", "O", "O")}</div><div className="p-2 bg-orange-400/30 rounded border border-orange-400/50 text-center animate-pulse">âš ï¸ {t("A", "A", "T")}</div></div>),
            porter: (<div className="w-56 mx-auto my-4 text-[10px] text-center"><div className="p-2 bg-red-400/30 rounded border border-red-400/50 mb-1">â¬†ï¸ {t("Entrants", "Entrantes", "Entrants")}</div><div className="flex gap-1"><div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 flex-1">â¬…ï¸</div><div className="p-2 bg-purple-400/30 rounded border border-purple-400/50 flex-1">âš”ï¸</div><div className="p-2 bg-green-400/30 rounded border border-green-400/50 flex-1">â¡ï¸</div></div><div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 mt-1">â¬‡ï¸ {t("Substituts", "Sustitutos", "Substitutes")}</div></div>),
            oferta_demanda: (<div className="w-64 h-44 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20 p-2">
                <svg viewBox="0 0 100 80" className="w-full h-full">
                    {/* Eixos */}
                    <line x1="15" y1="5" x2="15" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    <line x1="15" y1="70" x2="95" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    {/* Fletxes */}
                    <polygon points="15,5 12,10 18,10" fill="#a78bfa"/>
                    <polygon points="95,70 90,67 90,73" fill="#a78bfa"/>
                    {/* Corba Demanda (vermella, decreixent) */}
                    <path d="M 20 15 Q 45 25 70 55 T 90 65" stroke="#ef4444" strokeWidth="2.5" fill="none"/>
                    {/* Corba Oferta (blava, creixent) */}
                    <path d="M 20 65 Q 45 55 70 25 T 90 15" stroke="#3b82f6" strokeWidth="2.5" fill="none"/>
                    {/* Punt d'equilibri */}
                    <circle cx="55" cy="40" r="4" fill="#fbbf24" className="animate-pulse"/>
                    {/* Etiquetes */}
                    <text x="8" y="12" fill="#a78bfa" fontSize="8" fontWeight="bold">P</text>
                    <text x="90" y="78" fill="#a78bfa" fontSize="8" fontWeight="bold">Q</text>
                    <text x="75" y="20" fill="#3b82f6" fontSize="7" fontWeight="bold">O</text>
                    <text x="75" y="62" fill="#ef4444" fontSize="7" fontWeight="bold">D</text>
                    <text x="58" y="38" fill="#fbbf24" fontSize="6">E</text>
                </svg>
            </div>),
            islm: (<div className="w-64 h-44 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20 p-2">
                <svg viewBox="0 0 100 80" className="w-full h-full">
                    {/* Eixos */}
                    <line x1="15" y1="5" x2="15" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    <line x1="15" y1="70" x2="95" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    {/* Fletxes */}
                    <polygon points="15,5 12,10 18,10" fill="#a78bfa"/>
                    <polygon points="95,70 90,67 90,73" fill="#a78bfa"/>
                    {/* Corba IS (blava, decreixent) */}
                    <line x1="20" y1="20" x2="85" y2="60" stroke="#3b82f6" strokeWidth="2.5"/>
                    {/* Corba LM (verda, creixent) */}
                    <line x1="20" y1="60" x2="85" y2="20" stroke="#22c55e" strokeWidth="2.5"/>
                    {/* Punt d'equilibri */}
                    <circle cx="52" cy="40" r="4" fill="#fbbf24" className="animate-pulse"/>
                    {/* Etiquetes */}
                    <text x="8" y="12" fill="#a78bfa" fontSize="8" fontWeight="bold">i</text>
                    <text x="90" y="78" fill="#a78bfa" fontSize="8" fontWeight="bold">Y</text>
                    <text x="80" y="65" fill="#3b82f6" fontSize="8" fontWeight="bold">IS</text>
                    <text x="80" y="18" fill="#22c55e" fontSize="8" fontWeight="bold">LM</text>
                </svg>
            </div>),
            laffer: (<div className="w-64 h-44 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20 p-2">
                <svg viewBox="0 0 100 80" className="w-full h-full">
                    {/* Eixos */}
                    <line x1="15" y1="5" x2="15" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    <line x1="15" y1="70" x2="95" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    {/* Fletxes */}
                    <polygon points="15,5 12,10 18,10" fill="#a78bfa"/>
                    <polygon points="95,70 90,67 90,73" fill="#a78bfa"/>
                    {/* Corba de Laffer (parÃ bola invertida) */}
                    <path d="M 20 65 Q 55 0 90 65" stroke="#f59e0b" strokeWidth="2.5" fill="none"/>
                    {/* Punt Ã²ptim */}
                    <circle cx="55" cy="18" r="4" fill="#fbbf24" className="animate-pulse"/>
                    <line x1="55" y1="22" x2="55" y2="70" stroke="#fbbf24" strokeWidth="1" strokeDasharray="3"/>
                    {/* Etiquetes */}
                    <text x="3" y="40" fill="#a78bfa" fontSize="7" fontWeight="bold">Rec.</text>
                    <text x="80" y="78" fill="#a78bfa" fontSize="7" fontWeight="bold">Tax %</text>
                    <text x="48" y="14" fill="#fbbf24" fontSize="6">t*</text>
                </svg>
            </div>),
            phillips: (<div className="w-64 h-44 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20 p-2">
                <svg viewBox="0 0 100 80" className="w-full h-full">
                    {/* Eixos */}
                    <line x1="15" y1="5" x2="15" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    <line x1="15" y1="70" x2="95" y2="70" stroke="#a78bfa" strokeWidth="1.5"/>
                    {/* Fletxes */}
                    <polygon points="15,5 12,10 18,10" fill="#a78bfa"/>
                    <polygon points="95,70 90,67 90,73" fill="#a78bfa"/>
                    {/* Corba de Phillips (hipÃ¨rbola) */}
                    <path d="M 20 15 Q 30 40 50 55 T 90 62" stroke="#ec4899" strokeWidth="2.5" fill="none"/>
                    {/* Etiquetes */}
                    <text x="3" y="12" fill="#a78bfa" fontSize="7" fontWeight="bold">Infl.</text>
                    <text x="75" y="78" fill="#a78bfa" fontSize="7" fontWeight="bold">Atur</text>
                </svg>
            </div>),
            balanc: (<div className="w-56 mx-auto my-4 text-[10px]"><div className="flex gap-1"><div className="flex-1 p-2 bg-blue-400/30 rounded-t border border-blue-400/50 text-center font-bold">{t("ACTIU", "ACTIVO", "ASSETS")}</div><div className="flex-1 p-2 bg-green-400/30 rounded-t border border-green-400/50 text-center font-bold">{t("P+PN", "P+PN", "L+E")}</div></div><div className="flex gap-1"><div className="flex-1 p-1 bg-blue-400/20 border-x border-blue-400/50">ANC</div><div className="flex-1 p-1 bg-green-400/20 border-x border-green-400/50">PN</div></div><div className="flex gap-1"><div className="flex-1 p-1 bg-blue-400/20 border border-blue-400/50 rounded-b">AC</div><div className="flex-1"><div className="p-1 bg-green-400/20 border-x border-green-400/50">PNC</div><div className="p-1 bg-green-400/20 border border-green-400/50 rounded-b">PC</div></div></div></div>),
            leasing: (<div className="w-48 mx-auto my-4 p-4 bg-blue-400/20 rounded-xl border border-blue-400/50 text-center"><span className="text-3xl">ğŸ¦â¡ï¸ğŸ“¦</span><p className="text-sm mt-2 text-blue-200 font-bold">LEASING</p></div>),
            factoring: (<div className="w-48 mx-auto my-4 p-4 bg-green-400/20 rounded-xl border border-green-400/50 text-center"><span className="text-3xl">ğŸ“„â¡ï¸ğŸ’µ</span><p className="text-sm mt-2 text-green-200 font-bold">FACTORING</p></div>),
        };
        return grafics[tipus] || null;
    };

    // COMPONENT RANKING PREVIEW PER A LA PANTALLA D'INICI
    const RankingPreview = () => {
        const [previewRanking, setPreviewRanking] = useState([]);
        const [loading, setLoading] = useState(true);
        
        useEffect(() => {
            const carregarPreview = async () => {
                setLoading(true);
                let entries = [];
                
                if (!window.storage) {
                    const saved = localStorage.getItem('pde_concurs_ranking_v4') || '[]';
                    entries = JSON.parse(saved);
                } else {
                    try {
                        const result = await window.storage.list('ranking:', true);
                        if (result && result.keys) {
                            for (const key of result.keys.slice(0, 50)) { // Limitar per rendiment
                                try {
                                    const data = await window.storage.get(key, true);
                                    if (data && data.value) {
                                        entries.push(JSON.parse(data.value));
                                    }
                                } catch (e) {}
                            }
                        }
                    } catch (e) {
                        const saved = localStorage.getItem('pde_concurs_ranking_v4') || '[]';
                        entries = JSON.parse(saved);
                    }
                }
                
                // Ordenar i agafar top 3
                entries.sort((a, b) => b.punts - a.punts);
                const comptador = {};
                entries = entries.filter(e => {
                    const nom = e.nom.toLowerCase();
                    comptador[nom] = (comptador[nom] || 0) + 1;
                    return comptador[nom] <= 3;
                }).slice(0, 3);
                
                setPreviewRanking(entries);
                setLoading(false);
            };
            
            carregarPreview();
        }, []);
        
        if (loading) {
            return (
                <div className="flex justify-center items-center py-4">
                    <span className="text-2xl animate-spin">â³</span>
                </div>
            );
        }
        
        if (previewRanking.length === 0) {
            return (
                <div className="text-center py-4 text-yellow-200/70">
                    <span className="text-3xl block mb-2">ğŸ®</span>
                    <p className="text-sm">{t("Encara no hi ha campions!", "Â¡AÃºn no hay campeones!", "No champions yet!")}</p>
                    <p className="text-xs">{t("Sigues el primer!", "Â¡SÃ© el primero!", "Be the first!")}</p>
                </div>
            );
        }
        
        return (
            <div className="flex justify-center items-end gap-3 py-2">
                {/* 2n lloc */}
                {previewRanking[1] && (
                    <div className="flex flex-col items-center">
                        <span className="text-2xl">ğŸ¥ˆ</span>
                        <div className="w-16 h-16 bg-gradient-to-b from-slate-300 to-slate-400 rounded-lg flex flex-col items-center justify-center">
                            <p className="text-xs font-bold text-slate-800 truncate max-w-14">{previewRanking[1].nom}</p>
                            <p className="text-sm font-black text-slate-900">{previewRanking[1].punts}</p>
                        </div>
                    </div>
                )}
                
                {/* 1r lloc */}
                {previewRanking[0] && (
                    <div className="flex flex-col items-center -mt-4">
                        <span className="text-3xl animate-bounce">ğŸ‘‘</span>
                        <div className="w-20 h-20 gold-gradient rounded-lg flex flex-col items-center justify-center animate-glow">
                            <p className="text-xs font-bold text-slate-800 truncate max-w-18">{previewRanking[0].nom}</p>
                            <p className="text-lg font-black text-slate-900">{previewRanking[0].punts}</p>
                        </div>
                    </div>
                )}
                
                {/* 3r lloc */}
                {previewRanking[2] && (
                    <div className="flex flex-col items-center">
                        <span className="text-2xl">ğŸ¥‰</span>
                        <div className="w-16 h-14 bg-gradient-to-b from-orange-400 to-orange-500 rounded-lg flex flex-col items-center justify-center">
                            <p className="text-xs font-bold text-orange-900 truncate max-w-14">{previewRanking[2].nom}</p>
                            <p className="text-sm font-black text-orange-900">{previewRanking[2].punts}</p>
                        </div>
                    </div>
                )}
            </div>
        );
    };

    // PANTALLA INICI
    const PantallaInici = () => (
        <div className="max-w-2xl mx-auto space-y-6 animate-fade">
            <div className="text-center py-8">
                <span className="text-7xl mb-6 block animate-bounce">ğŸ†</span>
                <h1 className="text-5xl font-black text-white mb-3">{t("Concurs PDE", "Concurso PDE", "PDE Contest")}</h1>
                <p className="text-xl text-purple-200">{t("Economia Â· Finances Â· Empresa", "EconomÃ­a Â· Finanzas Â· Empresa", "Economics Â· Finance Â· Business")}</p>
            </div>
            
            <Card>
                <div className="space-y-5">
                    <div>
                        <label className="block text-sm font-semibold text-purple-200 mb-2">{t("El teu nom", "Tu nombre", "Your name")}</label>
                        <input 
                            type="text" 
                            ref={nomInputRef}
                            defaultValue={nomJugador}
                            onBlur={e => setNomJugador(e.target.value)}
                            placeholder={t("Escriu el teu nom...", "Escribe tu nombre...", "Enter your name...")} 
                            className="w-full p-4 bg-white/10 border border-white/30 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-yellow-400 outline-none text-lg" 
                            maxLength={20}
                            autoComplete="off"
                            autoCorrect="off"
                            autoCapitalize="off"
                            spellCheck="false"
                        />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-semibold text-purple-200 mb-3">{t("Categoria", "CategorÃ­a", "Category")}</label>
                        <div className="grid grid-cols-2 gap-3">
                            {[
                                { id: 'economia', icon: 'ğŸ“ˆ', label: t('Economia', 'EconomÃ­a', 'Economics'), color: 'from-blue-500 to-cyan-500' },
                                { id: 'finances', icon: 'ğŸ’°', label: t('Finances', 'Finanzas', 'Finance'), color: 'from-green-500 to-emerald-500' },
                                { id: 'empresa', icon: 'ğŸ¢', label: t('Empresa', 'Empresa', 'Business'), color: 'from-orange-500 to-red-500' },
                                { id: 'totes', icon: 'ğŸ¯', label: t('Totes', 'Todas', 'All'), color: 'from-purple-500 to-pink-500' },
                            ].map(cat => (
                                <button key={cat.id} onClick={() => { setCategoria(cat.id); playSound('tick'); }} className={`p-4 rounded-xl border-2 transition-all transform hover:scale-105 ${categoria === cat.id ? 'border-yellow-400 bg-gradient-to-r ' + cat.color + ' shadow-lg shadow-yellow-400/30 animate-glow' : 'border-white/30 bg-white/5 hover:bg-white/10'}`}>
                                    <span className="text-3xl block mb-2">{cat.icon}</span>
                                    <span className="font-bold text-white">{cat.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    <button onClick={iniciarPartida} className="w-full py-5 gold-gradient text-slate-900 font-black text-xl rounded-xl hover:opacity-90 transition-all shadow-lg shadow-yellow-500/30 transform hover:scale-[1.02] animate-glow">
                        ğŸš€ {t("COMENÃ‡AR!", "Â¡EMPEZAR!", "START!")}
                    </button>
                </div>
            </Card>
            
            <Card>
                <p className="text-sm text-purple-300 mb-3 text-center font-semibold">{t("Ajudes disponibles:", "Ayudas disponibles:", "Available helps:")}</p>
                <div className="grid grid-cols-3 gap-3 text-center">
                    <div className="p-3 bg-blue-500/20 rounded-xl border border-blue-400/50"><span className="text-2xl block mb-1">5ï¸âƒ£0ï¸âƒ£</span><span className="text-xs text-blue-300">50:50</span></div>
                    <div className="p-3 bg-green-500/20 rounded-xl border border-green-400/50"><span className="text-2xl block mb-1">â±ï¸</span><span className="text-xs text-green-300">+60s</span></div>
                    <div className="p-3 bg-amber-500/20 rounded-xl border border-amber-400/50"><span className="text-2xl block mb-1">â­ï¸</span><span className="text-xs text-amber-300">{t("Saltar", "Saltar", "Skip")}</span></div>
                </div>
            </Card>
            
            {/* SECCIÃ“ RANKING DESTACADA */}
            <div className="relative overflow-hidden rounded-2xl bg-gradient-to-br from-yellow-500/20 via-amber-500/10 to-orange-500/20 border-2 border-yellow-400/30 p-4">
                <div className="absolute top-0 right-0 text-8xl opacity-10">ğŸ†</div>
                
                <div className="flex items-center justify-between mb-4">
                    <div>
                        <h3 className="text-xl font-black text-yellow-400 flex items-center gap-2">
                            ğŸ† {t("Ranking Global", "Ranking Global", "Global Ranking")}
                        </h3>
                        <p className="text-xs text-yellow-200/70">{t("Competeix amb jugadors de tot el mÃ³n!", "Â¡Compite con jugadores de todo el mundo!", "Compete with players worldwide!")}</p>
                    </div>
                    <button 
                        onClick={() => setFase('ranking')} 
                        className="px-4 py-2 bg-yellow-400 text-slate-900 font-bold rounded-lg hover:bg-yellow-300 transition-all text-sm">
                        {t("Veure tot", "Ver todo", "See all")} â†’
                    </button>
                </div>
                
                {/* Mini pÃ²dium preview */}
                <RankingPreview />
            </div>
            
            <div className="flex gap-3">
                <a href="./index.html" className="flex-1 py-4 bg-white/10 border border-white/30 text-white font-bold rounded-xl hover:bg-white/20 text-center transition-all">ğŸ  {t("Inici", "Inicio", "Home")}</a>
            </div>
            
            <div className="flex justify-center items-center gap-4">
                <div className="flex gap-2">
                    {['val', 'es', 'en'].map(lang => (
                        <button key={lang} onClick={() => setIdioma(lang)} className={`px-4 py-2 rounded-lg font-bold transition-all ${idioma === lang ? 'bg-yellow-400 text-slate-900' : 'bg-white/10 text-white hover:bg-white/20'}`}>{lang.toUpperCase()}</button>
                    ))}
                </div>
                <button onClick={() => setSoundEnabled(!soundEnabled)} className={`p-2 rounded-lg ${soundEnabled ? 'bg-green-500/30 text-green-300' : 'bg-red-500/30 text-red-300'}`}>
                    {soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}
                </button>
            </div>
        </div>
    );

    // PANTALLA JOC
    const PantallaJoc = () => {
        const p = preguntesPartida[preguntaActual];
        if (!p) return null;
        const progressPct = ((preguntaActual + 1) / preguntesPartida.length) * 100;
        const tipusIcons = { 
            numeric: 'ğŸ§®', order: 'ğŸ”¢', formula: 'ğŸ“', identify: 'ğŸ“Š', truefalse: 'âœ“âœ—', multiple: 'ğŸ”˜',
            click_chart: 'ğŸ“ˆ', allocate: 'ğŸ’¼', scenario: 'ğŸ­', slider_value: 'ğŸšï¸', match_risk: 'ğŸ¯'
        };
        
        return (
            <div className="max-w-3xl mx-auto space-y-4 animate-fade">
                {/* Header */}
                <div className="flex items-center justify-between bg-white/10 backdrop-blur rounded-xl p-3 border border-white/20">
                    <div className="flex items-center gap-2">
                        <span className="font-bold text-white bg-white/20 px-3 py-1 rounded-lg">{preguntaActual + 1}/{preguntesPartida.length}</span>
                        <div className="flex items-center gap-1 bg-yellow-400/20 text-yellow-400 px-3 py-1 rounded-lg">
                            <span>ğŸ†</span><span className="font-bold">{puntuacio}</span>
                        </div>
                        {ratxa >= 1 && (
                            <div className={`flex items-center gap-1 px-3 py-1 rounded-lg ${ratxa >= 5 ? 'bg-red-500/30 text-red-400 streak-fire' : ratxa >= 3 ? 'bg-orange-400/30 text-orange-400' : 'bg-amber-400/20 text-amber-400'}`}>
                                <span>{ratxa >= 5 ? 'ğŸ”¥ğŸ”¥' : ratxa >= 3 ? 'ğŸ”¥' : 'âœ¨'}</span>
                                <span className="font-bold">x{ratxa >= 7 ? '3' : ratxa >= 5 ? '2.5' : ratxa >= 3 ? '2' : '1.5'}</span>
                            </div>
                        )}
                    </div>
                </div>
                
                {/* Timer i ProgrÃ©s */}
                <div className="space-y-2">
                    <div className="h-2 bg-white/20 rounded-full overflow-hidden">
                        <div className="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300" style={{ width: `${progressPct}%` }}></div>
                    </div>
                    <TimerDirect timerKey={timerKey} onTimeUp={handleTimeUp} isActive={timerActive && !mostrarResultat} />
                </div>
                
                {/* Ajudes */}
                {!mostrarResultat && (
                    <div className="flex justify-center gap-2">
                        <button onClick={usarAjuda50} disabled={ajudes.cinquanta <= 0} className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${ajudes.cinquanta > 0 ? 'bg-blue-500/30 text-blue-300 hover:bg-blue-500/50' : 'bg-white/10 text-white/30 cursor-not-allowed'}`}>
                            5ï¸âƒ£0ï¸âƒ£ ({ajudes.cinquanta})
                        </button>
                        <button onClick={usarAjudaTemps} disabled={ajudes.temps <= 0} className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${ajudes.temps > 0 ? 'bg-green-500/30 text-green-300 hover:bg-green-500/50' : 'bg-white/10 text-white/30 cursor-not-allowed'}`}>
                            â±ï¸ +60s ({ajudes.temps})
                        </button>
                        <button onClick={usarAjudaSaltar} disabled={ajudes.saltar <= 0} className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${ajudes.saltar > 0 ? 'bg-amber-500/30 text-amber-300 hover:bg-amber-500/50' : 'bg-white/10 text-white/30 cursor-not-allowed'}`}>
                            â­ï¸ ({ajudes.saltar})
                        </button>
                    </div>
                )}
                
                {/* Pregunta */}
                <Card className={mostrarResultat ? (respostes[respostes.length - 1]?.correcta ? 'animate-correct' : 'animate-wrong') : ''}>
                    <div className="flex items-center gap-2 mb-4">
                        <span className={`px-3 py-1 rounded-lg text-xs font-bold ${p.dificultat === 'facil' ? 'bg-green-400/30 text-green-300' : p.dificultat === 'mitjana' ? 'bg-amber-400/30 text-amber-300' : 'bg-red-400/30 text-red-300'}`}>
                            {p.dificultat === 'facil' ? 'â­' : p.dificultat === 'mitjana' ? 'â­â­' : 'â­â­â­'}
                        </span>
                        <span className="text-lg">{tipusIcons[p.tipus]}</span>
                    </div>
                    
                    <h3 className="text-xl md:text-2xl font-bold text-white mb-6">{p.pregunta}</h3>
                    
                    {p.imatge && renderGrafic(p.imatge)}
                    
                    {/* Opcions mÃºltiples/identify/formula */}
                    {(p.tipus === 'multiple' || p.tipus === 'identify' || p.tipus === 'formula') && (
                        <div className="grid gap-3">
                            {p.opcions.map((op, i) => {
                                if (opcionsEliminades.includes(i)) return (
                                    <div key={i} className="p-4 rounded-xl border-2 border-white/10 bg-white/5 opacity-30 line-through text-white/50">{op}</div>
                                );
                                return (
                                    <button key={i} onClick={() => !mostrarResultat && handleResposta(i)} disabled={mostrarResultat}
                                        className={`p-4 text-left rounded-xl border-2 transition-all font-medium text-white ${
                                            mostrarResultat ? i === p.correcta ? 'border-green-400 bg-green-400/30' : respostaUsuari === i ? 'border-red-400 bg-red-400/30' : 'border-white/20 opacity-40'
                                            : 'border-white/30 hover:border-yellow-400 hover:bg-white/10 cursor-pointer active:scale-95'
                                        }`}>
                                        <span className="font-bold mr-3 text-purple-300">{String.fromCharCode(65 + i)}.</span>{op}
                                        {mostrarResultat && i === p.correcta && <span className="float-right text-green-400 text-xl">âœ“</span>}
                                        {mostrarResultat && respostaUsuari === i && i !== p.correcta && <span className="float-right text-red-400 text-xl">âœ—</span>}
                                    </button>
                                );
                            })}
                        </div>
                    )}
                    
                    {/* Vertader/Fals */}
                    {p.tipus === 'truefalse' && (
                        <div className="grid grid-cols-2 gap-4">
                            {[true, false].map(val => (
                                <button key={String(val)} onClick={() => !mostrarResultat && handleResposta(val)} disabled={mostrarResultat}
                                    className={`p-6 rounded-xl border-2 transition-all font-bold text-xl text-white active:scale-95 ${
                                        mostrarResultat ? val === p.correcta ? 'border-green-400 bg-green-400/30' : respostaUsuari === val ? 'border-red-400 bg-red-400/30' : 'border-white/20 opacity-40'
                                        : 'border-white/30 hover:border-yellow-400 hover:bg-white/10 cursor-pointer'
                                    }`}>
                                    {val ? 'âœ“ ' + t('VERTADER', 'VERDADERO', 'TRUE') : 'âœ— ' + t('FALS', 'FALSO', 'FALSE')}
                                </button>
                            ))}
                        </div>
                    )}
                    
                    {/* NumÃ¨ric - L'input real estÃ  fixat a baix de la pantalla */}
                    {p.tipus === 'numeric' && (
                        <div className="space-y-4">
                            {!mostrarResultat ? (
                                <div className="text-center py-8 text-purple-300">
                                    <span className="text-4xl block mb-3">â¬‡ï¸</span>
                                    <p className="text-lg">{t("Escriu la resposta a baix", "Escribe la respuesta abajo", "Type your answer below")}</p>
                                </div>
                            ) : (
                                <div className="text-center py-4">
                                    <p className="text-lg text-white">{t("Resposta:", "Respuesta:", "Answer:")} <strong className="text-green-400 text-2xl">{p.correcta}</strong></p>
                                    {p.pista && <p className="text-sm text-purple-300 mt-2">ğŸ’¡ {p.pista}</p>}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* Ordenar */}
                    {p.tipus === 'order' && (
                        <div className="space-y-4">
                            <div className="space-y-2">
                                {ordreUsuari.map((elemIdx, pos) => (
                                    <div key={pos} className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all ${mostrarResultat ? pos === p.ordreCorrecte.indexOf(elemIdx) ? 'border-green-400 bg-green-400/20' : 'border-red-400 bg-red-400/20' : 'border-white/30 bg-white/5'}`}>
                                        <span className="font-bold text-purple-300 w-8 text-lg">{pos + 1}.</span>
                                        <span className="flex-1 font-medium text-white">{p.elements[elemIdx]}</span>
                                        {!mostrarResultat && (
                                            <div className="flex gap-2">
                                                <button onClick={() => moureElement(pos, -1)} disabled={pos === 0} className="w-12 h-12 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold text-xl active:scale-90">â–²</button>
                                                <button onClick={() => moureElement(pos, 1)} disabled={pos === ordreUsuari.length - 1} className="w-12 h-12 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold text-xl active:scale-90">â–¼</button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                            {!mostrarResultat && <button onClick={() => handleResposta('order')} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">{t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}</button>}
                        </div>
                    )}
                    
                    {/* CLICK_CHART - GrÃ fic clicable */}
                    {p.tipus === 'click_chart' && (
                        <div className="space-y-4">
                            <div className="bg-white/5 rounded-xl p-4 border border-white/20">
                                <div className="relative h-48">
                                    {/* Eix Y */}
                                    <div className="absolute left-0 top-0 bottom-8 w-8 flex flex-col justify-between text-xs text-purple-300">
                                        <span>{Math.max(...p.chartData)}</span>
                                        <span>{Math.min(...p.chartData)}</span>
                                    </div>
                                    {/* GrÃ fic */}
                                    <div className="ml-10 h-40 flex items-end gap-1">
                                        {p.chartData.map((val, i) => {
                                            const height = ((val - Math.min(...p.chartData)) / (Math.max(...p.chartData) - Math.min(...p.chartData))) * 100;
                                            const isClicked = clickedPoint === i;
                                            const isCorrect = i >= p.correctZone.min && i <= p.correctZone.max;
                                            return (
                                                <button key={i} onClick={() => !mostrarResultat && setClickedPoint(i)} disabled={mostrarResultat}
                                                    className={`flex-1 rounded-t-lg transition-all relative group ${
                                                        mostrarResultat 
                                                            ? isCorrect ? 'bg-green-500' : isClicked ? 'bg-red-500' : 'bg-blue-500/50'
                                                            : isClicked ? 'bg-yellow-400 ring-2 ring-yellow-300' : 'bg-blue-500 hover:bg-blue-400'
                                                    }`}
                                                    style={{ height: `${Math.max(height, 10)}%` }}>
                                                    {isClicked && !mostrarResultat && <span className="absolute -top-6 left-1/2 -translate-x-1/2 text-yellow-400">ğŸ“</span>}
                                                    <span className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-purple-300 opacity-0 group-hover:opacity-100">{val}</span>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                            {!mostrarResultat && clickedPoint !== null && (
                                <button onClick={() => handleResposta(clickedPoint)} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">
                                    {t("CONFIRMAR SELECCIÃ“", "CONFIRMAR SELECCIÃ“N", "CONFIRM SELECTION")}
                                </button>
                            )}
                            {mostrarResultat && p.pista && <p className="text-sm text-purple-300 text-center">ğŸ’¡ {p.pista}</p>}
                        </div>
                    )}
                    
                    {/* ALLOCATE - Distribuir cartera */}
                    {p.tipus === 'allocate' && (
                        <div className="space-y-4">
                            {p.assets.map((asset, i) => {
                                const canDecrease = allocations[i] >= 5;
                                const canIncrease = allocations.some((val, j) => j !== i && val >= 5);
                                
                                return (
                                    <div key={i} className={`p-4 rounded-xl border-2 transition-all ${
                                        mostrarResultat 
                                            ? (allocations[i] >= p.correctRanges[i][0] && allocations[i] <= p.correctRanges[i][1]) 
                                                ? 'border-green-400 bg-green-400/20' 
                                                : 'border-red-400 bg-red-400/20'
                                            : 'border-white/30 bg-white/5'
                                    }`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-lg">
                                                <span className="mr-2">{asset.icon}</span>
                                                <span className="text-white font-medium">{asset.nom}</span>
                                            </span>
                                            <div className="flex items-center gap-2">
                                                {!mostrarResultat && (
                                                    <button 
                                                        onClick={() => {
                                                            if (!canDecrease) return;
                                                            const newAllocs = [...allocations];
                                                            newAllocs[i] -= 5;
                                                            // Afegir 5 al segÃ¼ent que tingui menys de 100
                                                            for (let j = 0; j < newAllocs.length; j++) {
                                                                if (j !== i) {
                                                                    newAllocs[j] += 5;
                                                                    break;
                                                                }
                                                            }
                                                            setAllocations(newAllocs);
                                                        }} 
                                                        disabled={!canDecrease}
                                                        className={`w-10 h-10 rounded-lg font-bold text-xl active:scale-90 transition-all ${canDecrease ? 'bg-red-500/30 text-red-300 hover:bg-red-500/50' : 'bg-white/10 text-white/30 cursor-not-allowed'}`}>
                                                        âˆ’
                                                    </button>
                                                )}
                                                <span className="text-2xl font-black text-white min-w-[70px] text-center">{allocations[i]}%</span>
                                                {!mostrarResultat && (
                                                    <button 
                                                        onClick={() => {
                                                            if (!canIncrease) return;
                                                            const newAllocs = [...allocations];
                                                            newAllocs[i] += 5;
                                                            // Treure 5 del primer que tingui >=5
                                                            for (let j = 0; j < newAllocs.length; j++) {
                                                                if (j !== i && newAllocs[j] >= 5) {
                                                                    newAllocs[j] -= 5;
                                                                    break;
                                                                }
                                                            }
                                                            setAllocations(newAllocs);
                                                        }}
                                                        disabled={!canIncrease}
                                                        className={`w-10 h-10 rounded-lg font-bold text-xl active:scale-90 transition-all ${canIncrease ? 'bg-green-500/30 text-green-300 hover:bg-green-500/50' : 'bg-white/10 text-white/30 cursor-not-allowed'}`}>
                                                        +
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        {/* Barra visual */}
                                        <div className="h-4 bg-white/10 rounded-full overflow-hidden">
                                            <div 
                                                className={`h-full transition-all duration-200 ${
                                                    mostrarResultat 
                                                        ? (allocations[i] >= p.correctRanges[i][0] && allocations[i] <= p.correctRanges[i][1]) 
                                                            ? 'bg-green-500' : 'bg-red-500'
                                                        : 'bg-gradient-to-r from-yellow-400 to-amber-500'
                                                }`}
                                                style={{ width: `${allocations[i]}%` }}
                                            ></div>
                                        </div>
                                        {mostrarResultat && (
                                            <div className="text-sm text-purple-300 mt-1">
                                                {t("Rang correcte:", "Rango correcto:", "Correct range:")} {p.correctRanges[i][0]}-{p.correctRanges[i][1]}%
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                            <div className="text-center text-lg font-bold text-green-400">
                                {t("Total:", "Total:", "Total:")} {allocations.reduce((a, b) => a + b, 0)}% âœ“
                            </div>
                            {!mostrarResultat && (
                                <button onClick={() => handleResposta('allocate')} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">
                                    {t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}
                                </button>
                            )}
                            {mostrarResultat && p.pista && <p className="text-sm text-purple-300 text-center">ğŸ’¡ {p.pista}</p>}
                        </div>
                    )}
                    
                    {/* SCENARIO - Escenaris de decisiÃ³ */}
                    {p.tipus === 'scenario' && (
                        <div className="space-y-3">
                            {p.multipleCorrect && !mostrarResultat && (
                                <p className="text-sm text-amber-300 text-center">âš ï¸ {t("Pots seleccionar mÃºltiples opcions", "Puedes seleccionar mÃºltiples opciones", "You can select multiple options")}</p>
                            )}
                            {p.opcions.map((op, i) => {
                                const isSelected = selectedOptions.includes(i);
                                const isCorrect = op.correcta;
                                return (
                                    <button key={i} 
                                        onClick={() => {
                                            if (mostrarResultat) return;
                                            if (p.multipleCorrect) {
                                                setSelectedOptions(isSelected ? selectedOptions.filter(x => x !== i) : [...selectedOptions, i]);
                                            } else {
                                                setSelectedOptions([i]);
                                            }
                                            playSound('tick');
                                        }}
                                        disabled={mostrarResultat}
                                        className={`w-full p-4 text-left rounded-xl border-2 transition-all ${
                                            mostrarResultat 
                                                ? isCorrect ? 'border-green-400 bg-green-400/30' : isSelected ? 'border-red-400 bg-red-400/30' : 'border-white/20 opacity-40'
                                                : isSelected ? 'border-yellow-400 bg-yellow-400/20' : 'border-white/30 hover:border-white/50'
                                        }`}>
                                        <span className="text-2xl mr-3">{op.icon}</span>
                                        <span className="text-white font-medium">{op.text}</span>
                                        {isSelected && !mostrarResultat && <span className="float-right text-yellow-400">âœ“</span>}
                                        {mostrarResultat && isCorrect && <span className="float-right text-green-400">âœ“</span>}
                                        {mostrarResultat && isSelected && !isCorrect && <span className="float-right text-red-400">âœ—</span>}
                                    </button>
                                );
                            })}
                            {!mostrarResultat && selectedOptions.length > 0 && (
                                <button onClick={() => handleResposta('scenario')} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">
                                    {t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}
                                </button>
                            )}
                            {mostrarResultat && p.pista && <p className="text-sm text-purple-300 text-center mt-4">ğŸ’¡ {p.pista}</p>}
                        </div>
                    )}
                    
                    {/* SLIDER_VALUE - Ajusta el valor */}
                    {p.tipus === 'slider_value' && (
                        <div className="space-y-6">
                            <div className="bg-white/5 rounded-xl p-6 border border-white/20">
                                <div className="text-center mb-4">
                                    <span className={`text-6xl font-black ${mostrarResultat ? (Math.abs(sliderValue - p.correcta) <= (p.tolerancia || 0) ? 'text-green-400' : 'text-red-400') : 'text-yellow-400'}`}>
                                        {sliderValue}
                                    </span>
                                </div>
                                {!mostrarResultat ? (
                                    <input type="range" min={p.min} max={p.max} value={sliderValue}
                                        onChange={(e) => setSliderValue(parseInt(e.target.value))}
                                        className="w-full h-4 bg-white/20 rounded-lg appearance-none cursor-pointer accent-yellow-400" />
                                ) : (
                                    <div className="text-center text-lg text-purple-300">
                                        {t("Resposta correcta:", "Respuesta correcta:", "Correct answer:")} <strong className="text-green-400">{p.correcta}</strong>
                                    </div>
                                )}
                                <div className="flex justify-between text-sm text-purple-300 mt-2">
                                    <span>{p.labels?.left || p.min}</span>
                                    <span>{p.labels?.right || p.max}</span>
                                </div>
                            </div>
                            {!mostrarResultat && (
                                <button onClick={() => handleResposta(sliderValue)} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">
                                    {t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}
                                </button>
                            )}
                            {mostrarResultat && p.pista && <p className="text-sm text-purple-300 text-center">ğŸ’¡ {p.pista}</p>}
                        </div>
                    )}
                    
                    {/* MATCH_RISK - Ordenar per risc (reutilitza ordre) */}
                    {p.tipus === 'match_risk' && (
                        <div className="space-y-4">
                            <div className="flex justify-between text-sm text-purple-300 px-2">
                                <span>ğŸ›¡ï¸ {t("Menys risc", "Menos riesgo", "Less risk")}</span>
                                <span>{t("MÃ©s risc", "MÃ¡s riesgo", "More risk")} ğŸ¢</span>
                            </div>
                            <div className="space-y-2">
                                {ordreUsuari.map((elemIdx, pos) => (
                                    <div key={pos} className={`flex items-center gap-3 p-4 rounded-xl border-2 transition-all ${
                                        mostrarResultat 
                                            ? p.ordreCorrecte[pos] === elemIdx ? 'border-green-400 bg-green-400/20' : 'border-red-400 bg-red-400/20' 
                                            : 'border-white/30 bg-white/5'
                                    }`}>
                                        <span className="text-2xl">{p.elements[elemIdx].icon}</span>
                                        <span className="flex-1 font-medium text-white">{p.elements[elemIdx].nom}</span>
                                        <span className={`text-sm px-2 py-1 rounded ${pos < 2 ? 'bg-green-500/30 text-green-300' : pos < 4 ? 'bg-yellow-500/30 text-yellow-300' : 'bg-red-500/30 text-red-300'}`}>
                                            {pos + 1}
                                        </span>
                                        {!mostrarResultat && (
                                            <div className="flex gap-1">
                                                <button onClick={() => moureElement(pos, -1)} disabled={pos === 0} className="w-10 h-10 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold active:scale-90">â–²</button>
                                                <button onClick={() => moureElement(pos, 1)} disabled={pos === ordreUsuari.length - 1} className="w-10 h-10 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold active:scale-90">â–¼</button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                            {!mostrarResultat && <button onClick={() => handleResposta('match_risk')} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95">{t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}</button>}
                        </div>
                    )}
                    
                    {/* BotÃ³ segÃ¼ent */}
                    {mostrarResultat && (
                        <div className="mt-6 pt-6 border-t border-white/20">
                            <button onClick={seguentPregunta} className="w-full py-5 gold-gradient text-slate-900 font-black text-lg rounded-xl hover:opacity-90 transform hover:scale-[1.02] transition-all active:scale-95">
                                {preguntaActual + 1 >= preguntesPartida.length ? `ğŸ† ${t('RESULTATS', 'RESULTADOS', 'RESULTS')}` : `${t('SEGÃœENT', 'SIGUIENTE', 'NEXT')} â†’`}
                            </button>
                        </div>
                    )}
                </Card>
            </div>
        );
    };

    // PANTALLA RESULTATS
    const PantallaResultats = () => {
        const correctes = respostes.filter(r => r.correcta).length;
        const pct = ((correctes / respostes.length) * 100).toFixed(0);
        const tempsTotal = respostes.reduce((acc, r) => acc + r.temps, 0);
        const mitjana = (tempsTotal / respostes.length).toFixed(1);
        
        let emoji, msg, color;
        if (pct >= 90) { emoji = 'ğŸ†'; msg = t('EXCELÂ·LENT!', 'Â¡EXCELENTE!', 'EXCELLENT!'); color = 'from-yellow-400 to-amber-500'; }
        else if (pct >= 70) { emoji = 'ğŸ‰'; msg = t('MOLT BÃ‰!', 'Â¡MUY BIEN!', 'VERY GOOD!'); color = 'from-green-400 to-emerald-500'; }
        else if (pct >= 50) { emoji = 'ğŸ‘'; msg = t('BÃ‰!', 'Â¡BIEN!', 'GOOD!'); color = 'from-blue-400 to-cyan-500'; }
        else { emoji = 'ğŸ’ª'; msg = t('CONTINUA!', 'Â¡SIGUE!', 'KEEP GOING!'); color = 'from-purple-400 to-pink-500'; }
        
        return (
            <div className="max-w-2xl mx-auto space-y-6 animate-fade">
                <Confetti show={showConfetti} />
                
                <div className={`text-center py-10 bg-gradient-to-r ${color} rounded-3xl relative overflow-hidden`}>
                    <div className="absolute inset-0 bg-white/10"></div>
                    <span className="text-8xl block mb-4 animate-bounce relative z-10">{emoji}</span>
                    <h2 className="text-4xl font-black text-white mb-2 relative z-10">{msg}</h2>
                    <p className="text-xl text-white/80 relative z-10">{nomJugador}</p>
                </div>
                
                <Card>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div className="p-4 bg-yellow-400/20 rounded-xl">
                            <p className="text-4xl font-black text-yellow-400">{puntuacio}</p>
                            <p className="text-sm text-purple-300">{t("Punts", "Puntos", "Points")}</p>
                        </div>
                        <div className="p-4 bg-green-400/20 rounded-xl">
                            <p className="text-4xl font-black text-green-400">{correctes}/{respostes.length}</p>
                            <p className="text-sm text-purple-300">{t("Encerts", "Aciertos", "Correct")}</p>
                        </div>
                        <div className="p-4 bg-blue-400/20 rounded-xl">
                            <p className="text-4xl font-black text-blue-400">{pct}%</p>
                            <p className="text-sm text-purple-300">{t("PrecisiÃ³", "PrecisiÃ³n", "Accuracy")}</p>
                        </div>
                        <div className="p-4 bg-orange-400/20 rounded-xl">
                            <p className="text-4xl font-black text-orange-400">ğŸ”¥{maxRatxa}</p>
                            <p className="text-sm text-purple-300">{t("Max ratxa", "Max racha", "Max streak")}</p>
                        </div>
                    </div>
                    
                    <div className="mt-6 p-4 bg-purple-500/20 rounded-xl text-center border border-purple-400/30">
                        <span className="text-2xl">ğŸ“Š</span>
                        <p className="text-purple-200 font-medium mt-1">{t("Resultat enviat al ranking global!", "Â¡Resultado enviado al ranking global!", "Result sent to global ranking!")}</p>
                        <p className="text-purple-300/60 text-sm">{t("Mira el ranking per veure la teua posiciÃ³", "Mira el ranking para ver tu posiciÃ³n", "Check ranking to see your position")}</p>
                    </div>
                </Card>
                
                <div className="flex gap-3">
                    <button onClick={() => { setFase('inici'); setPuntuacio(0); setRespostes([]); setMaxRatxa(0); }} className="flex-1 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90 active:scale-95 transition-all">
                        ğŸ”„ {t("Tornar a jugar", "Volver a jugar", "Play again")}
                    </button>
                    <button onClick={() => setFase('ranking')} className="flex-1 py-4 gold-gradient text-slate-900 font-bold rounded-xl hover:opacity-90 active:scale-95 transition-all">
                        ğŸ† Ranking
                    </button>
                </div>
            </div>
        );
    };

    // PANTALLA RANKING - AMB PÃ’DIUM I FILTRES
    const PantallaRanking = () => {
        const categoriaLabels = {
            general: { icon: 'ğŸ¯', label: t('General', 'General', 'General') },
            economia: { icon: 'ğŸ“ˆ', label: t('Economia', 'EconomÃ­a', 'Economics') },
            finances: { icon: 'ğŸ’°', label: t('Finances', 'Finanzas', 'Finance') },
            empresa: { icon: 'ğŸ¢', label: t('Empresa', 'Empresa', 'Business') }
        };
        
        const top3 = ranking.slice(0, 3);
        const rest = ranking.slice(3, 10);
        
        return (
            <div className="max-w-2xl mx-auto space-y-4 animate-fade">
                {/* Header */}
                <div className="text-center py-4">
                    <span className="text-5xl mb-2 block">ğŸ†</span>
                    <h2 className="text-3xl font-black text-white">RANKING</h2>
                    <p className="text-purple-300 text-sm">{t("Competeix per ser el millor!", "Â¡Compite por ser el mejor!", "Compete to be the best!")}</p>
                </div>
                
                {/* Filtres de temps */}
                <div className="flex gap-2 justify-center">
                    <button 
                        onClick={() => setRankingFilter(f => ({ ...f, temps: 'etern' }))}
                        className={`px-4 py-2 rounded-lg font-bold transition-all ${rankingFilter.temps === 'etern' ? 'bg-yellow-400 text-slate-900' : 'bg-white/10 text-white hover:bg-white/20'}`}>
                        ğŸŒŸ {t("Etern", "Eterno", "All-time")}
                    </button>
                    <button 
                        onClick={() => setRankingFilter(f => ({ ...f, temps: 'mensual' }))}
                        className={`px-4 py-2 rounded-lg font-bold transition-all ${rankingFilter.temps === 'mensual' ? 'bg-yellow-400 text-slate-900' : 'bg-white/10 text-white hover:bg-white/20'}`}>
                        ğŸ“… {t("Mensual", "Mensual", "Monthly")}
                    </button>
                </div>
                
                {/* Filtres de categoria */}
                <div className="flex gap-2 justify-center flex-wrap">
                    {Object.entries(categoriaLabels).map(([key, val]) => (
                        <button 
                            key={key}
                            onClick={() => setRankingFilter(f => ({ ...f, categoria: key }))}
                            className={`px-3 py-1.5 rounded-lg text-sm font-bold transition-all ${rankingFilter.categoria === key ? 'bg-purple-500 text-white' : 'bg-white/10 text-white/70 hover:bg-white/20'}`}>
                            {val.icon} {val.label}
                        </button>
                    ))}
                </div>
                
                {rankingLoading ? (
                    <div className="text-center py-10">
                        <span className="text-4xl animate-spin inline-block">â³</span>
                        <p className="text-purple-300 mt-2">{t("Carregant...", "Cargando...", "Loading...")}</p>
                    </div>
                ) : ranking.length === 0 ? (
                    <Card>
                        <div className="text-center py-10 text-purple-300">
                            <span className="text-5xl block mb-3">ğŸ“­</span>
                            <p className="text-lg">{t("Encara no hi ha puntuacions", "AÃºn no hay puntuaciones", "No scores yet")}</p>
                            <p className="text-sm mt-1">{t("Sigues el primer!", "Â¡SÃ© el primero!", "Be the first!")}</p>
                        </div>
                    </Card>
                ) : (
                    <>
                        {/* PÃ’DIUM - Top 3 */}
                        <div className="flex justify-center items-end gap-2 py-4 px-2">
                            {/* 2n lloc - Plata */}
                            {top3[1] && (
                                <div className="flex flex-col items-center animate-fade" style={{animationDelay: '0.1s'}}>
                                    <div className="text-3xl mb-1">ğŸ¥ˆ</div>
                                    <div className="w-24 bg-gradient-to-b from-slate-300 to-slate-400 rounded-t-xl p-3 text-center" style={{height: '100px'}}>
                                        <p className="font-black text-slate-800 text-sm truncate">{top3[1].nom}</p>
                                        <p className="text-2xl font-black text-slate-900">{top3[1].punts}</p>
                                        <p className="text-xs text-slate-600">{top3[1].correctes}/20</p>
                                    </div>
                                    <div className="w-24 bg-slate-400 text-slate-100 font-black text-2xl py-2 text-center">2</div>
                                </div>
                            )}
                            
                            {/* 1r lloc - Or */}
                            {top3[0] && (
                                <div className="flex flex-col items-center animate-fade">
                                    <div className="text-4xl mb-1 animate-bounce">ğŸ‘‘</div>
                                    <div className="w-28 gold-gradient rounded-t-xl p-3 text-center animate-glow" style={{height: '130px'}}>
                                        <p className="font-black text-slate-800 truncate">{top3[0].nom}</p>
                                        <p className="text-3xl font-black text-slate-900">{top3[0].punts}</p>
                                        <p className="text-xs text-slate-700">{top3[0].correctes}/20 Â· ğŸ”¥{top3[0].maxRatxa}</p>
                                    </div>
                                    <div className="w-28 bg-yellow-500 text-yellow-900 font-black text-2xl py-2 text-center">1</div>
                                </div>
                            )}
                            
                            {/* 3r lloc - Bronze */}
                            {top3[2] && (
                                <div className="flex flex-col items-center animate-fade" style={{animationDelay: '0.2s'}}>
                                    <div className="text-3xl mb-1">ğŸ¥‰</div>
                                    <div className="w-24 bg-gradient-to-b from-orange-400 to-orange-500 rounded-t-xl p-3 text-center" style={{height: '80px'}}>
                                        <p className="font-black text-orange-900 text-sm truncate">{top3[2].nom}</p>
                                        <p className="text-2xl font-black text-orange-900">{top3[2].punts}</p>
                                        <p className="text-xs text-orange-700">{top3[2].correctes}/20</p>
                                    </div>
                                    <div className="w-24 bg-orange-600 text-orange-100 font-black text-2xl py-2 text-center">3</div>
                                </div>
                            )}
                        </div>
                        
                        {/* Resta del ranking (4-10) */}
                        {rest.length > 0 && (
                            <Card>
                                <div className="space-y-2">
                                    {rest.map((entry, i) => (
                                        <div key={i} className="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                                            <div className="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center font-bold text-white">
                                                {i + 4}
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <p className="font-bold text-white truncate">{entry.nom}</p>
                                                <p className="text-xs text-purple-300">{entry.data} Â· {entry.correctes}/20 Â· ğŸ”¥{entry.maxRatxa || 0}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-xl font-black text-yellow-400">{entry.punts}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </Card>
                        )}
                    </>
                )}
                
                {/* Info */}
                <div className="text-center text-xs text-purple-400/60 px-4">
                    {t("MÃ xim 3 entrades per jugador. Competeix per pujar!", "MÃ¡ximo 3 entradas por jugador. Â¡Compite para subir!", "Max 3 entries per player. Compete to climb!")}
                </div>
                
                <button onClick={() => setFase('inici')} className="w-full py-4 bg-white/10 border border-white/30 text-white font-bold rounded-xl hover:bg-white/20 active:scale-95 transition-all">
                    â† {t("Tornar", "Volver", "Back")}
                </button>
            </div>
        );
    };

    return (
        <div className="min-h-screen py-6 px-4">
            <Toast {...toast} />
            <PointsPopup {...pointsPopup} />
            <div className="max-w-4xl mx-auto">
                {fase === 'inici' && <PantallaInici />}
                {fase === 'jugant' && <PantallaJoc />}
                {fase === 'resultats' && <PantallaResultats />}
                {fase === 'ranking' && <PantallaRanking />}
                <footer className="mt-8 text-center text-purple-400/60 text-sm">
                    <p>Concurs PDE Â· profedeeconomia.es Â· 2025</p>
                </footer>
            </div>
        </div>
    );
}

ReactDOM.render(<ConcursApp />, document.getElementById('root'));
    </script>
</body>
</html>
