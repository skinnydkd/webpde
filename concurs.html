<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† Concurs PDE - Economia, Finances i Empresa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Plus Jakarta Sans', -apple-system, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-fade { animation: fadeIn 0.4s ease-out; }
        .animate-pulse-custom { animation: pulse 0.5s ease-in-out; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        .gold-gradient { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect, useMemo } = React;

function ConcursApp() {
    const [idioma, setIdioma] = useState('val');
    const [fase, setFase] = useState('inici');
    const [categoria, setCategoria] = useState('totes');
    const [nomJugador, setNomJugador] = useState('');
    const [preguntaActual, setPreguntaActual] = useState(0);
    const [puntuacio, setPuntuacio] = useState(0);
    const [tempsRestant, setTempsRestant] = useState(60);
    const [respostes, setRespostes] = useState([]);
    const [ratxa, setRatxa] = useState(0);
    const [preguntesPartida, setPreguntesPartida] = useState([]);
    const [respostaUsuari, setRespostaUsuari] = useState(null);
    const [mostrarResultat, setMostrarResultat] = useState(false);
    const [ranking, setRanking] = useState([]);
    const [ordreUsuari, setOrdreUsuari] = useState([]);
    const [inputNumeric, setInputNumeric] = useState('');

    const t = (val, es, en) => idioma === 'val' ? val : idioma === 'es' ? es : en;

    // BANC DE PREGUNTES AMPLIAT - MÃ©s cÃ lculs, grÃ fics, ordenar i fÃ³rmules
    const bancPreguntes = useMemo(() => ({
        economia: [
            // CÃ€LCULS (7)
            { id: 'ec1', tipus: 'numeric', dificultat: 'facil', pregunta: t("Si el preu puja de 10â‚¬ a 12â‚¬ i la demanda baixa de 100 a 80 unitats, quina Ã©s l'elasticitat-preu? (valor absolut)", "Si el precio sube de 10â‚¬ a 12â‚¬ y la demanda baja de 100 a 80 unidades, Â¿cuÃ¡l es la elasticidad-precio? (valor absoluto)", "If price rises from â‚¬10 to â‚¬12 and demand drops from 100 to 80 units, what's the price elasticity? (absolute value)"), correcta: 1, tolerancia: 0.1 },
            { id: 'ec2', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("PIB = C + I + G + (X-M). Si C=500, I=200, G=150, X=100, M=80. Quin Ã©s el PIB?", "PIB = C + I + G + (X-M). Si C=500, I=200, G=150, X=100, M=80. Â¿CuÃ¡l es el PIB?", "GDP = C + I + G + (X-M). If C=500, I=200, G=150, X=100, M=80. What's GDP?"), correcta: 870, tolerancia: 0 },
            { id: 'ec3', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Taxa d'atur: 2M d'aturats, 18M d'ocupats. Calcula la taxa en %.", "Tasa de paro: 2M parados, 18M ocupados. Calcula la tasa en %.", "Unemployment rate: 2M unemployed, 18M employed. Calculate rate in %."), correcta: 10, tolerancia: 0 },
            { id: 'ec4', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Multiplicador keynesiÃ : PMC=0.8. Quin Ã©s el multiplicador? (1/(1-PMC))", "Multiplicador keynesiano: PMC=0.8. Â¿CuÃ¡l es el multiplicador?", "Keynesian multiplier: MPC=0.8. What's the multiplier?"), correcta: 5, tolerancia: 0 },
            { id: 'ec5', tipus: 'numeric', dificultat: 'facil', pregunta: t("InflaciÃ³: IPC any passat=100, IPC actual=103. Quina Ã©s la inflaciÃ³ en %?", "InflaciÃ³n: IPC aÃ±o pasado=100, IPC actual=103. Â¿CuÃ¡l es la inflaciÃ³n en %?", "Inflation: CPI last year=100, current CPI=103. What's inflation in %?"), correcta: 3, tolerancia: 0 },
            { id: 'ec6', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Creixement real: PIB nominal creix 7%, inflaciÃ³ 4%. Quin Ã©s el creixement real aproximat?", "Crecimiento real: PIB nominal crece 7%, inflaciÃ³n 4%. Â¿CuÃ¡l es el crecimiento real aproximado?", "Real growth: Nominal GDP grows 7%, inflation 4%. What's approx real growth?"), correcta: 3, tolerancia: 0.5 },
            { id: 'ec7', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("BalanÃ§a comercial: Exportacions=50.000Mâ‚¬, Importacions=65.000Mâ‚¬. Saldo en Mâ‚¬?", "Balanza comercial: Exportaciones=50.000Mâ‚¬, Importaciones=65.000Mâ‚¬. Â¿Saldo en Mâ‚¬?", "Trade balance: Exports=â‚¬50,000M, Imports=â‚¬65,000M. Balance in Mâ‚¬?"), correcta: -15000, tolerancia: 0 },
            
            // ORDENAR (4)
            { id: 'eo1', tipus: 'order', dificultat: 'mitjana', pregunta: t("Ordena les fases del cicle econÃ²mic:", "Ordena las fases del ciclo econÃ³mico:", "Order the business cycle phases:"), elements: [t("ExpansiÃ³", "ExpansiÃ³n", "Expansion"), t("Cim/Auge", "Cima/Auge", "Peak"), t("RecessiÃ³", "RecesiÃ³n", "Recession"), t("Fons/DepressiÃ³", "Valle/DepresiÃ³n", "Trough")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo2', tipus: 'order', dificultat: 'dificil', pregunta: t("Ordena cronolÃ²gicament les escoles econÃ²miques:", "Ordena cronolÃ³gicamente las escuelas econÃ³micas:", "Order economic schools chronologically:"), elements: [t("Mercantilisme", "Mercantilismo", "Mercantilism"), t("FisiocrÃ cia", "Fisiocracia", "Physiocracy"), t("ClÃ ssica (Smith)", "ClÃ¡sica (Smith)", "Classical (Smith)"), t("Keynesianisme", "Keynesianismo", "Keynesianism")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo3', tipus: 'order', dificultat: 'mitjana', pregunta: t("Ordena de menys a mÃ©s intervenciÃ³ estatal:", "Ordena de menos a mÃ¡s intervenciÃ³n estatal:", "Order from least to most state intervention:"), elements: [t("Liberalisme", "Liberalismo", "Liberalism"), t("Economia mixta", "EconomÃ­a mixta", "Mixed economy"), t("Socialisme", "Socialismo", "Socialism"), t("Economia planificada", "EconomÃ­a planificada", "Planned economy")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'eo4', tipus: 'order', dificultat: 'facil', pregunta: t("Ordena els sectors econÃ²mics per ordre clÃ ssic:", "Ordena los sectores econÃ³micos por orden clÃ¡sico:", "Order economic sectors classically:"), elements: [t("Primari", "Primario", "Primary"), t("Secundari", "Secundario", "Secondary"), t("Terciari", "Terciario", "Tertiary")], ordreCorrecte: [0, 1, 2] },
            
            // FÃ“RMULES (4)
            { id: 'ef1', tipus: 'formula', dificultat: 'facil', pregunta: t("PIB = C + I + G + ___", "PIB = C + I + G + ___", "GDP = C + I + G + ___"), opcions: ["(X-M)", "(M-X)", "T", "S"], correcta: 0 },
            { id: 'ef2', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Taxa d'atur = Aturats / ___ Ã— 100", "Tasa de paro = Parados / ___ Ã— 100", "Unemployment rate = Unemployed / ___ Ã— 100"), opcions: [t("PoblaciÃ³ activa", "PoblaciÃ³n activa", "Labor force"), t("PoblaciÃ³ total", "PoblaciÃ³n total", "Total population"), t("Ocupats", "Ocupados", "Employed"), "PIB"], correcta: 0 },
            { id: 'ef3', tipus: 'formula', dificultat: 'mitjana', pregunta: t("InflaciÃ³ = (IPC actual - IPC anterior) / ___ Ã— 100", "InflaciÃ³n = (IPC actual - IPC anterior) / ___ Ã— 100", "Inflation = (Current CPI - Previous CPI) / ___ Ã— 100"), opcions: ["IPC anterior", "IPC actual", "100", "PIB"], correcta: 0 },
            { id: 'ef4', tipus: 'formula', dificultat: 'dificil', pregunta: t("Multiplicador keynesiÃ  = 1 / (1 - ___)", "Multiplicador keynesiano = 1 / (1 - ___)", "Keynesian multiplier = 1 / (1 - ___)"), opcions: ["PMC", "PMA", "i", "G"], correcta: 0 },
            
            // GRÃ€FICS/IDENTIFICAR (3)
            { id: 'eg1', tipus: 'identify', dificultat: 'facil', pregunta: t("Quin grÃ fic representa l'equilibri entre oferta i demanda?", "Â¿QuÃ© grÃ¡fico representa el equilibrio entre oferta y demanda?", "Which graph shows supply-demand equilibrium?"), imatge: "oferta_demanda", opcions: [t("Corba de Phillips", "Curva de Phillips", "Phillips Curve"), t("Oferta-Demanda", "Oferta-Demanda", "Supply-Demand"), t("IS-LM", "IS-LM", "IS-LM"), t("Corba de Laffer", "Curva de Laffer", "Laffer Curve")], correcta: 1 },
            { id: 'eg2', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Identifica el model macroeconÃ²mic:", "Identifica el modelo macroeconÃ³mico:", "Identify the macro model:"), imatge: "islm", opcions: ["AD-AS", "IS-LM", t("Flux circular", "Flujo circular", "Circular flow"), "Phillips"], correcta: 1 },
            { id: 'eg3', tipus: 'identify', dificultat: 'dificil', pregunta: t("Aquesta corba mostra la relaciÃ³ entre impostos i recaptaciÃ³:", "Esta curva muestra la relaciÃ³n entre impuestos y recaudaciÃ³n:", "This curve shows the tax-revenue relationship:"), imatge: "laffer", opcions: ["Phillips", "Lorenz", "Laffer", "Engel"], correcta: 2 },
            
            // VERTADER/FALS (2)
            { id: 'ev1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("La inflaciÃ³ Ã©s la pujada generalitzada i sostinguda dels preus", "La inflaciÃ³n es la subida generalizada y sostenida de los precios", "Inflation is the general and sustained rise in prices"), correcta: true },
            { id: 'ev2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("Segons la corba de Phillips, hi ha una relaciÃ³ directa entre inflaciÃ³ i atur", "SegÃºn la curva de Phillips, hay una relaciÃ³n directa entre inflaciÃ³n y paro", "According to Phillips curve, there's a direct relation between inflation and unemployment"), correcta: false },
        ],
        finances: [
            // CÃ€LCULS (10)
            { id: 'fc1', tipus: 'numeric', dificultat: 'facil', pregunta: t("Marge brut: Compres per 80â‚¬, vens per 120â‚¬. Marge en %?", "Margen bruto: Compras por 80â‚¬, vendes por 120â‚¬. Â¿Margen en %?", "Gross margin: Buy for â‚¬80, sell for â‚¬120. Margin %?"), correcta: 50, tolerancia: 0 },
            { id: 'fc2', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("ROE: Benefici Net 30.000â‚¬, Patrimoni Net 150.000â‚¬. ROE en %?", "ROE: Beneficio Neto 30.000â‚¬, Patrimonio Neto 150.000â‚¬. Â¿ROE en %?", "ROE: Net Profit â‚¬30,000, Equity â‚¬150,000. ROE %?"), correcta: 20, tolerancia: 0 },
            { id: 'fc3', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("ROA: Benefici Net 25.000â‚¬, Actiu Total 500.000â‚¬. ROA en %?", "ROA: Beneficio Neto 25.000â‚¬, Activo Total 500.000â‚¬. Â¿ROA en %?", "ROA: Net Profit â‚¬25,000, Total Assets â‚¬500,000. ROA %?"), correcta: 5, tolerancia: 0 },
            { id: 'fc4', tipus: 'numeric', dificultat: 'facil', pregunta: t("Liquiditat: AC=90.000â‚¬, PC=45.000â‚¬. RÃ tio de liquiditat?", "Liquidez: AC=90.000â‚¬, PC=45.000â‚¬. Â¿Ratio de liquidez?", "Liquidity: CA=â‚¬90,000, CL=â‚¬45,000. Current ratio?"), correcta: 2, tolerancia: 0 },
            { id: 'fc5', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Endeutament: Passiu=120.000â‚¬, Actiu Total=200.000â‚¬. RÃ tio en %?", "Endeudamiento: Pasivo=120.000â‚¬, Activo Total=200.000â‚¬. Â¿Ratio en %?", "Debt ratio: Liabilities=â‚¬120,000, Total Assets=â‚¬200,000. Ratio %?"), correcta: 60, tolerancia: 0 },
            { id: 'fc6', tipus: 'numeric', dificultat: 'dificil', pregunta: t("VAN: Iâ‚€=10.000â‚¬, FCâ‚=6.000â‚¬, FCâ‚‚=6.000â‚¬, k=10%. VAN arrodonit?", "VAN: Iâ‚€=10.000â‚¬, FCâ‚=6.000â‚¬, FCâ‚‚=6.000â‚¬, k=10%. Â¿VAN redondeado?", "NPV: Iâ‚€=â‚¬10,000, CFâ‚=â‚¬6,000, CFâ‚‚=â‚¬6,000, k=10%. Rounded NPV?"), correcta: 412, tolerancia: 20 },
            { id: 'fc7', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Fons de Maniobra: AC=80.000â‚¬, PC=50.000â‚¬. FM?", "Fondo de Maniobra: AC=80.000â‚¬, PC=50.000â‚¬. Â¿FM?", "Working Capital: CA=â‚¬80,000, CL=â‚¬50,000. WC?"), correcta: 30000, tolerancia: 0 },
            { id: 'fc8', tipus: 'numeric', dificultat: 'facil', pregunta: t("Payback: InversiÃ³=12.000â‚¬, FC anual=4.000â‚¬. Anys de recuperaciÃ³?", "Payback: InversiÃ³n=12.000â‚¬, FC anual=4.000â‚¬. Â¿AÃ±os de recuperaciÃ³n?", "Payback: Investment=â‚¬12,000, annual CF=â‚¬4,000. Recovery years?"), correcta: 3, tolerancia: 0 },
            { id: 'fc9', tipus: 'numeric', dificultat: 'dificil', pregunta: t("InterÃ¨s compost: 10.000â‚¬ al 5% anual durant 2 anys. Capital final arrodonit?", "InterÃ©s compuesto: 10.000â‚¬ al 5% anual durante 2 aÃ±os. Â¿Capital final redondeado?", "Compound interest: â‚¬10,000 at 5% annual for 2 years. Rounded final capital?"), correcta: 11025, tolerancia: 5 },
            { id: 'fc10', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Test Ã cid: (AC-ExistÃ¨ncies)/PC. AC=100.000â‚¬, Exist.=30.000â‚¬, PC=50.000â‚¬. RÃ tio?", "Test Ã¡cido: (AC-Existencias)/PC. AC=100.000â‚¬, Exist.=30.000â‚¬, PC=50.000â‚¬. Â¿Ratio?", "Acid test: (CA-Inventory)/CL. CA=â‚¬100,000, Inv.=â‚¬30,000, CL=â‚¬50,000. Ratio?"), correcta: 1.4, tolerancia: 0.01 },
            
            // FÃ“RMULES (5)
            { id: 'ff1', tipus: 'formula', dificultat: 'facil', pregunta: t("Fons de Maniobra = AC - ___", "Fondo de Maniobra = AC - ___", "Working Capital = CA - ___"), opcions: ["PC", "PN", "ANC", "PNC"], correcta: 0 },
            { id: 'ff2', tipus: 'formula', dificultat: 'mitjana', pregunta: t("ROE = Benefici Net / ___", "ROE = Beneficio Neto / ___", "ROE = Net Profit / ___"), opcions: [t("Patrimoni Net", "Patrimonio Neto", "Equity"), t("Actiu Total", "Activo Total", "Total Assets"), t("Vendes", "Ventas", "Sales"), "Passiu"], correcta: 0 },
            { id: 'ff3', tipus: 'formula', dificultat: 'mitjana', pregunta: t("VAN = Î£ FC/(1+k)^n - ___", "VAN = Î£ FC/(1+k)^n - ___", "NPV = Î£ CF/(1+k)^n - ___"), opcions: ["Iâ‚€", "TIR", "k", "n"], correcta: 0 },
            { id: 'ff4', tipus: 'formula', dificultat: 'dificil', pregunta: t("TIR Ã©s la taxa k que fa que el VAN sigui igual a ___", "TIR es la tasa k que hace que el VAN sea igual a ___", "IRR is the rate k that makes NPV equal to ___"), opcions: ["0", "1", "Iâ‚€", "âˆ"], correcta: 0 },
            { id: 'ff5', tipus: 'formula', dificultat: 'facil', pregunta: t("RÃ tio de Liquiditat = ___ / PC", "Ratio de Liquidez = ___ / PC", "Current Ratio = ___ / CL"), opcions: ["AC", "ANC", "FM", "PN"], correcta: 0 },
            
            // IDENTIFICAR (3)
            { id: 'fi1', tipus: 'identify', dificultat: 'facil', pregunta: t("Aquest document mostra l'estructura patrimonial:", "Este documento muestra la estructura patrimonial:", "This document shows the asset structure:"), imatge: "balanc", opcions: [t("BalanÃ§", "Balance", "Balance Sheet"), t("Compte de PiG", "Cuenta de PyG", "P&L Statement"), t("Estat de fluxos", "Estado de flujos", "Cash Flow"), "DAFO"], correcta: 0 },
            { id: 'fi2', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Quin tipus de finanÃ§ament Ã©s el LEASING?", "Â¿QuÃ© tipo de financiaciÃ³n es el LEASING?", "What type of financing is LEASING?"), imatge: "leasing", opcions: [t("Propi", "Propio", "Own"), t("AliÃ¨ a llarg termini", "Ajeno a largo plazo", "Long-term external"), t("AliÃ¨ a curt termini", "Ajeno a corto plazo", "Short-term external"), t("AutofinanÃ§ament", "AutofinanciaciÃ³n", "Self-financing")], correcta: 1 },
            { id: 'fi3', tipus: 'identify', dificultat: 'mitjana', pregunta: t("El FACTORING serveix per...", "El FACTORING sirve para...", "FACTORING is used for..."), imatge: "factoring", opcions: [t("Comprar maquinÃ ria", "Comprar maquinaria", "Buy machinery"), t("AvanÃ§ar cobraments", "Adelantar cobros", "Advance collections"), t("FinanÃ§ar exportacions", "Financiar exportaciones", "Finance exports"), t("Pagar impostos", "Pagar impuestos", "Pay taxes")], correcta: 1 },
            
            // VERTADER/FALS (2)
            { id: 'fv1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("Un VAN positiu indica que el projecte Ã©s rendible", "Un VAN positivo indica que el proyecto es rentable", "Positive NPV indicates a profitable project"), correcta: true },
            { id: 'fv2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("El Payback descomptat tÃ© en compte el valor temporal dels diners", "El Payback descontado tiene en cuenta el valor temporal del dinero", "Discounted Payback considers time value of money"), correcta: true },
        ],
        empresa: [
            // CÃ€LCULS (8)
            { id: 'emc1', tipus: 'numeric', dificultat: 'facil', pregunta: t("Punt Mort: CF=15.000â‚¬, Preu=60â‚¬, CVu=30â‚¬. Unitats d'equilibri?", "Punto Muerto: CF=15.000â‚¬, Precio=60â‚¬, CVu=30â‚¬. Â¿Unidades de equilibrio?", "Break-even: FC=â‚¬15,000, Price=â‚¬60, VCu=â‚¬30. Break-even units?"), correcta: 500, tolerancia: 0 },
            { id: 'emc2', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Cost Total: CF=8.000â‚¬, CVu=15â‚¬, Q=400. Cost Total?", "Coste Total: CF=8.000â‚¬, CVu=15â‚¬, Q=400. Â¿Coste Total?", "Total Cost: FC=â‚¬8,000, VCu=â‚¬15, Q=400. Total Cost?"), correcta: 14000, tolerancia: 0 },
            { id: 'emc3', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Productivitat: ProducciÃ³=10.000u, Treballadors=25. Productivitat per treballador?", "Productividad: ProducciÃ³n=10.000u, Trabajadores=25. Â¿Productividad por trabajador?", "Productivity: Output=10,000u, Workers=25. Productivity per worker?"), correcta: 400, tolerancia: 0 },
            { id: 'emc4', tipus: 'numeric', dificultat: 'facil', pregunta: t("Marge de contribuciÃ³ unitari: Preu=100â‚¬, CVu=60â‚¬. MCu?", "Margen de contribuciÃ³n unitario: Precio=100â‚¬, CVu=60â‚¬. Â¿MCu?", "Unit contribution margin: Price=â‚¬100, VCu=â‚¬60. UCM?"), correcta: 40, tolerancia: 0 },
            { id: 'emc5', tipus: 'numeric', dificultat: 'dificil', pregunta: t("EOQ (Wilson): D=10.000u/any, Cp=50â‚¬/comanda, Ca=2â‚¬/uÂ·any. Lot Ã²ptim arrodonit?", "EOQ (Wilson): D=10.000u/aÃ±o, Cp=50â‚¬/pedido, Ca=2â‚¬/uÂ·aÃ±o. Â¿Lote Ã³ptimo redondeado?", "EOQ (Wilson): D=10,000u/year, Cp=â‚¬50/order, Ca=â‚¬2/uÂ·year. Rounded optimal lot?"), correcta: 707, tolerancia: 15 },
            { id: 'emc6', tipus: 'numeric', dificultat: 'mitjana', pregunta: t("Benefici: Ingressos=200.000â‚¬, Costos=150.000â‚¬. Benefici?", "Beneficio: Ingresos=200.000â‚¬, Costes=150.000â‚¬. Â¿Beneficio?", "Profit: Revenue=â‚¬200,000, Costs=â‚¬150,000. Profit?"), correcta: 50000, tolerancia: 0 },
            { id: 'emc7', tipus: 'numeric', dificultat: 'facil', pregunta: t("Salari net: Brut=2.000â‚¬, SS treballador=127â‚¬, IRPF=300â‚¬. Net?", "Salario neto: Bruto=2.000â‚¬, SS trabajador=127â‚¬, IRPF=300â‚¬. Â¿Neto?", "Net salary: Gross=â‚¬2,000, Worker SS=â‚¬127, Tax=â‚¬300. Net?"), correcta: 1573, tolerancia: 0 },
            { id: 'emc8', tipus: 'numeric', dificultat: 'dificil', pregunta: t("Apalancament operatiu: MC=50.000â‚¬, BAII=20.000â‚¬. Grau d'apalancament?", "Apalancamiento operativo: MC=50.000â‚¬, BAII=20.000â‚¬. Â¿Grado de apalancamiento?", "Operating leverage: CM=â‚¬50,000, EBIT=â‚¬20,000. Leverage degree?"), correcta: 2.5, tolerancia: 0.1 },
            
            // ORDENAR (5)
            { id: 'emo1', tipus: 'order', dificultat: 'facil', pregunta: t("PirÃ mide de Maslow (de baix a dalt):", "PirÃ¡mide de Maslow (de abajo a arriba):", "Maslow's pyramid (bottom to top):"), elements: [t("FisiolÃ²giques", "FisiolÃ³gicas", "Physiological"), t("Seguretat", "Seguridad", "Safety"), t("Socials", "Sociales", "Social"), t("Estima", "Estima", "Esteem"), t("AutorealitzaciÃ³", "AutorrealizaciÃ³n", "Self-actualization")], ordreCorrecte: [0, 1, 2, 3, 4] },
            { id: 'emo2', tipus: 'order', dificultat: 'mitjana', pregunta: t("Cicle de vida del producte:", "Ciclo de vida del producto:", "Product life cycle:"), elements: [t("IntroducciÃ³", "IntroducciÃ³n", "Introduction"), t("Creixement", "Crecimiento", "Growth"), t("Maduresa", "Madurez", "Maturity"), t("Declivi", "Declive", "Decline")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo3', tipus: 'order', dificultat: 'mitjana', pregunta: t("ProcÃ©s de selecciÃ³ de personal:", "Proceso de selecciÃ³n de personal:", "Staff selection process:"), elements: [t("AnÃ lisi del lloc", "AnÃ¡lisis del puesto", "Job analysis"), t("Reclutament", "Reclutamiento", "Recruitment"), t("Entrevistes", "Entrevistas", "Interviews"), t("ContractaciÃ³", "ContrataciÃ³n", "Hiring")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo4', tipus: 'order', dificultat: 'dificil', pregunta: t("Etapes del pla d'empresa:", "Etapas del plan de empresa:", "Business plan stages:"), elements: [t("Idea", "Idea", "Idea"), t("Pla de mÃ rqueting", "Plan de marketing", "Marketing plan"), t("Pla financer", "Plan financiero", "Financial plan"), t("Viabilitat", "Viabilidad", "Viability")], ordreCorrecte: [0, 1, 2, 3] },
            { id: 'emo5', tipus: 'order', dificultat: 'facil', pregunta: t("Ordena de menys a mÃ©s capital mÃ­nim (Espanya):", "Ordena de menos a mÃ¡s capital mÃ­nimo (EspaÃ±a):", "Order from least to most minimum capital (Spain):"), elements: [t("AutÃ²nom", "AutÃ³nomo", "Self-employed"), "SL (1â‚¬)", "SL (3.000â‚¬)", "SA (60.000â‚¬)"], ordreCorrecte: [0, 1, 2, 3] },
            
            // IDENTIFICAR GRÃ€FICS (6)
            { id: 'emi1', tipus: 'identify', dificultat: 'facil', pregunta: t("Identifica aquesta matriu:", "Identifica esta matriz:", "Identify this matrix:"), imatge: "bcg", opcions: ["DAFO", "Ansoff", "BCG", "Porter"], correcta: 2 },
            { id: 'emi2', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Quin quadrant de la BCG tÃ© alta quota i alt creixement?", "Â¿QuÃ© cuadrante de la BCG tiene alta cuota y alto crecimiento?", "Which BCG quadrant has high share and high growth?"), imatge: "bcg", opcions: [t("Vaca", "Vaca", "Cash Cow"), t("Estrella", "Estrella", "Star"), t("Interrogant", "Interrogante", "Question Mark"), t("Gos", "Perro", "Dog")], correcta: 1 },
            { id: 'emi3', tipus: 'identify', dificultat: 'mitjana', pregunta: t("A Ansoff: Producte NOU + Mercat NOU =", "En Ansoff: Producto NUEVO + Mercado NUEVO =", "In Ansoff: NEW Product + NEW Market ="), imatge: "ansoff", opcions: [t("PenetraciÃ³", "PenetraciÃ³n", "Penetration"), t("Desenv. mercat", "Desarrollo mercado", "Market dev."), t("Desenv. producte", "Desarrollo producto", "Product dev."), t("DiversificaciÃ³", "DiversificaciÃ³n", "Diversification")], correcta: 3 },
            { id: 'emi4', tipus: 'identify', dificultat: 'dificil', pregunta: t("Al Canvas, 'per quÃ¨ ens trien els clients' Ã©s:", "En Canvas, 'por quÃ© nos eligen los clientes' es:", "In Canvas, 'why customers choose us' is:"), imatge: "canvas", opcions: [t("Segments", "Segmentos", "Segments"), t("Proposta de valor", "Propuesta de valor", "Value proposition"), t("Canals", "Canales", "Channels"), t("Recursos clau", "Recursos clave", "Key resources")], correcta: 1 },
            { id: 'emi5', tipus: 'identify', dificultat: 'facil', pregunta: t("DAFO: Les Amenaces sÃ³n factors...", "DAFO: Las Amenazas son factores...", "SWOT: Threats are factors..."), imatge: "dafo", opcions: [t("Interns positius", "Internos positivos", "Internal positive"), t("Interns negatius", "Internos negativos", "Internal negative"), t("Externs positius", "Externos positivos", "External positive"), t("Externs negatius", "Externos negativos", "External negative")], correcta: 3 },
            { id: 'emi6', tipus: 'identify', dificultat: 'mitjana', pregunta: t("Segons Porter, quantes forces competitives hi ha?", "SegÃºn Porter, Â¿cuÃ¡ntas fuerzas competitivas hay?", "According to Porter, how many competitive forces?"), imatge: "porter", opcions: ["3", "4", "5", "6"], correcta: 2 },
            
            // FÃ“RMULES (4)
            { id: 'emf1', tipus: 'formula', dificultat: 'facil', pregunta: t("Punt Mort (Q*) = CF / (P - ___)", "Punto Muerto (Q*) = CF / (P - ___)", "Break-even (Q*) = FC / (P - ___)"), opcions: ["CVu", "CT", "CF", "MC"], correcta: 0 },
            { id: 'emf2', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Productivitat = ___ / Recursos", "Productividad = ___ / Recursos", "Productivity = ___ / Resources"), opcions: [t("ProducciÃ³", "ProducciÃ³n", "Output"), t("Benefici", "Beneficio", "Profit"), t("Vendes", "Ventas", "Sales"), t("Costos", "Costes", "Costs")], correcta: 0 },
            { id: 'emf3', tipus: 'formula', dificultat: 'mitjana', pregunta: t("Cost Total = CF + CVu Ã— ___", "Coste Total = CF + CVu Ã— ___", "Total Cost = FC + VCu Ã— ___"), opcions: ["Q", "P", "MC", "CT"], correcta: 0 },
            { id: 'emf4', tipus: 'formula', dificultat: 'dificil', pregunta: t("EOQ = âˆš(2Ã—DÃ—Cp / ___)", "EOQ = âˆš(2Ã—DÃ—Cp / ___)", "EOQ = âˆš(2Ã—DÃ—Cp / ___)"), opcions: ["Ca", "Cv", "CF", "P"], correcta: 0 },
            
            // VERTADER/FALS (2)
            { id: 'emv1', tipus: 'truefalse', dificultat: 'facil', pregunta: t("En una SL la responsabilitat dels socis es limita al capital aportat", "En una SL la responsabilidad de los socios se limita al capital aportado", "In an LLC partners' liability is limited to contributed capital"), correcta: true },
            { id: 'emv2', tipus: 'truefalse', dificultat: 'mitjana', pregunta: t("Segons Herzberg, el salari Ã©s un factor motivador", "SegÃºn Herzberg, el salario es un factor motivador", "According to Herzberg, salary is a motivating factor"), correcta: false },
        ]
    }), [idioma]);

    useEffect(() => {
        const saved = localStorage.getItem('pde_concurs_ranking_v2');
        if (saved) setRanking(JSON.parse(saved));
    }, []);

    useEffect(() => {
        if (fase !== 'jugant' || mostrarResultat) return;
        if (tempsRestant <= 0) { handleResposta(null); return; }
        const timer = setTimeout(() => setTempsRestant(t => t - 1), 1000);
        return () => clearTimeout(timer);
    }, [tempsRestant, fase, mostrarResultat]);

    useEffect(() => {
        if (fase === 'jugant' && preguntesPartida[preguntaActual]?.tipus === 'order') {
            const elements = preguntesPartida[preguntaActual].elements;
            setOrdreUsuari(elements.map((_, i) => i).sort(() => Math.random() - 0.5));
        }
    }, [preguntaActual, fase, preguntesPartida]);

    const obtenirPreguntes = (cat) => {
        let pool = cat === 'totes' 
            ? [...bancPreguntes.economia, ...bancPreguntes.finances, ...bancPreguntes.empresa]
            : [...bancPreguntes[cat]];
        return pool.sort(() => Math.random() - 0.5).slice(0, 20);
    };

    const iniciarPartida = () => {
        if (!nomJugador.trim()) { alert(t("Introdueix el teu nom!", "Â¡Introduce tu nombre!", "Enter your name!")); return; }
        setPreguntesPartida(obtenirPreguntes(categoria));
        setPreguntaActual(0); setPuntuacio(0); setRespostes([]); setRatxa(0);
        setTempsRestant(60); setRespostaUsuari(null); setMostrarResultat(false);
        setOrdreUsuari([]); setInputNumeric(''); setFase('jugant');
    };

    const calcularPunts = (correcta, temps, dificultat, ratxaActual) => {
        if (!correcta) return -25;
        let base = dificultat === 'facil' ? 80 : dificultat === 'mitjana' ? 100 : 150;
        const bonusVelocitat = temps > 40 ? Math.floor((temps - 40) * 2.5) : 0;
        let mult = ratxaActual >= 5 ? 2 : ratxaActual >= 3 ? 1.5 : 1;
        return Math.floor((base + bonusVelocitat) * mult);
    };

    const handleResposta = (resposta) => {
        const p = preguntesPartida[preguntaActual];
        let ok = false;
        if (p.tipus === 'multiple' || p.tipus === 'identify' || p.tipus === 'formula') ok = resposta === p.correcta;
        else if (p.tipus === 'truefalse') ok = resposta === p.correcta;
        else if (p.tipus === 'numeric') ok = Math.abs(parseFloat(resposta) - p.correcta) <= (p.tolerancia || 0);
        else if (p.tipus === 'order') ok = JSON.stringify(ordreUsuari) === JSON.stringify(p.ordreCorrecte);
        
        const novaRatxa = ok ? ratxa + 1 : 0;
        const punts = calcularPunts(ok, tempsRestant, p.dificultat, ratxa);
        setRespostaUsuari(resposta); setMostrarResultat(true); setRatxa(novaRatxa);
        setPuntuacio(s => Math.max(0, s + punts));
        setRespostes([...respostes, { pregunta: p.id, correcta: ok, punts, temps: 60 - tempsRestant }]);
    };

    const seguentPregunta = () => {
        if (preguntaActual + 1 >= preguntesPartida.length) {
            const entry = { nom: nomJugador, punts: puntuacio, data: new Date().toLocaleDateString('ca-ES'), correctes: respostes.filter(r => r.correcta).length, categoria };
            const nouRanking = [...ranking, entry].sort((a, b) => b.punts - a.punts).slice(0, 10);
            setRanking(nouRanking);
            localStorage.setItem('pde_concurs_ranking_v2', JSON.stringify(nouRanking));
            setFase('resultats');
        } else {
            setPreguntaActual(p => p + 1); setTempsRestant(60); setRespostaUsuari(null);
            setMostrarResultat(false); setOrdreUsuari([]); setInputNumeric('');
        }
    };

    const moureElement = (index, dir) => {
        const nou = [...ordreUsuari];
        const newIdx = index + dir;
        if (newIdx < 0 || newIdx >= nou.length) return;
        [nou[index], nou[newIdx]] = [nou[newIdx], nou[index]];
        setOrdreUsuari(nou);
    };

    const Card = ({ children, className = "" }) => (
        <div className={`bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 ${className}`}>{children}</div>
    );

    const renderGrafic = (tipus) => {
        const grafics = {
            bcg: (
                <div className="grid grid-cols-2 gap-2 w-52 mx-auto my-4 text-xs">
                    <div className="p-3 bg-yellow-400/30 rounded-lg text-center border border-yellow-400/50">â­ Stars</div>
                    <div className="p-3 bg-purple-400/30 rounded-lg text-center border border-purple-400/50">â“ ?</div>
                    <div className="p-3 bg-green-400/30 rounded-lg text-center border border-green-400/50">ğŸ„ Cash Cows</div>
                    <div className="p-3 bg-slate-400/30 rounded-lg text-center border border-slate-400/50">ğŸ• Dogs</div>
                    <div className="col-span-2 text-center text-purple-300 text-[10px] mt-1">â† {t("Quota mercat", "Cuota mercado", "Market share")} â†’</div>
                </div>
            ),
            ansoff: (
                <div className="w-56 mx-auto my-4 text-xs">
                    <div className="grid grid-cols-3 gap-1">
                        <div></div><div className="text-center text-purple-300 text-[10px]">{t("Producte actual", "Producto actual", "Current product")}</div><div className="text-center text-purple-300 text-[10px]">{t("Producte nou", "Producto nuevo", "New product")}</div>
                        <div className="text-purple-300 text-[10px] flex items-center">{t("Mercat actual", "Mercado actual", "Current market")}</div>
                        <div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">{t("PenetraciÃ³", "PenetraciÃ³n", "Penetration")}</div>
                        <div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 text-center">{t("Desenv. prod.", "Desarrollo prod.", "Prod. dev.")}</div>
                        <div className="text-purple-300 text-[10px] flex items-center">{t("Mercat nou", "Mercado nuevo", "New market")}</div>
                        <div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">{t("Desenv. mercat", "Desarrollo mercado", "Market dev.")}</div>
                        <div className="p-2 bg-red-400/30 rounded border border-red-400/50 text-center">{t("DiversificaciÃ³", "DiversificaciÃ³n", "Diversification")}</div>
                    </div>
                </div>
            ),
            canvas: (
                <div className="grid grid-cols-5 gap-1 w-72 mx-auto my-4 text-[10px]">
                    <div className="row-span-2 p-2 bg-violet-400/30 rounded border border-violet-400/50 text-center">ğŸ¤<br/>{t("Socis", "Socios", "Partners")}</div>
                    <div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">âš™ï¸ {t("Activ.", "Activ.", "Activ.")}</div>
                    <div className="row-span-2 p-2 bg-pink-400/30 rounded border border-pink-400/50 text-center">ğŸ’<br/>{t("Proposta", "Propuesta", "Value")}</div>
                    <div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">â¤ï¸ {t("Relac.", "Relac.", "Relat.")}</div>
                    <div className="row-span-2 p-2 bg-emerald-400/30 rounded border border-emerald-400/50 text-center">ğŸ‘¥<br/>{t("Clients", "Clientes", "Customers")}</div>
                    <div className="p-2 bg-cyan-400/30 rounded border border-cyan-400/50 text-center">ğŸ—ï¸ {t("Recurs.", "Recurs.", "Resourc.")}</div>
                    <div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 text-center">ğŸ“¢ {t("Canals", "Canales", "Channels")}</div>
                    <div className="col-span-2 p-2 bg-red-400/30 rounded border border-red-400/50 text-center">ğŸ’¸ {t("Costos", "Costes", "Costs")}</div>
                    <div className="col-span-3 p-2 bg-green-400/30 rounded border border-green-400/50 text-center">ğŸ’° {t("Ingressos", "Ingresos", "Revenue")}</div>
                </div>
            ),
            dafo: (
                <div className="grid grid-cols-2 gap-2 w-56 mx-auto my-4 text-xs">
                    <div className="p-2 bg-green-400/30 rounded border border-green-400/50 text-center">ğŸ’ª {t("Fortaleses", "Fortalezas", "Strengths")}</div>
                    <div className="p-2 bg-red-400/30 rounded border border-red-400/50 text-center">ğŸ˜° {t("Debilitats", "Debilidades", "Weaknesses")}</div>
                    <div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 text-center">ğŸ¯ {t("Oportunitats", "Oportunidades", "Opportunities")}</div>
                    <div className="p-2 bg-orange-400/30 rounded border border-orange-400/50 text-center">âš ï¸ {t("Amenaces", "Amenazas", "Threats")}</div>
                    <div className="text-center text-purple-300 text-[10px]">{t("Intern", "Interno", "Internal")}</div>
                    <div className="text-center text-purple-300 text-[10px]">{t("Extern", "Externo", "External")}</div>
                </div>
            ),
            porter: (
                <div className="w-56 mx-auto my-4 text-[10px] text-center">
                    <div className="p-2 bg-red-400/30 rounded border border-red-400/50 mb-1">â¬†ï¸ {t("Nous entrants", "Nuevos entrantes", "New entrants")}</div>
                    <div className="flex gap-1">
                        <div className="p-2 bg-blue-400/30 rounded border border-blue-400/50 flex-1">â¬…ï¸ {t("ProveÃ¯dors", "Proveedores", "Suppliers")}</div>
                        <div className="p-2 bg-purple-400/30 rounded border border-purple-400/50 flex-1">âš”ï¸ {t("Rivalitat", "Rivalidad", "Rivalry")}</div>
                        <div className="p-2 bg-green-400/30 rounded border border-green-400/50 flex-1">{t("Clients", "Clientes", "Buyers")} â¡ï¸</div>
                    </div>
                    <div className="p-2 bg-amber-400/30 rounded border border-amber-400/50 mt-1">â¬‡ï¸ {t("Substitutius", "Sustitutivos", "Substitutes")}</div>
                </div>
            ),
            oferta_demanda: (<div className="w-48 h-32 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20"><div className="absolute bottom-4 left-4 w-32 h-20 border-l-2 border-b-2 border-purple-400"></div><div className="absolute bottom-6 left-6 w-24 h-1 bg-blue-400 transform -rotate-45 origin-left"></div><div className="absolute bottom-6 left-6 w-24 h-1 bg-red-400 transform rotate-45 origin-left"></div><div className="absolute bottom-2 right-4 text-[10px] text-purple-300">Q</div><div className="absolute top-2 left-2 text-[10px] text-purple-300">P</div></div>),
            islm: (<div className="w-48 h-32 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20"><div className="absolute bottom-4 left-4 w-32 h-20 border-l-2 border-b-2 border-purple-400"></div><div className="absolute bottom-8 left-8 w-20 h-1 bg-blue-400 transform -rotate-30 origin-left" style={{transform:'rotate(-30deg)'}}></div><div className="absolute bottom-12 left-6 w-24 h-1 bg-green-400 transform rotate-30 origin-left" style={{transform:'rotate(30deg)'}}></div><div className="absolute top-2 left-8 text-[10px] text-blue-300">IS</div><div className="absolute top-6 right-8 text-[10px] text-green-300">LM</div><div className="absolute bottom-2 right-4 text-[10px] text-purple-300">Y</div><div className="absolute top-2 left-2 text-[10px] text-purple-300">i</div></div>),
            laffer: (<div className="w-48 h-32 mx-auto my-4 relative bg-white/5 rounded-lg border border-white/20"><div className="absolute bottom-4 left-4 w-32 h-20 border-l-2 border-b-2 border-purple-400"></div><svg className="absolute bottom-6 left-6 w-28 h-16" viewBox="0 0 100 60"><path d="M 0 60 Q 50 -20 100 60" stroke="#f59e0b" strokeWidth="3" fill="none"/></svg><div className="absolute bottom-2 right-4 text-[10px] text-purple-300">{t("Tipus", "Tipo", "Rate")}</div><div className="absolute top-2 left-2 text-[10px] text-purple-300">{t("Recapt.", "Recaud.", "Revenue")}</div></div>),
            balanc: (<div className="w-56 mx-auto my-4 text-[10px]"><div className="flex gap-1"><div className="flex-1 p-2 bg-blue-400/30 rounded-t border border-blue-400/50 text-center font-bold">{t("ACTIU", "ACTIVO", "ASSETS")}</div><div className="flex-1 p-2 bg-green-400/30 rounded-t border border-green-400/50 text-center font-bold">{t("PASSIU+PN", "PASIVO+PN", "LIAB.+EQ.")}</div></div><div className="flex gap-1"><div className="flex-1 p-1 bg-blue-400/20 border-x border-blue-400/50">ANC</div><div className="flex-1 p-1 bg-green-400/20 border-x border-green-400/50">PN</div></div><div className="flex gap-1"><div className="flex-1 p-1 bg-blue-400/20 border-x border-b rounded-b border-blue-400/50">AC</div><div className="flex-1"><div className="p-1 bg-green-400/20 border-x border-green-400/50">PNC</div><div className="p-1 bg-green-400/20 border-x border-b rounded-b border-green-400/50">PC</div></div></div></div>),
            leasing: (<div className="w-48 mx-auto my-4 p-4 bg-blue-400/20 rounded-xl border border-blue-400/50 text-center"><span className="text-3xl">ğŸ¦â¡ï¸ğŸ“¦</span><p className="text-sm mt-2 text-blue-200">LEASING</p><p className="text-[10px] text-blue-300">{t("Arrendament financer amb opciÃ³ de compra", "Arrendamiento financiero con opciÃ³n de compra", "Financial lease with purchase option")}</p></div>),
            factoring: (<div className="w-48 mx-auto my-4 p-4 bg-green-400/20 rounded-xl border border-green-400/50 text-center"><span className="text-3xl">ğŸ“„â¡ï¸ğŸ’µ</span><p className="text-sm mt-2 text-green-200">FACTORING</p><p className="text-[10px] text-green-300">{t("Venda de factures per avanÃ§ar cobraments", "Venta de facturas para adelantar cobros", "Selling invoices to advance collections")}</p></div>),
        };
        return grafics[tipus] || null;
    };

    // PANTALLA INICI
    const PantallaInici = () => (
        <div className="max-w-2xl mx-auto space-y-6 animate-fade">
            <div className="text-center py-8">
                <span className="text-7xl mb-6 block animate-pulse-custom">ğŸ†</span>
                <h1 className="text-5xl font-black text-white mb-3">{t("Concurs PDE", "Concurso PDE", "PDE Contest")}</h1>
                <p className="text-xl text-purple-200">{t("Economia Â· Finances Â· Empresa", "EconomÃ­a Â· Finanzas Â· Empresa", "Economics Â· Finance Â· Business")}</p>
                <p className="text-sm text-purple-300 mt-2">{t("MÃ©s de 60 preguntes de cÃ lcul, grÃ fics i teoria!", "Â¡MÃ¡s de 60 preguntas de cÃ¡lculo, grÃ¡ficos y teorÃ­a!", "60+ calculation, graphics and theory questions!")}</p>
            </div>
            
            <Card>
                <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><span>âš™ï¸</span> {t("Configura", "Configura", "Setup")}</h3>
                <div className="space-y-5">
                    <div>
                        <label className="block text-sm font-semibold text-purple-200 mb-2">{t("El teu nom", "Tu nombre", "Your name")}</label>
                        <input type="text" value={nomJugador} onChange={e => setNomJugador(e.target.value)} placeholder={t("Escriu el teu nom...", "Escribe tu nombre...", "Enter your name...")} className="w-full p-4 bg-white/10 border border-white/30 rounded-xl text-white placeholder-white/50 focus:ring-2 focus:ring-yellow-400 outline-none text-lg" maxLength={20} />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-semibold text-purple-200 mb-3">{t("Categoria", "CategorÃ­a", "Category")}</label>
                        <div className="grid grid-cols-2 gap-3">
                            {[
                                { id: 'economia', icon: 'ğŸ“ˆ', label: t('Economia', 'EconomÃ­a', 'Economics'), color: 'from-blue-500 to-cyan-500', q: '20' },
                                { id: 'finances', icon: 'ğŸ’°', label: t('Finances', 'Finanzas', 'Finance'), color: 'from-green-500 to-emerald-500', q: '20' },
                                { id: 'empresa', icon: 'ğŸ¢', label: t('Empresa', 'Empresa', 'Business'), color: 'from-orange-500 to-red-500', q: '25' },
                                { id: 'totes', icon: 'ğŸ¯', label: t('Totes', 'Todas', 'All'), color: 'from-purple-500 to-pink-500', q: '65' },
                            ].map(cat => (
                                <button key={cat.id} onClick={() => setCategoria(cat.id)} className={`p-4 rounded-xl border-2 transition-all transform hover:scale-105 ${categoria === cat.id ? 'border-yellow-400 bg-gradient-to-r ' + cat.color + ' shadow-lg shadow-yellow-400/30' : 'border-white/30 bg-white/5 hover:bg-white/10'}`}>
                                    <span className="text-3xl block mb-2">{cat.icon}</span>
                                    <span className="font-bold text-white block">{cat.label}</span>
                                    <span className="text-xs text-white/60">{cat.q} {t("preguntes", "preguntas", "questions")}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    <button onClick={iniciarPartida} className="w-full py-5 gold-gradient text-slate-900 font-black text-xl rounded-xl hover:opacity-90 transition-all shadow-lg shadow-yellow-500/30 transform hover:scale-[1.02]">
                        ğŸš€ {t("COMENÃ‡AR!", "Â¡EMPEZAR!", "START!")}
                    </button>
                </div>
            </Card>
            
            <Card className="text-center">
                <p className="text-sm text-purple-300 mb-3">{t("Tipus de preguntes:", "Tipos de preguntas:", "Question types:")}</p>
                <div className="grid grid-cols-3 md:grid-cols-6 gap-2">
                    {[
                        { icon: 'ğŸ§®', label: t('CÃ lculs', 'CÃ¡lculos', 'Calcs') },
                        { icon: 'ğŸ“Š', label: t('GrÃ fics', 'GrÃ¡ficos', 'Graphics') },
                        { icon: 'ğŸ“', label: t('FÃ³rmules', 'FÃ³rmulas', 'Formulas') },
                        { icon: 'ğŸ”¢', label: t('Ordenar', 'Ordenar', 'Order') },
                        { icon: 'âœ“âœ—', label: 'V/F' },
                        { icon: 'ğŸ”˜', label: 'Test' },
                    ].map((t, i) => (
                        <div key={i} className="p-2 bg-white/5 rounded-lg">
                            <span className="text-xl block">{t.icon}</span>
                            <span className="text-[10px] text-purple-300">{t.label}</span>
                        </div>
                    ))}
                </div>
            </Card>
            
            <div className="flex gap-3">
                <button onClick={() => setFase('ranking')} className="flex-1 py-4 bg-white/10 border border-white/30 text-white font-bold rounded-xl hover:bg-white/20">
                    ğŸ† {t("Ranking", "Ranking", "Ranking")}
                </button>
                <a href="./index.html" className="flex-1 py-4 bg-white/10 border border-white/30 text-white font-bold rounded-xl hover:bg-white/20 text-center">
                    ğŸ  {t("Inici", "Inicio", "Home")}
                </a>
            </div>
            
            <div className="flex justify-center gap-2">
                {['val', 'es', 'en'].map(lang => (
                    <button key={lang} onClick={() => setIdioma(lang)} className={`px-4 py-2 rounded-lg font-bold transition-all ${idioma === lang ? 'bg-yellow-400 text-slate-900' : 'bg-white/10 text-white hover:bg-white/20'}`}>
                        {lang.toUpperCase()}
                    </button>
                ))}
            </div>
        </div>
    );

    // PANTALLA JOC
    const PantallaJoc = () => {
        const p = preguntesPartida[preguntaActual];
        if (!p) return null;
        const progressPct = ((preguntaActual + 1) / preguntesPartida.length) * 100;
        const tempsPct = (tempsRestant / 60) * 100;
        const tempsCol = tempsRestant > 30 ? 'bg-green-500' : tempsRestant > 10 ? 'bg-amber-500' : 'bg-red-500';
        const tipusLabel = { multiple: 'TEST', numeric: t('CÃ€LCUL', 'CÃLCULO', 'CALC'), truefalse: 'V/F', identify: t('GRÃ€FIC', 'GRÃFICO', 'GRAPHIC'), formula: t('FÃ“RMULA', 'FÃ“RMULA', 'FORMULA'), order: t('ORDENA', 'ORDENA', 'ORDER') };
        
        return (
            <div className="max-w-3xl mx-auto space-y-4 animate-fade">
                <div className="flex items-center justify-between bg-white/10 backdrop-blur rounded-xl p-4 border border-white/20">
                    <div className="flex items-center gap-3">
                        <span className="text-lg font-bold text-white bg-white/20 px-3 py-1 rounded-lg">{preguntaActual + 1}/{preguntesPartida.length}</span>
                        <div className="flex items-center gap-1 bg-yellow-400/20 text-yellow-400 px-3 py-1 rounded-lg"><span>ğŸ†</span><span className="font-bold">{puntuacio}</span></div>
                        {ratxa >= 3 && <div className="flex items-center gap-1 bg-red-400/20 text-red-400 px-3 py-1 rounded-lg animate-pulse"><span>ğŸ”¥</span><span className="font-bold">x{ratxa >= 5 ? '2' : '1.5'}</span></div>}
                    </div>
                    <div className={`text-3xl font-black ${tempsRestant <= 10 ? 'text-red-400 animate-pulse' : 'text-white'}`}>{tempsRestant}s</div>
                </div>
                
                <div className="space-y-1">
                    <div className="h-2 bg-white/20 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300" style={{ width: `${progressPct}%` }}></div></div>
                    <div className="h-1.5 bg-white/20 rounded-full overflow-hidden"><div className={`h-full ${tempsCol} transition-all duration-1000`} style={{ width: `${tempsPct}%` }}></div></div>
                </div>
                
                <Card>
                    <div className="flex items-center gap-2 mb-4">
                        <span className={`px-3 py-1 rounded-lg text-xs font-bold ${p.dificultat === 'facil' ? 'bg-green-400/30 text-green-300' : p.dificultat === 'mitjana' ? 'bg-amber-400/30 text-amber-300' : 'bg-red-400/30 text-red-300'}`}>
                            {p.dificultat === 'facil' ? 'â­' : p.dificultat === 'mitjana' ? 'â­â­' : 'â­â­â­'}
                        </span>
                        <span className="text-xs text-purple-300 uppercase font-semibold">{tipusLabel[p.tipus]}</span>
                    </div>
                    
                    <h3 className="text-xl md:text-2xl font-bold text-white mb-6">{p.pregunta}</h3>
                    
                    {p.imatge && renderGrafic(p.imatge)}
                    
                    {(p.tipus === 'multiple' || p.tipus === 'identify' || p.tipus === 'formula') && (
                        <div className="grid gap-3">
                            {p.opcions.map((op, i) => (
                                <button key={i} onClick={() => !mostrarResultat && handleResposta(i)} disabled={mostrarResultat}
                                    className={`p-4 text-left rounded-xl border-2 transition-all font-medium text-white ${
                                        mostrarResultat ? i === p.correcta ? 'border-green-400 bg-green-400/30' : respostaUsuari === i ? 'border-red-400 bg-red-400/30 animate-shake' : 'border-white/20 opacity-40'
                                        : 'border-white/30 hover:border-yellow-400 hover:bg-white/10 cursor-pointer'
                                    }`}>
                                    <span className="font-bold mr-3 text-purple-300">{String.fromCharCode(65 + i)}.</span>{op}
                                    {mostrarResultat && i === p.correcta && <span className="float-right text-green-400">âœ“</span>}
                                    {mostrarResultat && respostaUsuari === i && i !== p.correcta && <span className="float-right text-red-400">âœ—</span>}
                                </button>
                            ))}
                        </div>
                    )}
                    
                    {p.tipus === 'truefalse' && (
                        <div className="grid grid-cols-2 gap-4">
                            {[true, false].map(val => (
                                <button key={String(val)} onClick={() => !mostrarResultat && handleResposta(val)} disabled={mostrarResultat}
                                    className={`p-6 rounded-xl border-2 transition-all font-bold text-xl text-white ${
                                        mostrarResultat ? val === p.correcta ? 'border-green-400 bg-green-400/30' : respostaUsuari === val ? 'border-red-400 bg-red-400/30 animate-shake' : 'border-white/20 opacity-40'
                                        : 'border-white/30 hover:border-yellow-400 hover:bg-white/10 cursor-pointer'
                                    }`}>
                                    {val ? 'âœ“ ' + t('VERTADER', 'VERDADERO', 'TRUE') : 'âœ— ' + t('FALS', 'FALSO', 'FALSE')}
                                </button>
                            ))}
                        </div>
                    )}
                    
                    {p.tipus === 'numeric' && (
                        <div className="space-y-4">
                            <input type="number" step="any" value={inputNumeric} onChange={e => setInputNumeric(e.target.value)} disabled={mostrarResultat}
                                placeholder={t("Escriu el resultat numÃ¨ric...", "Escribe el resultado numÃ©rico...", "Enter numeric result...")}
                                className="w-full p-4 text-2xl font-bold text-center bg-white/10 border-2 border-white/30 rounded-xl text-white placeholder-white/50 outline-none focus:border-yellow-400"
                                onKeyDown={e => e.key === 'Enter' && !mostrarResultat && inputNumeric && handleResposta(inputNumeric)} />
                            {!mostrarResultat && <button onClick={() => inputNumeric && handleResposta(inputNumeric)} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90">{t("COMPROVAR", "COMPROBAR", "CHECK")}</button>}
                            {mostrarResultat && <p className="text-center text-lg text-white">{t("Resposta correcta:", "Respuesta correcta:", "Correct answer:")} <strong className="text-green-400">{p.correcta}</strong> {p.tolerancia > 0 && <span className="text-purple-300">(Â±{p.tolerancia})</span>}</p>}
                        </div>
                    )}
                    
                    {p.tipus === 'order' && (
                        <div className="space-y-4">
                            <div className="space-y-2">
                                {ordreUsuari.map((elemIdx, pos) => (
                                    <div key={pos} className={`flex items-center gap-3 p-4 rounded-xl border-2 ${mostrarResultat ? pos === p.ordreCorrecte.indexOf(elemIdx) ? 'border-green-400 bg-green-400/20' : 'border-red-400 bg-red-400/20' : 'border-white/30 bg-white/5'}`}>
                                        <span className="font-bold text-purple-300 w-8">{pos + 1}.</span>
                                        <span className="flex-1 font-medium text-white">{p.elements[elemIdx]}</span>
                                        {!mostrarResultat && (
                                            <div className="flex gap-2">
                                                <button onClick={() => moureElement(pos, -1)} disabled={pos === 0} className="w-10 h-10 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold">â–²</button>
                                                <button onClick={() => moureElement(pos, 1)} disabled={pos === ordreUsuari.length - 1} className="w-10 h-10 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30 text-white font-bold">â–¼</button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                            {!mostrarResultat && <button onClick={() => handleResposta('order')} className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90">{t("CONFIRMAR", "CONFIRMAR", "CONFIRM")}</button>}
                        </div>
                    )}
                    
                    {mostrarResultat && (
                        <div className="mt-6 pt-6 border-t border-white/20">
                            <div className={`text-center p-5 rounded-xl mb-4 ${respostes[respostes.length - 1]?.correcta ? 'bg-green-400/20' : 'bg-red-400/20'}`}>
                                <span className="text-5xl block mb-2">{respostes[respostes.length - 1]?.correcta ? 'ğŸ‰' : 'ğŸ˜”'}</span>
                                <p className="font-bold text-2xl text-white">{respostes[respostes.length - 1]?.correcta ? `+${respostes[respostes.length - 1]?.punts}` : respostes[respostes.length - 1]?.punts} {t('punts', 'puntos', 'points')}</p>
                            </div>
                            <button onClick={seguentPregunta} className="w-full py-5 gold-gradient text-slate-900 font-black text-lg rounded-xl hover:opacity-90 transform hover:scale-[1.02] transition-all">
                                {preguntaActual + 1 >= preguntesPartida.length ? t('ğŸ† VEURE RESULTATS', 'ğŸ† VER RESULTADOS', 'ğŸ† SEE RESULTS') : t('SEGÃœENT â†’', 'SIGUIENTE â†’', 'NEXT â†’')}
                            </button>
                        </div>
                    )}
                </Card>
            </div>
        );
    };

    // PANTALLA RESULTATS
    const PantallaResultats = () => {
        const correctes = respostes.filter(r => r.correcta).length;
        const pct = ((correctes / respostes.length) * 100).toFixed(0);
        const tempsTotal = respostes.reduce((acc, r) => acc + r.temps, 0);
        const mitjana = (tempsTotal / respostes.length).toFixed(1);
        const posRanking = ranking.findIndex(r => r.nom === nomJugador && r.punts === puntuacio) + 1;
        
        let emoji, msg, color;
        if (pct >= 90) { emoji = 'ğŸ†'; msg = t('ExcelÂ·lent!', 'Â¡Excelente!', 'Excellent!'); color = 'from-yellow-400 to-amber-500'; }
        else if (pct >= 70) { emoji = 'ğŸ‰'; msg = t('Molt bÃ©!', 'Â¡Muy bien!', 'Very good!'); color = 'from-green-400 to-emerald-500'; }
        else if (pct >= 50) { emoji = 'ğŸ‘'; msg = t('BÃ©!', 'Â¡Bien!', 'Good!'); color = 'from-blue-400 to-cyan-500'; }
        else { emoji = 'ğŸ’ª'; msg = t('Continua practicant!', 'Â¡Sigue practicando!', 'Keep practicing!'); color = 'from-purple-400 to-pink-500'; }
        
        // EstadÃ­stiques per tipus
        const statsTipus = {};
        respostes.forEach(r => {
            const p = preguntesPartida.find(pr => pr.id === r.pregunta);
            if (p) {
                if (!statsTipus[p.tipus]) statsTipus[p.tipus] = { total: 0, correctes: 0 };
                statsTipus[p.tipus].total++;
                if (r.correcta) statsTipus[p.tipus].correctes++;
            }
        });
        
        return (
            <div className="max-w-2xl mx-auto space-y-6 animate-fade">
                <div className={`text-center py-10 bg-gradient-to-r ${color} rounded-3xl`}>
                    <span className="text-8xl block mb-4 animate-pulse-custom">{emoji}</span>
                    <h2 className="text-4xl font-black text-white mb-2">{msg}</h2>
                    <p className="text-xl text-white/80">{nomJugador}</p>
                </div>
                
                <Card>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div className="p-4 bg-yellow-400/20 rounded-xl"><p className="text-4xl font-black text-yellow-400">{puntuacio}</p><p className="text-sm text-purple-300">{t("Punts", "Puntos", "Points")}</p></div>
                        <div className="p-4 bg-green-400/20 rounded-xl"><p className="text-4xl font-black text-green-400">{correctes}/{respostes.length}</p><p className="text-sm text-purple-300">{t("Encerts", "Aciertos", "Correct")}</p></div>
                        <div className="p-4 bg-blue-400/20 rounded-xl"><p className="text-4xl font-black text-blue-400">{pct}%</p><p className="text-sm text-purple-300">{t("PrecisiÃ³", "PrecisiÃ³n", "Accuracy")}</p></div>
                        <div className="p-4 bg-purple-400/20 rounded-xl"><p className="text-4xl font-black text-purple-400">{mitjana}s</p><p className="text-sm text-purple-300">{t("Temps mitjÃ ", "Tiempo medio", "Avg time")}</p></div>
                    </div>
                    
                    {Object.keys(statsTipus).length > 0 && (
                        <div className="mt-6 pt-4 border-t border-white/20">
                            <p className="text-sm text-purple-300 mb-3 text-center">{t("Resultats per tipus:", "Resultados por tipo:", "Results by type:")}</p>
                            <div className="grid grid-cols-3 md:grid-cols-6 gap-2 text-center text-xs">
                                {Object.entries(statsTipus).map(([tipus, stats]) => (
                                    <div key={tipus} className="p-2 bg-white/5 rounded-lg">
                                        <p className="font-bold text-white">{stats.correctes}/{stats.total}</p>
                                        <p className="text-purple-300">{tipus === 'numeric' ? 'ğŸ§®' : tipus === 'identify' ? 'ğŸ“Š' : tipus === 'formula' ? 'ğŸ“' : tipus === 'order' ? 'ğŸ”¢' : tipus === 'truefalse' ? 'âœ“âœ—' : 'ğŸ”˜'}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {posRanking > 0 && posRanking <= 10 && (
                        <div className="mt-6 p-5 gold-gradient rounded-xl text-center">
                            <span className="text-3xl">ğŸ†</span>
                            <p className="font-black text-xl text-slate-900">{t(`EstÃ s al Top ${posRanking}!`, `Â¡EstÃ¡s en el Top ${posRanking}!`, `You're in Top ${posRanking}!`)}</p>
                        </div>
                    )}
                </Card>
                
                <div className="flex gap-3">
                    <button onClick={() => { setFase('inici'); setPuntuacio(0); setRespostes([]); }} className="flex-1 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold rounded-xl hover:opacity-90">ğŸ”„ {t("Tornar a jugar", "Volver a jugar", "Play again")}</button>
                    <button onClick={() => setFase('ranking')} className="flex-1 py-4 gold-gradient text-slate-900 font-bold rounded-xl hover:opacity-90">ğŸ† Ranking</button>
                </div>
            </div>
        );
    };

    // PANTALLA RANKING
    const PantallaRanking = () => (
        <div className="max-w-2xl mx-auto space-y-6 animate-fade">
            <div className="text-center py-8">
                <span className="text-6xl mb-4 block">ğŸ†</span>
                <h2 className="text-4xl font-black text-white">TOP 10</h2>
                <p className="text-purple-300">{t("Els millors jugadors", "Los mejores jugadores", "Top players")}</p>
            </div>
            
            <Card>
                {ranking.length === 0 ? (
                    <div className="text-center py-10 text-purple-300">
                        <span className="text-5xl block mb-3">ğŸ“­</span>
                        <p className="text-lg">{t("Encara no hi ha puntuacions", "AÃºn no hay puntuaciones", "No scores yet")}</p>
                        <p className="text-sm mt-1">{t("Sigues el primer!", "Â¡SÃ© el primero!", "Be the first!")}</p>
                    </div>
                ) : (
                    <div className="space-y-3">
                        {ranking.map((entry, i) => (
                            <div key={i} className={`flex items-center gap-4 p-4 rounded-xl ${i === 0 ? 'gold-gradient' : i === 1 ? 'bg-slate-300/20' : i === 2 ? 'bg-orange-400/20' : 'bg-white/5'}`}>
                                <div className={`w-12 h-12 rounded-full flex items-center justify-center font-black text-xl ${i === 0 ? 'bg-yellow-600 text-yellow-100' : i === 1 ? 'bg-slate-400 text-slate-100' : i === 2 ? 'bg-orange-600 text-orange-100' : 'bg-white/20 text-white'}`}>{i + 1}</div>
                                <div className="flex-1">
                                    <p className={`font-bold text-lg ${i === 0 ? 'text-slate-900' : 'text-white'}`}>{entry.nom}</p>
                                    <p className={`text-xs ${i === 0 ? 'text-slate-700' : 'text-purple-300'}`}>{entry.data} Â· {entry.correctes}/20 Â· {entry.categoria}</p>
                                </div>
                                <div className="text-right">
                                    <p className={`text-2xl font-black ${i === 0 ? 'text-slate-900' : 'text-yellow-400'}`}>{entry.punts}</p>
                                    <p className={`text-xs ${i === 0 ? 'text-slate-700' : 'text-purple-300'}`}>{t("punts", "puntos", "pts")}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </Card>
            
            <button onClick={() => setFase('inici')} className="w-full py-4 bg-white/10 border border-white/30 text-white font-bold rounded-xl hover:bg-white/20">â† {t("Tornar", "Volver", "Back")}</button>
        </div>
    );

    return (
        <div className="min-h-screen py-8 px-4">
            <div className="max-w-4xl mx-auto">
                {fase === 'inici' && <PantallaInici />}
                {fase === 'jugant' && <PantallaJoc />}
                {fase === 'resultats' && <PantallaResultats />}
                {fase === 'ranking' && <PantallaRanking />}
                <footer className="mt-12 text-center text-purple-400/60 text-sm"><p>Concurs PDE Â· profedeeconomia.es Â· 2025</p></footer>
            </div>
        </div>
    );
}

ReactDOM.render(<ConcursApp />, document.getElementById('root'));
    </script>
</body>
</html>
